!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).workspaces=e.workspaces||{},e.workspaces.min=t())}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{d(i.next(e))}catch(e){n(e)}}function a(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}d((i=i.apply(e,t||[])).next())}))}function t(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,r={};function i(r,i){var o=r instanceof Error?r:new Error(r);if(t)t(o);else{var n='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+o.stack;if(e)switch(e.errorHandling){case"log":return console.error(n);case"silent":return;case"throw":throw new Error(n)}console.error(n)}}return{add:function(e,t){var i=r[e];return i||(i=[],r[e]=i),i.push(t),function(){var i=r[e];i&&(i=i.reduce((function(e,r,i){return r===t&&e.length===i||e.push(r),e}),[]),r[e]=i)}},execute:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var n=r[e];if(!n||0===n.length)return[];var s=[];return n.forEach((function(r){try{var o=r.apply(void 0,t);s.push(o)}catch(t){s.push(void 0),i(t,e)}})),s},clear:function(){r={}},clearKey:function(e){r[e]&&delete r[e]}}}t.default=t;var r=t,i=function(e){return{ok:!0,result:e}},o=function(e){return{ok:!1,error:e}},n=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},s=function(e,t){return!0===t.ok?t.result:e},a=function(e){if(!0===e.ok)return e.result;throw e.error},d=function(e,t){return!0===t.ok?i(e(t.result)):t},c=function(e,t,r){return!1===t.ok?t:!1===r.ok?r:i(e(t.result,r.result))},h=function(e,t){return!0===t.ok?t:o(e(t.error))},l=function(e,t){return!0===t.ok?e(t.result):t},u=(Object.freeze({ok:i,isOk:function(e){return!0===e.ok},err:o,isErr:function(e){return!1===e.ok},asPromise:n,withDefault:s,withException:a,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:d,map2:c,mapError:h,andThen:l}),function(){return(u=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)});var p=function(e){return Array.isArray(e)},m=function(e){return"object"==typeof e&&null!==e&&!p(e)},f=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},w=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},g=function(e,t){var r=t.at,i=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(r[i[o]]=e[i[o]])}return r}(t,["at"]);return u({at:e+(r||"")},i)},y=function(){function e(t){var r=this;this.decode=t,this.run=function(e){return h((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),r.decode(e))},this.runPromise=function(e){return n(r.run(e))},this.runWithException=function(e){return a(r.run(e))},this.map=function(t){return new e((function(e){return d(t,r.decode(e))}))},this.andThen=function(t){return new e((function(e){return l((function(r){return t(r).decode(e)}),r.decode(e))}))},this.where=function(t,i){return r.andThen((function(r){return t(r)?e.succeed(r):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?i(e):o({message:f("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?i(e):o({message:f("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?i(e):o({message:f("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return function e(t,r){if(t===r)return!0;if(null===t&&null===r)return!0;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}var o=Object.keys(t);if(o.length!==Object.keys(r).length)return!1;for(i=0;i<o.length;i++){if(!r.hasOwnProperty(o[i]))return!1;if(!e(t[o[i]],r[o[i]]))return!1}return!0}}(e,t)?i(t):o({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(m(e)&&t){var r={};for(var n in t)if(t.hasOwnProperty(n)){var s=t[n].decode(e[n]);if(!0!==s.ok)return void 0===e[n]?o({message:"the key '"+n+"' is required but was not present"}):o(g("."+n,s.error));void 0!==s.result&&(r[n]=s.result)}return i(r)}return m(e)?i(e):o({message:f("an object",e)})}))},e.array=function(t){return new e((function(e){if(p(e)&&t){return e.reduce((function(e,r,i){return c((function(e,t){return e.concat([t])}),e,function(e,r){return h((function(e){return g("["+r+"]",e)}),t.decode(e))}(r,i))}),i([]))}return p(e)?i(e):o({message:f("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(p(e)){if(e.length!==t.length)return o({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var r=[],n=0;n<t.length;n++){var s=t[n].decode(e[n]);if(!s.ok)return o(g("["+n+"]",s.error));r[n]=s.result}return i(r)}return o({message:f("a tuple of length "+t.length,e)})}))},e.union=function(t,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.oneOf.apply(e,[t,r].concat(i))},e.intersection=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];return new e((function(e){return[t,r].concat(o).reduce((function(t,r){return c(Object.assign,t,r.decode(e))}),i({}))}))},e.anyJson=function(){return new e((function(e){return i(e)}))},e.unknownJson=function(){return new e((function(e){return i(e)}))},e.dict=function(t){return new e((function(e){if(m(e)){var r={};for(var n in e)if(e.hasOwnProperty(n)){var s=t.decode(e[n]);if(!0!==s.ok)return o(g("."+n,s.error));r[n]=s.result}return i(r)}return o({message:f("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?i(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new e((function(e){for(var r=[],i=0;i<t.length;i++){var n=t[i].decode(e);if(!0===n.ok)return n;r[i]=n.error}var s=r.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return o({message:'expected a value matching one of the decoders, got the errors ["'+s+'"]'})}))},e.withDefault=function(t,r){return new e((function(e){return i(s(t,r.decode(e)))}))},e.valueAt=function(t,r){return new e((function(e){for(var i=e,n=0;n<t.length;n++){if(void 0===i)return o({at:w(t.slice(0,n+1)),message:"path does not exist"});if("string"==typeof t[n]&&!m(i))return o({at:w(t.slice(0,n+1)),message:f("an object",i)});if("number"==typeof t[n]&&!p(i))return o({at:w(t.slice(0,n+1)),message:f("an array",i)});i=i[t[n]]}return h((function(e){return void 0===i?{at:w(t),message:"path does not exist"}:g(w(t),e)}),r.decode(i))}))},e.succeed=function(t){return new e((function(e){return i(t)}))},e.fail=function(t){return new e((function(e){return o({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),v=y.string,k=y.number,W=y.boolean,b=y.anyJson,I=y.constant,x=y.object,S=y.array,D=y.optional,C=y.oneOf,E=y.intersection,B=y.lazy;const M=v().where(e=>e.length>0,"Expected a non-empty string"),A=k().where(e=>e>=0,"Expected a non-negative number"),P=k().where(e=>e>0,"Expected a positive number"),T=x({inWorkspace:W()}),L=C(I("workspace"),I("row"),I("column"),I("group")),R=C(I("row"),I("column"),I("group")),F=C(I("maximized"),I("minimized"),I("normal")),z=(e,t)=>{const r=typeof e;if(t&&"function"!==r&&"undefined"!==r)throw new Error("Provided argument must be either undefined or of type function, provided: "+r);if(!t&&"function"!==r)throw new Error("Provided argument must be of type function, provided: "+r)},H=D(x({saveLayout:D(W())})),j=x({name:M}),O=x({minWidth:D(k()),maxWidth:D(k()),minHeight:D(k()),maxHeight:D(k()),allowExtract:D(W()),showCloseButton:D(W())}),_=x({minWidth:D(k()),maxWidth:D(k()),minHeight:D(k()),maxHeight:D(k()),allowExtract:D(W()),allowDrop:D(W()),allowDropHeader:D(W()),allowDropLeft:D(W()),allowDropRight:D(W()),allowDropTop:D(W()),allowDropBottom:D(W()),showMaximizeButton:D(W()),showEjectButton:D(W()),showAddWindowButton:D(W())}),$=x({minHeight:D(k()),maxHeight:D(k()),allowDrop:D(W()),allowSplitters:D(W()),isPinned:D(W())}),G=x({minWidth:D(k()),maxWidth:D(k()),allowDrop:D(W()),allowSplitters:D(W()),isPinned:D(W())}),N=x({type:D(I("window")),appName:D(M),windowId:D(M),context:D(b()),config:D(O)}),J=x({type:I("window"),appName:D(M),windowId:D(M),context:D(b()),config:D(O)}),U=D(x({type:D(R),children:D(B(()=>S(C(N,U)))),config:D(b())})),K=x({type:I("column"),children:D(B(()=>S(C(J,V)))),config:D(G)}),q=x({type:I("row"),children:D(B(()=>S(C(J,V)))),config:D($)}),Q=x({type:I("group"),children:D(B(()=>S(C(J,V)))),config:D(_)}),V=C(Q,K,q),X=(C(v().where(e=>"maximized"===e.toLowerCase(),"Expected a case insensitive variation of 'maximized'"),v().where(e=>"normal"===e.toLowerCase(),"Expected a case insensitive variation of 'normal'")),x({bounds:D(x({left:D(k()),top:D(k()),width:D(A),height:D(A)}))})),Y=C(I("direct"),I("delayed"),I("lazy")),Z=D(x({app:D(M),context:D(b()),loadingStrategy:D(Y),title:D(M),reuseWorkspaceId:D(M),frameId:D(M),lockdown:D(W()),activateFrame:D(W()),newFrame:D(C(X,W())),noTabHeader:D(W()),inMemoryLayout:D(W())})),ee=x({name:M,restoreOptions:D(Z)}),te=x({children:D(S(C(N,U))),context:D(b()),config:D(x({title:D(M),position:D(A),isFocused:D(W()),noTabHeader:D(W()),reuseWorkspaceId:D(M),loadingStrategy:D(Y),allowDrop:D(W()),allowDropLeft:D(W()),allowDropTop:D(W()),allowDropRight:D(W()),allowDropBottom:D(W()),allowExtract:D(W()),showSaveButton:D(W()),showCloseButton:D(W()),allowSplitters:D(W()),showWindowCloseButtons:D(W()),showEjectButtons:D(W()),showAddWindowButtons:D(W())})),frame:D(x({reuseFrameId:D(M),newFrame:D(C(W(),X))}))}),re=x({type:L,definition:D(C(te,U))}),ie=E(te,x({saveConfig:D(x({saveLayout:D(W())}))})),oe=x({itemId:M}),ne=x({id:M}),se=(x({type:R,id:M,frameId:M,workspaceId:M,positionIndex:k()}),C(I("frame"),I("workspace"),I("container"),I("window"))),ae=x({type:se,branch:M}),de=C(I("opened"),I("closing"),I("closed"),I("focus"),I("added"),I("loaded"),I("removed"),I("childrenUpdate"),I("containerChange"),I("maximized"),I("minimized"),I("normal"),I("selected")),ce=x({frameId:M,title:M,positionIndex:A,name:M,layoutName:D(M),isHibernated:D(W()),isSelected:D(W()),allowDrop:D(W()),allowExtract:D(W()),allowSplitters:D(W()),showCloseButton:D(W()),showSaveButton:D(W()),allowDropLeft:D(W()),allowDropTop:D(W()),allowDropRight:D(W()),allowDropBottom:D(W()),minWidth:D(k()),maxWidth:D(k()),minHeight:D(k()),maxHeight:D(k()),showAddWindowButtons:D(W()),showEjectButtons:D(W()),showWindowCloseButtons:D(W()),widthInPx:D(k()),heightInPx:D(k())}),he=x({frameId:M,workspaceId:M,positionIndex:k(),minWidth:D(k()),maxWidth:D(k()),minHeight:D(k()),maxHeight:D(k())}),le=b(),ue=E(he,x({windowId:D(M),isMaximized:D(W()),isFocused:W(),title:D(v()),appName:D(M),allowExtract:D(W()),showCloseButton:D(W()),minWidth:D(k()),minHeigth:D(k()),maxWidth:D(k()),maxHeight:D(k()),widthInPx:D(k()),heightInPx:D(k())})),pe=x({id:D(M),config:le,children:D(B(()=>S(fe))),type:C(I("row"),I("column"),I("group"))}),me=x({id:D(M),config:ue,type:I("window")}),fe=C(me,pe),we=x({id:M,config:ce,children:S(fe),frameSummary:ne}),ge=x({type:I("window"),config:x({appName:M,url:D(M),title:D(v()),allowExtract:D(W()),showCloseButton:D(W()),minWidth:D(k()),minHeigth:D(k()),maxWidth:D(k()),maxHeight:D(k())})}),ye=x({type:I("group"),config:b(),children:S(C(ge))}),ve=x({type:I("column"),config:b(),children:S(C(ye,ge,B(()=>ve),B(()=>ke)))}),ke=x({type:I("row"),config:b(),children:S(C(ve,ye,ge,B(()=>ke)))}),We=x({name:M,type:I("Workspace"),metadata:D(b()),components:S(x({type:I("Workspace"),state:x({config:b(),context:b(),children:S(C(ke,ve,ye,ge))})}))}),be=x({layout:We,mode:C(I("replace"),I("merge"))}),Ie=x({layouts:S(We)}),xe=x({id:M}),Se=x({summaries:S(xe)}),De=x({id:M,config:ce}),Ce=x({summaries:S(De)}),Ee=x({id:M,config:b(),workspaces:S(we)}),Be=x({name:M}),Me=x({summaries:S(Be)}),Ae=x({windowId:M}),Pe=b(),Te=x({state:F}),Le=x({bounds:x({top:k(),left:k(),width:A,height:A})}),Re=x({width:D(P),height:D(P),relative:D(W())}),Fe=x({top:D(k()),left:D(k()),relative:D(W())}),ze=x({itemId:M}),He=x({frameId:M,requestedState:F}),je=x({itemId:M,title:M}),Oe=x({itemId:M,containerId:M}),_e=E(ze,Re),$e=E(ze,Fe),Ge=(x({id:M,type:R}),x({definition:N,parentId:M,parentType:L})),Ne=x({definition:V,parentId:M,parentType:L}),Je=x({itemId:M,windowId:D(M)}),Ue=x({live:W()}),Ke=x({type:C(I("row"),I("column")),workspaceId:M}),qe=x({itemId:M,config:le}),Qe=x({frameSummary:ne}),Ve=x({workspaceSummary:De,frameSummary:ne,workspaceSnapshot:D(we)}),Xe=x({containerSummary:qe}),Ye=x({windowSummary:x({itemId:M,parentId:M,config:ue})}),Ze=x({name:M,workspaceId:M,saveContext:D(W())}),et=x({workspaceId:M}),tt=x({allowDrop:D(W()),allowDropLeft:D(W()),allowDropTop:D(W()),allowDropRight:D(W()),allowDropBottom:D(W()),allowExtract:D(W()),allowSplitters:D(W()),showCloseButton:D(W()),showSaveButton:D(W()),showWindowCloseButtons:D(W()),showAddWindowButtons:D(W()),showEjectButtons:D(W())}),rt=x({workspaceId:M,config:D(tt)}),it=x({allowExtract:D(W()),showCloseButton:D(W())}),ot=x({width:D(A),height:D(A)}),nt=x({windowPlacementId:M,config:D(it)}),st=x({allowDrop:D(W()),allowSplitters:D(W())}),at=x({allowDrop:D(W()),allowSplitters:D(W())}),dt=x({allowExtract:D(W()),allowDrop:D(W()),allowDropLeft:D(W()),allowDropRight:D(W()),allowDropTop:D(W()),allowDropBottom:D(W()),allowDropHeader:D(W()),showMaximizeButton:D(W()),showEjectButton:D(W()),showAddWindowButton:D(W())}),ct=x({itemId:M,type:I("row"),config:D(st)}),ht=x({itemId:M,type:I("column"),config:D(at)}),lt=x({itemId:M,type:I("group"),config:D(dt)}),ut=C(ct,ht,lt),pt="T42.Web.Platform.Control",mt="T42.Web.Platform.WSP.Stream",ft={control:{name:"T42.Workspaces.Control",isStream:!1},frameStream:{name:"T42.Workspaces.Stream.Frame",isStream:!0},workspaceStream:{name:"T42.Workspaces.Stream.Workspace",isStream:!0},containerStream:{name:"T42.Workspaces.Stream.Container",isStream:!0},windowStream:{name:"T42.Workspaces.Stream.Window",isStream:!0}},wt={frame:{name:"T42.Workspaces.Stream.Frame",payloadDecoder:Qe},workspace:{name:"T42.Workspaces.Stream.Workspace",payloadDecoder:Ve},container:{name:"T42.Workspaces.Stream.Container",payloadDecoder:Xe},window:{name:"T42.Workspaces.Stream.Window",payloadDecoder:Ye}},gt={ping:{name:"ping",resultDecoder:Ue},isWindowInWorkspace:{name:"isWindowInWorkspace",argsDecoder:ze,resultDecoder:T},createWorkspace:{name:"createWorkspace",resultDecoder:we,argsDecoder:ie},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:Se},getFrameSummary:{name:"getFrameSummary",resultDecoder:ne,argsDecoder:oe},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:Ce},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",resultDecoder:we,argsDecoder:ze},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:Me},openWorkspace:{name:"openWorkspace",argsDecoder:ee,resultDecoder:we},deleteLayout:{name:"deleteLayout",resultDecoder:Pe,argsDecoder:j},saveLayout:{name:"saveLayout",resultDecoder:We,argsDecoder:Ze},importLayout:{name:"importLayout",resultDecoder:Pe,argsDecoder:be},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:Ie},restoreItem:{name:"restoreItem",argsDecoder:ze,resultDecoder:Pe},maximizeItem:{name:"maximizeItem",argsDecoder:ze,resultDecoder:Pe},focusItem:{name:"focusItem",argsDecoder:ze,resultDecoder:Pe},closeItem:{name:"closeItem",argsDecoder:ze,resultDecoder:Pe},resizeItem:{name:"resizeItem",argsDecoder:_e,resultDecoder:Pe},changeFrameState:{name:"changeFrameState",argsDecoder:He,resultDecoder:Pe},getFrameState:{name:"getFrameState",argsDecoder:ze,resultDecoder:Te},getFrameBounds:{name:"getFrameBounds",argsDecoder:ze,resultDecoder:Le},moveFrame:{name:"moveFrame",argsDecoder:$e,resultDecoder:Pe},getFrameSnapshot:{name:"getFrameSnapshot",argsDecoder:ze,resultDecoder:Ee},forceLoadWindow:{name:"forceLoadWindow",argsDecoder:ze,resultDecoder:Ae},ejectWindow:{name:"ejectWindow",argsDecoder:ze,resultDecoder:Ae},setItemTitle:{name:"setItemTitle",argsDecoder:je,resultDecoder:Pe},moveWindowTo:{name:"moveWindowTo",argsDecoder:Oe,resultDecoder:Pe},addWindow:{name:"addWindow",argsDecoder:Ge,resultDecoder:Je},addContainer:{name:"addContainer",argsDecoder:Ne,resultDecoder:Je},bundleWorkspace:{name:"bundleWorkspace",argsDecoder:Ke,resultDecoder:Pe},hibernateWorkspace:{name:"hibernateWorkspace",argsDecoder:et,resultDecoder:Pe},resumeWorkspace:{name:"resumeWorkspace",argsDecoder:et,resultDecoder:Pe},lockWorkspace:{name:"lockWorkspace",argsDecoder:rt,resultDecoder:Pe},lockWindow:{name:"lockWindow",argsDecoder:nt,resultDecoder:Pe},lockContainer:{name:"lockContainer",argsDecoder:ut,resultDecoder:Pe}};class yt{constructor(e,t){this.transport=e,this.registry=t,this.activeSubscriptions=[]}createCoreEventSubscription(){return e(this,void 0,void 0,(function*(){yield this.transport.coreSubscriptionReady(this.handleCoreEvent.bind(this))}))}handleCoreSubscription(e){const t=`${e.eventType}-${e.action}`,r=e.scope,i=e.scopeId;return this.registry.add(t,t=>{var o,n,s,a,d;const c={type:r,id:i},h={frame:(null===(o=t.frameSummary)||void 0===o?void 0:o.id)||(null===(n=t.windowSummary)||void 0===n?void 0:n.config.frameId),workspace:(null===(s=t.workspaceSummary)||void 0===s?void 0:s.id)||(null===(a=t.windowSummary)||void 0===a?void 0:a.config.workspaceId),window:null===(d=t.windowSummary)||void 0===d?void 0:d.config.windowId};this.checkScopeMatch(c,h)&&e.callback(t)})}send(t,r){return e(this,void 0,void 0,(function*(){const e=Object.values(gt).find(e=>e.name===t);if(!e)throw new Error("Cannot find definition for operation name: "+t);if(e.argsDecoder)try{e.argsDecoder.runWithException(r)}catch(e){throw new Error(`Unexpected internal outgoing validation error: ${e.message}, for input: ${JSON.stringify(e.input)}, for operation ${t}`)}let i;try{const t=yield this.transport.transmitControl(e.name,r);i=e.resultDecoder.runWithException(t)}catch(e){if(e.kind)throw new Error(`Unexpected internal incoming validation error: ${e.message}, for input: ${JSON.stringify(e.input)}, for operation ${t}`);throw new Error(e.message)}return i}))}subscribe(t){return e(this,void 0,void 0,(function*(){let e=this.getActiveSubscription(t);const r=this.getRegistryKey(t);if(!e){const r=wt[t.eventType],i=yield this.transport.subscribe(r.name,this.getBranchKey(t),t.eventType);i.onData(e=>{const t=e.data,r=ae.run(e.requestArguments),i=de.run(t.action);if(!r.ok||!i.ok)return;const o=r.result.type,n=r.result.branch,s=wt[o].payloadDecoder.run(t.payload);if(!s.ok)return;const a=`${o}-${n}-${i.result}`;this.registry.execute(a,s.result)}),e={streamType:t.eventType,level:t.scope,levelId:t.scopeId,callbacksCount:0,gdSub:i},this.activeSubscriptions.push(e)}const i=this.registry.add(r,t.callback);return++e.callbacksCount,()=>{i(),--e.callbacksCount,0===e.callbacksCount&&(e.gdSub.close(),this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(e),1))}}))}checkScopeMatch(e,t){return"global"===e.type||("frame"===e.type&&e.id===t.frame||("workspace"===e.type&&e.id===t.workspace||"window"===e.type&&e.id===t.window))}handleCoreEvent(e){const t=e.data;try{const e=de.runWithException(t.action),r=se.runWithException(t.type),i=wt[r].payloadDecoder.runWithException(t.payload),o=`${r}-${e}`;this.registry.execute(o,i)}catch(e){console.warn(`Cannot handle event with data ${JSON.stringify(t)}, because of validation error: ${e.message}`)}}getBranchKey(e){return"global"===e.scope?e.scope:`${e.scope}_${e.scopeId}`}getRegistryKey(e){return`${e.eventType}-${this.getBranchKey(e)}-${e.action}`}getActiveSubscription(e){return this.activeSubscriptions.find(t=>t.streamType===e.eventType&&t.level===e.scope&&t.levelId===e.scopeId)}}class vt{constructor(e){this.agm=e,this.defaultTransportTimeout=3e4,this.coreEventMethodInitiated=!1}initiate(t){return e(this,void 0,void 0,(function*(){window.glue42gd?yield Promise.all(Object.values(ft).map(e=>this.verifyMethodLive(e.name))):(yield Promise.all([this.verifyMethodLive(pt),this.verifyMethodLive(mt)]),yield this.transmitControl("frameHello",{windowId:t}))}))}coreSubscriptionReady(e){return this.coreEventMethodInitiated||this.subscribePlatform(e),this.corePlatformSubPromise}subscribePlatform(e){this.coreEventMethodInitiated=!0,this.corePlatformSubPromise=this.agm.subscribe(mt),this.corePlatformSubPromise.then(t=>{t.onData(t=>e(t.data))})}subscribe(t,r,i){return e(this,void 0,void 0,(function*(){const e={branch:r,type:i};let o;try{o=yield this.agm.subscribe(t,{arguments:e})}catch(e){const i=`Internal subscription error! Error details: stream - ${t}, branch: ${r}. Internal message: ${e.message}`;throw new Error(i)}return o}))}transmitControl(t,r){return e(this,void 0,void 0,(function*(){const e=window.glue42gd?{operation:t,operationArguments:r}:{operation:t,domain:"workspaces",data:r},i=window.glue42gd?ft.control.name:pt;let o;const n=`Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(e)}. `;try{if(o=yield this.agm.invoke(i,e,"best",{methodResponseTimeoutMs:this.defaultTransportTimeout}),!o)throw new Error("Received unsupported result from GD - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error("Received unsupported result from GD - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${n} -> Inner message: ${t}`)}throw new Error(`${n} -> Inner message: ${e.message}`)}return o.all_return_values[0].returned}))}verifyMethodLive(e){return t=()=>new Promise(t=>{if(this.agm.methods().some(t=>t.name===e))return void t();let r=this.agm.methodAdded(i=>{i.name===e&&(r?(r(),r=null):setTimeout(()=>{r&&r()},0),t())})}),r=15e3,i="Timeout waiting for the Workspaces communication channels",new Promise((e,o)=>{let n=!0;const s=setTimeout(()=>{n&&(n=!1,o(i||"Promise timeout hit: "+r))},r);t().then(t=>{n&&(n=!1,clearTimeout(s),e(t))}).catch(e=>{n&&(n=!1,clearTimeout(s),o(e))})});var t,r,i}}const kt=new WeakMap;class Wt{constructor(e,t){const r=t.wrapChildren(e.children);delete e.children,kt.set(this,{base:t,children:r,definition:e})}get type(){return kt.get(this).definition.type}addColumn(e){return kt.get(this).base.add("column",kt.get(this).children,e)}addRow(e){return kt.get(this).base.add("row",kt.get(this).children,e)}addGroup(e){return kt.get(this).base.add("group",kt.get(this).children,e)}addWindow(e){return kt.get(this).base.addWindow(kt.get(this).children,e),this}serialize(){const e=kt.get(this).definition;return e.children=kt.get(this).base.serializeChildren(kt.get(this).children),e}}class bt{constructor(e){this.getBuilder=e}wrapChildren(e){return e.map(e=>"window"===e.type?e:this.getBuilder({type:e.type,definition:e}))}add(e,t,r){const i=U.runWithException(r),o=this.getBuilder({type:e,definition:i});return t.push(o),o}addWindow(e,t){const r=N.runWithException(t);r.type="window",e.push(r)}serializeChildren(e){return e.map(e=>e instanceof Wt?e.serialize():e)}}const It=new WeakMap;class xt{constructor(e,t,r){const i=t.wrapChildren(e.children);delete e.children,It.set(this,{base:t,children:i,definition:e,controller:r})}addColumn(e){const t=It.get(this).children;if(!t.every(e=>e instanceof Wt&&"column"===e.type))throw new Error("Cannot add a column to this workspace, because there are already children of another type");return It.get(this).base.add("column",t,e)}addRow(e){const t=It.get(this).children;if(!t.every(e=>e instanceof Wt&&"row"===e.type))throw new Error("Cannot add a row to this workspace, because there are already children of another type");return It.get(this).base.add("row",t,e)}addGroup(e){const t=It.get(this).children;if(0!==t.length)throw new Error("Cannot add a group to this workspace, because there are already defined children.");return It.get(this).base.add("group",t,e)}addWindow(e){const t=It.get(this).children;if(0!==t.length)throw new Error("Cannot add a window to this workspace, because there are already defined children.");return It.get(this).base.addWindow(t,e),this}getChildAt(e){A.runWithException(e);return It.get(this).children[e]}create(t){return e(this,void 0,void 0,(function*(){const e=H.runWithException(t),r=It.get(this).definition;r.children=It.get(this).base.serializeChildren(It.get(this).children);return It.get(this).controller.createWorkspace(r,e)}))}}const St=new WeakMap,Dt=e=>St.get(e).base;class Ct{constructor(e){St.set(this,{base:e})}get type(){return"row"}get id(){return Dt(this).getId(this)}get frameId(){return Dt(this).getFrameId(this)}get workspaceId(){return Dt(this).getWorkspaceId(this)}get positionIndex(){return Dt(this).getPositionIndex(this)}get children(){return Dt(this).getAllChildren(this)}get parent(){return Dt(this).getMyParent(this)}get frame(){return Dt(this).getMyFrame(this)}get workspace(){return Dt(this).getMyWorkspace(this)}get allowDrop(){return Dt(this).getAllowDrop(this)}get allowSplitters(){return Dt(this).getAllowSplitters(this)}get minWidth(){return Dt(this).getMinWidth(this)}get minHeight(){return Dt(this).getMinHeight(this)}get maxWidth(){return Dt(this).getMaxWidth(this)}get maxHeight(){return Dt(this).getMaxHeight(this)}get width(){return Dt(this).getWidthInPx(this)}get height(){return Dt(this).getHeightInPx(this)}get isPinned(){return Dt(this).getIsPinned(this)}get isMaximized(){return Dt(this).getIsMaximized(this)}addWindow(e){return Dt(this).addWindow(this,e,"row")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Dt(this).addParent(this,"group","row",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"column"!==t.type)throw new Error("Expected a column definition, but received "+t.type);return Dt(this).addParent(this,"column","row",t)}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as row children is not supported")}))}removeChild(e){return Dt(this).removeChild(this,e)}maximize(){return Dt(this).maximize(this)}restore(){return Dt(this).restore(this)}close(){return Dt(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowSplitters:this.allowSplitters})}else t=e;const r=void 0===t?void 0:st.runWithException(t);return Dt(this).lockContainer(this,r)}setHeight(t){return e(this,void 0,void 0,(function*(){return A.runWithException(t),Dt(this).setHeight(this,t)}))}}const Et=new WeakMap,Bt=e=>Et.get(e).base;class Mt{constructor(e){Et.set(this,{base:e})}get type(){return"column"}get id(){return Bt(this).getId(this)}get frameId(){return Bt(this).getFrameId(this)}get workspaceId(){return Bt(this).getWorkspaceId(this)}get positionIndex(){return Bt(this).getPositionIndex(this)}get children(){return Bt(this).getAllChildren(this)}get parent(){return Bt(this).getMyParent(this)}get frame(){return Bt(this).getMyFrame(this)}get workspace(){return Bt(this).getMyWorkspace(this)}get allowDrop(){return Bt(this).getAllowDrop(this)}get allowSplitters(){return Bt(this).getAllowSplitters(this)}get minWidth(){return Bt(this).getMinWidth(this)}get minHeight(){return Bt(this).getMinHeight(this)}get maxWidth(){return Bt(this).getMaxWidth(this)}get maxHeight(){return Bt(this).getMaxHeight(this)}get width(){return Bt(this).getWidthInPx(this)}get height(){return Bt(this).getHeightInPx(this)}get isPinned(){return Bt(this).getIsPinned(this)}get isMaximized(){return Bt(this).getIsMaximized(this)}addWindow(e){return Bt(this).addWindow(this,e,"column")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Bt(this).addParent(this,"group","column",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as column children is not supported")}))}addRow(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"row"!==t.type)throw new Error("Expected a row definition, but received "+t.type);return Bt(this).addParent(this,"row","column",t)}))}removeChild(e){return Bt(this).removeChild(this,e)}maximize(){return Bt(this).maximize(this)}restore(){return Bt(this).restore(this)}close(){return Bt(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowSplitters:this.allowSplitters})}else t=e;const r=void 0===t?void 0:at.runWithException(t);return Bt(this).lockContainer(this,r)}setWidth(t){return e(this,void 0,void 0,(function*(){return A.runWithException(t),Bt(this).setWidth(this,t)}))}}const At=new WeakMap,Pt=e=>At.get(e).base;class Tt{constructor(e){At.set(this,{base:e})}get type(){return"group"}get id(){return Pt(this).getId(this)}get frameId(){return Pt(this).getFrameId(this)}get workspaceId(){return Pt(this).getWorkspaceId(this)}get positionIndex(){return Pt(this).getPositionIndex(this)}get children(){return Pt(this).getAllChildren(this)}get parent(){return Pt(this).getMyParent(this)}get frame(){return Pt(this).getMyFrame(this)}get workspace(){return Pt(this).getMyWorkspace(this)}get allowExtract(){return Pt(this).getAllowExtract(this)}get allowDropLeft(){return Pt(this).getAllowDropLeft(this)}get allowDropRight(){return Pt(this).getAllowDropRight(this)}get allowDropTop(){return Pt(this).getAllowDropTop(this)}get allowDropBottom(){return Pt(this).getAllowDropBottom(this)}get allowDropHeader(){return Pt(this).getAllowDropHeader(this)}get allowDrop(){return Pt(this).getAllowDrop(this)}get showMaximizeButton(){return Pt(this).getShowMaximizeButton(this)}get showEjectButton(){return Pt(this).getShowEjectButton(this)}get showAddWindowButton(){return Pt(this).getShowAddWindowButton(this)}get minWidth(){return Pt(this).getMinWidth(this)}get minHeight(){return Pt(this).getMinHeight(this)}get maxWidth(){return Pt(this).getMaxWidth(this)}get maxHeight(){return Pt(this).getMaxHeight(this)}get width(){return Pt(this).getWidthInPx(this)}get height(){return Pt(this).getHeightInPx(this)}get isMaximized(){return Pt(this).getIsMaximized(this)}addWindow(e){return Pt(this).addWindow(this,e,"group")}addGroup(){return e(this,void 0,void 0,(function*(){throw new Error("Adding groups as group child is not supported")}))}addColumn(){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as group child is not supported")}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as group child is not supported")}))}removeChild(e){return Pt(this).removeChild(this,e)}maximize(){return Pt(this).maximize(this)}restore(){return Pt(this).restore(this)}close(){return Pt(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowDropHeader:this.allowDropHeader,allowDropLeft:this.allowDropLeft,allowDropRight:this.allowDropRight,allowDropTop:this.allowDropTop,allowDropBottom:this.allowDropBottom,allowExtract:this.allowExtract,showAddWindowButton:this.showAddWindowButton,showEjectButton:this.showEjectButton,showMaximizeButton:this.showMaximizeButton})}else t=e;const r=void 0===t?void 0:dt.runWithException(t);return Pt(this).lockContainer(this,r)}setSize(t){return e(this,void 0,void 0,(function*(){const e=ot.runWithException(t);if(!e.width&&!e.height)throw new Error("Expected either width or height to be passed.");return Pt(this).setSize(this,t.width,t.height)}))}}const Lt=new WeakMap,Rt=e=>Lt.get(e).manager.getWorkspaceData(e),Ft=e=>Lt.get(e).manager;class zt{constructor(e){Lt.set(this,{manager:e})}get id(){return Rt(this).id}get frameId(){return Rt(this).config.frameId}get positionIndex(){return Rt(this).config.positionIndex}get title(){return Rt(this).config.title}get layoutName(){return Rt(this).config.layoutName}get isHibernated(){return Rt(this).config.isHibernated}get isSelected(){return Rt(this).config.isSelected}get children(){return Rt(this).children}get frame(){return Rt(this).frame}get allowSplitters(){return Rt(this).config.allowSplitters}get allowDrop(){return Rt(this).config.allowDrop}get allowDropLeft(){return Rt(this).config.allowDropLeft}get allowDropTop(){return Rt(this).config.allowDropTop}get allowDropRight(){return Rt(this).config.allowDropRight}get allowDropBottom(){return Rt(this).config.allowDropBottom}get allowExtract(){return Rt(this).config.allowExtract}get showCloseButton(){return Rt(this).config.showCloseButton}get showSaveButton(){return Rt(this).config.showSaveButton}get minWidth(){return Rt(this).config.minWidth}get minHeight(){return Rt(this).config.minHeight}get maxWidth(){return Rt(this).config.maxWidth}get maxHeight(){return Rt(this).config.maxHeight}get width(){return Rt(this).config.widthInPx}get height(){return Rt(this).config.heightInPx}get showWindowCloseButtons(){return Rt(this).config.showWindowCloseButtons}get showEjectButtons(){return Rt(this).config.showEjectButtons}get showAddWindowButtons(){return Rt(this).config.showAddWindowButtons}removeChild(t){return e(this,void 0,void 0,(function*(){z(t);const e=this.children.find(t);e&&(yield e.close(),yield this.refreshReference())}))}remove(t){return e(this,void 0,void 0,(function*(){z(t);const e=Rt(this).controller.iterateFindChild(this.children,t);yield e.close(),yield this.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){yield Rt(this).controller.focusItem(this.id),yield this.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=Rt(this).controller,t=yield Rt(this).frame.workspaces();if(1===t.length&&t.every(e=>e.id===this.id))return this.frame.close();yield e.closeItem(this.id)}))}snapshot(){return Rt(this).controller.getSnapshot(this.id,"workspace")}saveLayout(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t),yield Rt(this).controller.saveLayout({name:t,workspaceId:this.id,saveContext:null==r?void 0:r.saveContext})}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=Rt(this).controller;yield e.setItemTitle(this.id,t),yield this.refreshReference()}))}getContext(){return Rt(this).controller.getWorkspaceContext(this.id)}setContext(e){return Rt(this).controller.setWorkspaceContext(this.id,e)}updateContext(e){return Rt(this).controller.updateWorkspaceContext(this.id,e)}onContextUpdated(e){return Rt(this).controller.subscribeWorkspaceContextUpdated(this.id,e)}refreshReference(){return e(this,void 0,void 0,(function*(){const e=yield Rt(this).controller.getSnapshot(this.id,"workspace"),t=Rt(this).controller.flatChildren(Rt(this).children),r=Rt(this).controller.refreshChildren({existingChildren:t,workspace:this,parent:this,children:e.children}),i=this.frame;let o;if(i.id===e.config.frameId)Ft(this).remapFrame(i,e.frameSummary),o=i;else{const t={summary:e.frameSummary};o=Rt(this).ioc.getModel("frame",t)}Ft(this).remapWorkspace(this,{config:e.config,children:r,frame:o})}))}getBox(e){z(e);const t=Rt(this).children;return Rt(this).controller.iterateFindChild(t,t=>"window"!==t.type&&e(t))}getAllBoxes(e){z(e,!0);const t=Rt(this).children,r=Rt(this).controller.iterateFilterChildren(t,e=>"window"!==e.type);return e?r.filter(e):r}getRow(e){return z(e),this.getBox(t=>"row"===t.type&&e(t))}getAllRows(e){return z(e,!0),e?this.getAllBoxes(t=>"row"===t.type&&e(t)):this.getAllBoxes(e=>"row"===e.type)}getColumn(e){return z(e),this.getBox(t=>"column"===t.type&&e(t))}getAllColumns(e){return z(e,!0),e?this.getAllBoxes(t=>"column"===t.type&&e(t)):this.getAllBoxes(e=>"column"===e.type)}getGroup(e){return z(e),this.getBox(t=>"group"===t.type&&e(t))}getAllGroups(e){return z(e,!0),e?this.getAllBoxes(t=>"group"===t.type&&e(t)):this.getAllBoxes(e=>"group"===e.type)}getWindow(e){z(e);const t=Rt(this).children;return Rt(this).controller.iterateFindChild(t,t=>"window"===t.type&&e(t))}getAllWindows(e){z(e,!0);const t=Rt(this).children,r=Rt(this).controller.iterateFilterChildren(t,e=>"window"===e.type);return e?r.filter(e):r}addRow(e){return Rt(this).base.addParent(this,"row","workspace",e)}addColumn(e){return Rt(this).base.addParent(this,"column","workspace",e)}addGroup(e){return Rt(this).base.addParent(this,"group","workspace",e)}addWindow(e){return Rt(this).base.addWindow(this,e,"workspace")}bundleToRow(){return e(this,void 0,void 0,(function*(){yield Rt(this).controller.bundleTo("row",this.id),yield this.refreshReference()}))}bundleToColumn(){return e(this,void 0,void 0,(function*(){yield Rt(this).controller.bundleTo("column",this.id),yield this.refreshReference()}))}hibernate(){return e(this,void 0,void 0,(function*(){yield Rt(this).controller.hibernateWorkspace(this.id),yield this.refreshReference()}))}resume(){return e(this,void 0,void 0,(function*(){yield Rt(this).controller.resumeWorkspace(this.id),yield this.refreshReference()}))}lock(t){return e(this,void 0,void 0,(function*(){let e=void 0;if("function"==typeof t){const r={allowDrop:this.allowDrop,allowDropLeft:this.allowDropLeft,allowDropTop:this.allowDropTop,allowDropRight:this.allowDropRight,allowDropBottom:this.allowDropBottom,allowExtract:this.allowExtract,allowSplitters:this.allowSplitters,showCloseButton:this.showCloseButton,showSaveButton:this.showSaveButton,showAddWindowButtons:this.showAddWindowButtons,showEjectButtons:this.showEjectButtons,showWindowCloseButtons:this.showWindowCloseButtons};e=t(r)}else e=t;const r=void 0===e?void 0:tt.runWithException(e);yield Rt(this).controller.lockWorkspace(this.id,r),yield this.refreshReference()}))}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const r=Rt(this).id,i={action:"closed",eventType:"workspace",scope:"workspace",scopeId:r,callback:()=>e(this,void 0,void 0,(function*(){t()}))};return yield Rt(this).controller.processLocalSubscription(i,r)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Rt(this).id,i={action:"added",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)}))};return yield Rt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=Rt(this).id,i={action:"removed",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{windowId:e,workspaceId:i,frameId:o}=r.windowSummary.config;t({windowId:e,workspaceId:i,frameId:o})}))};return yield Rt(this).controller.processLocalSubscription(i,r)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Rt(this).id,i={action:"loaded",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield Rt(this).controller.processLocalSubscription(i,r)}))}}const Ht=new WeakMap,jt=e=>Ht.get(e).manager.getWindowData(e);class Ot{constructor(e){Ht.set(this,{manager:e})}get id(){return jt(this).config.windowId}get elementId(){return jt(this).id}get type(){return"window"}get frameId(){return jt(this).frame.id}get workspaceId(){return jt(this).workspace.id}get positionIndex(){return jt(this).config.positionIndex}get isMaximized(){return jt(this).config.isMaximized}get isLoaded(){return jt(this).controller.checkIsWindowLoaded(this.id)}get focused(){return jt(this).config.isFocused}get title(){return jt(this).config.title}get allowExtract(){return jt(this).config.allowExtract}get showCloseButton(){return jt(this).config.showCloseButton}get width(){return jt(this).config.widthInPx}get height(){return jt(this).config.heightInPx}get minWidth(){return jt(this).config.minWidth}get minHeight(){return jt(this).config.minHeight}get maxWidth(){return jt(this).config.maxWidth}get maxHeight(){return jt(this).config.maxHeight}get workspace(){return jt(this).workspace}get frame(){return jt(this).frame}get parent(){return jt(this).parent}get appName(){return jt(this).config.appName}forceLoad(){return e(this,void 0,void 0,(function*(){if(this.isLoaded)return;const e=jt(this).controller,t=jt(this).id,r=yield e.forceLoadWindow(t);jt(this).config.windowId=r,yield this.workspace.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){const e=jt(this).id,t=jt(this).controller;yield t.focusItem(e),yield this.workspace.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=jt(this).id,t=jt(this).controller;yield t.closeItem(e),yield jt(this).parent.removeChild(t=>t.id===e),yield this.workspace.refreshReference()}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=jt(this).id,r=jt(this).controller;yield r.setItemTitle(e,t),yield this.workspace.refreshReference()}))}maximize(){return e(this,void 0,void 0,(function*(){const e=jt(this).id,t=jt(this).controller;yield t.maximizeItem(e),yield this.workspace.refreshReference()}))}restore(){return e(this,void 0,void 0,(function*(){const e=jt(this).id,t=jt(this).controller;yield t.restoreItem(e),yield this.workspace.refreshReference()}))}eject(){return e(this,void 0,void 0,(function*(){if(!this.isLoaded)throw new Error("Cannot eject this window, because it is not loaded yet");const e=jt(this).id,t=yield jt(this).controller.ejectWindow(e);return jt(this).config.windowId=t,yield this.workspace.refreshReference(),this.getGdWindow()}))}getGdWindow(){if(!this.isLoaded)throw new Error("Cannot fetch this GD window, because the window is not yet loaded");const e=jt(this).config.windowId;return jt(this).controller.getGDWindow(e)}moveTo(t){return e(this,void 0,void 0,(function*(){if(!(t instanceof Ct||t instanceof Mt||t instanceof Tt))throw new Error("Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group");const e=jt(this).id,r=jt(this).controller;if(!(yield r.getParent(e=>e.id===t.id)))throw new Error("Cannot move the window to the selected parent, because this parent does not exist.");yield r.moveWindowTo(e,t.id),yield this.workspace.refreshReference()}))}lock(t){return e(this,void 0,void 0,(function*(){let e=void 0;if("function"==typeof t){const r={allowExtract:this.allowExtract,showCloseButton:this.showCloseButton};e=t(r)}else e=t;const r=void 0===e?void 0:it.runWithException(e),i=jt(this).id;yield jt(this).controller.lockWindow(i,r),yield this.workspace.refreshReference()}))}setSize(t){return e(this,void 0,void 0,(function*(){const e=ot.runWithException(t);if(!e.width&&!e.height)throw new Error("Expected either width or height to be passed.");const r=jt(this).id,i=jt(this).controller;yield i.resizeItem(r,{height:e.height,width:e.width,relative:!1}),yield this.workspace.refreshReference()}))}onRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=jt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"removed",eventType:"window",scope:"window"};return yield jt(this).controller.processLocalSubscription(i,r)}))}}const _t=new WeakMap,$t=e=>_t.get(e).manager.getFrameData(e);class Gt{constructor(e){_t.set(this,{manager:e})}get id(){return $t(this).summary.id}getBounds(){const e=$t(this).summary.id;return $t(this).controller.getFrameBounds(e)}resize(t){return e(this,void 0,void 0,(function*(){const e=Re.runWithException(t),r=$t(this).summary.id;return $t(this).controller.resizeItem(r,e)}))}move(t){return e(this,void 0,void 0,(function*(){const e=Fe.runWithException(t),r=$t(this).summary.id;return $t(this).controller.moveFrame(r,e)}))}focus(){const e=$t(this).summary.id;return $t(this).controller.focusItem(e)}state(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=$t(this).summary.id;return $t(this).controller.getFrameState(e)}))}minimize(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=$t(this).summary.id;return $t(this).controller.changeFrameState(e,"minimized")}))}maximize(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=$t(this).summary.id;return $t(this).controller.changeFrameState(e,"maximized")}))}restore(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=$t(this).summary.id;return $t(this).controller.changeFrameState(e,"normal")}))}close(){const e=$t(this).summary.id;return $t(this).controller.closeItem(e)}snapshot(){const e=$t(this).summary.id;return $t(this).controller.getSnapshot(e,"frame")}workspaces(){return e(this,void 0,void 0,(function*(){return $t(this).controller.getWorkspacesByFrameId(this.id)}))}getConstraints(){return e(this,void 0,void 0,(function*(){const e=$t(this).controller,t=$t(this).summary.id;return e.getFrameConstraints(t)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=Z.runWithException(r);return $t(this).controller.restoreWorkspace(t,e)}))}createWorkspace(e,t){const r=te.runWithException(e),i=H.runWithException(t);return $t(this).controller.createWorkspace(r,i)}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id})},action:"closed",eventType:"frame",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onMaximized(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:()=>{t()},action:"maximized",eventType:"frame",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onMinimized(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:()=>{t()},action:"minimized",eventType:"frame",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onNormal(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:()=>{t()},action:"normal",eventType:"frame",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onWorkspaceOpened(t){return e(this,void 0,void 0,(function*(){z(t);const r=$t(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield $t(this).controller.transformStreamPayloadToWorkspace(r);t(e)})),action:"opened",eventType:"workspace",scope:"frame"};return yield $t(this).controller.processLocalSubscription(i,r)}))}onWorkspaceSelected(t){return e(this,void 0,void 0,(function*(){z(t);const r=$t(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield $t(this).controller.getWorkspaceById(r.workspaceSummary.id);t(e)})),action:"selected",eventType:"workspace",scope:"frame"};return yield $t(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},action:"closed",eventType:"workspace",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=$t(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield $t(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"added",eventType:"window",scope:"frame"};return yield $t(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const e=$t(this).summary.id,r={callback:e=>{const{windowId:r,workspaceId:i,frameId:o}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:o})},action:"removed",eventType:"window",scope:"frame"};return yield $t(this).controller.processLocalSubscription(r,e)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=$t(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield $t(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"loaded",eventType:"window",scope:"frame"};return yield $t(this).controller.processLocalSubscription(i,r)}))}}class Nt{constructor(){this.parentsData=new WeakMap,this.workspacesData=new WeakMap,this.windowsData=new WeakMap,this.framesData=new WeakMap,this.windowPlacementIdData={}}deleteData(e){if(e instanceof Ot){const t=Object.keys(this.windowPlacementIdData).find(t=>this.windowPlacementIdData[t]===e);t&&delete this.windowPlacementIdData[t],this.windowsData.delete(e)}e instanceof zt&&this.workspacesData.delete(e),(e instanceof Ct||e instanceof Mt||e instanceof Tt)&&this.parentsData.delete(e),e instanceof Gt&&this.framesData.delete(e)}setWindowData(e,t){this.windowPlacementIdData[t.id]=e,this.windowsData.set(e,t)}setWorkspaceData(e,t){this.workspacesData.set(e,t)}setParentData(e,t){this.parentsData.set(e,t)}setFrameData(e,t){this.framesData.set(e,t)}getWindowData(e){return this.windowsData.get(e)}getWindowByPlacementId(e){return this.windowPlacementIdData[e]}getWorkspaceData(e){return this.workspacesData.get(e)}getParentData(e){return this.parentsData.get(e)}getFrameData(e){return this.framesData.get(e)}remapChild(e,t){if(e instanceof Ot){const r=this.windowsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config}if(e instanceof Ct||e instanceof Mt||e instanceof Tt){const r=this.parentsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config,r.children=t.children||r.children}}remapFrame(e,t){this.framesData.get(e).summary=t}remapWorkspace(e,t){const r=this.workspacesData.get(e);r.frame=t.frame||r.frame,r.config=t.config||r.config,r.children=t.children||r.children}}const Jt=new WeakMap,Ut=(e,t)=>{const r=Jt.get(e).manager;return t instanceof zt?r.getWorkspaceData(t):Jt.get(e).manager.getParentData(t)},Kt=(e,t)=>Jt.get(e).manager.getWindowByPlacementId(t);class qt{constructor(e){Jt.set(this,{manager:e})}getId(e){return Ut(this,e).id}getPositionIndex(e){return Ut(this,e).config.positionIndex}getWorkspaceId(e){const t=Ut(this,e);return t.config.workspaceId||t.workspace.id}getFrameId(e){return Ut(this,e).frame.id}getAllChildren(e,t){z(t,!0);const r=Ut(this,e).children;return void 0===t?r:r.filter(t)}getMyParent(e){if(!(e instanceof zt))return Ut(this,e).parent}getMyFrame(e){return Ut(this,e).frame}getMyWorkspace(e){if(!(e instanceof zt))return Ut(this,e).workspace}addWindow(t,r,i){return e(this,void 0,void 0,(function*(){if(!r.appName&&!r.windowId)throw new Error("The window definition should contain either an appName or a windowId");const e=N.runWithException(r),o=Ut(this,t).controller,n=yield o.add("window",Ut(this,t).id,i,e);return t instanceof zt?(yield t.refreshReference(),Kt(this,n.itemId)):(yield this.getMyWorkspace(t).refreshReference(),Kt(this,n.itemId))}))}addParent(t,r,i,o){return e(this,void 0,void 0,(function*(){const e=this.transformDefinition(r,o),n=Ut(this,t).controller,s=(yield n.add("container",Ut(this,t).id,i,e)).itemId;if(t instanceof zt)return yield t.refreshReference(),t.getBox(e=>e.id===s);const a=this.getMyWorkspace(t);return yield a.refreshReference(),a.getBox(e=>e.id===s)}))}removeChild(t,r){return e(this,void 0,void 0,(function*(){z(r);const e=this.getAllChildren(t).find(r);e&&(yield e.close(),t instanceof zt?yield t.refreshReference():yield this.getMyWorkspace(t).refreshReference())}))}maximize(t){return e(this,void 0,void 0,(function*(){const e=Ut(this,t).controller;yield e.maximizeItem(Ut(this,t).id),t.parent instanceof zt?yield t.parent.refreshReference():yield this.getMyWorkspace(t.parent).refreshReference()}))}restore(t){return e(this,void 0,void 0,(function*(){const e=Ut(this,t).controller;yield e.restoreItem(Ut(this,t).id),t.parent instanceof zt?yield t.parent.refreshReference():yield this.getMyWorkspace(t.parent).refreshReference()}))}close(t){return e(this,void 0,void 0,(function*(){const e=Ut(this,t),r=Ut(this,t).controller;yield r.closeItem(e.id),e.parent instanceof zt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}lockContainer(t,r){return e(this,void 0,void 0,(function*(){const e=Ut(this,t),i=Ut(this,t).controller;yield i.lockContainer(e.id,t.type,r),e.parent instanceof zt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}getAllowDrop(e){return Ut(this,e).config.allowDrop}getAllowDropLeft(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Property allowDropLeft is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropLeft}getAllowDropRight(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Property allowDropRight is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropRight}getAllowDropTop(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Property allowDropTop is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropTop}getAllowDropBottom(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Property allowDropBottom is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropBottom}getAllowDropHeader(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Property allowDropHeader is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropHeader}getAllowSplitters(e){const t=Ut(this,e);if("group"===t.type)throw new Error("Cannot get allow splitters from private data "+t.type);return t.config.allowSplitters}getAllowExtract(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Cannot get allow extract from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.allowExtract}getShowMaximizeButton(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Cannot get show maximize button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showMaximizeButton}getShowEjectButton(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Cannot get show eject button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showEjectButton}getShowAddWindowButton(e){const t=Ut(this,e);if("group"!==t.type)throw new Error(`Cannot get add window button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showAddWindowButton}getMinWidth(e){return Ut(this,e).config.minWidth}getMaxWidth(e){return Ut(this,e).config.maxWidth}getMinHeight(e){return Ut(this,e).config.minHeight}getMaxHeight(e){return Ut(this,e).config.maxHeight}getWidthInPx(e){return Ut(this,e).config.widthInPx}getHeightInPx(e){return Ut(this,e).config.heightInPx}getIsPinned(e){return Ut(this,e).config.isPinned}getIsMaximized(e){return Ut(this,e).config.isMaximized}setHeight(t,r){return e(this,void 0,void 0,(function*(){const e=Ut(this,t),{controller:i}=e;yield i.resizeItem(Ut(this,t).id,{height:r}),e.parent instanceof zt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}setWidth(t,r){return e(this,void 0,void 0,(function*(){const e=Ut(this,t),{controller:i}=e;yield i.resizeItem(Ut(this,t).id,{width:r}),e.parent instanceof zt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}setSize(t,r,i){return e(this,void 0,void 0,(function*(){const e=Ut(this,t),{controller:o}=e;yield o.resizeItem(Ut(this,t).id,{width:r,height:i}),e.parent instanceof zt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}transformDefinition(e,t){let r;return void 0===t?r={type:e,children:[]}:t instanceof Wt?r=t.serialize():(void 0===t.type&&(t.type=e),r=V.runWithException(t),r.children=r.children||[]),r}}class Qt{constructor(e,t,r,i){this.ioc=e,this.windows=t,this.contexts=r,this.layouts=i}get bridge(){return this.ioc.bridge}get privateDataManager(){return this.ioc.privateDataManager}checkIsWindowLoaded(e){return e&&this.windows.list().some(t=>t.id===e)}createWorkspace(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(gt.createWorkspace.name,t),r={summary:e.frameSummary},i={frame:this.ioc.getModel("frame",r),snapshot:e};return this.ioc.getModel("workspace",i)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(gt.openWorkspace.name,{name:t,restoreOptions:r}),i={summary:yield this.bridge.send(gt.getFrameSummary.name,{itemId:e.config.frameId})},o={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",o)}))}add(t,r,i,o){return e(this,void 0,void 0,(function*(){let e;const n={definition:o,parentId:r,parentType:i};if("window"===t)e=gt.addWindow.name;else{if("container"!==t)throw new Error("Unrecognized add type: "+t);e=gt.addContainer.name}return yield this.bridge.send(e,n)}))}getFrame(t){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(gt.getFrameSummary.name,{itemId:t})};return this.ioc.getModel("frame",e)}))}getFrames(e,t){return e.reduce((e,r)=>{const i={summary:r},o=this.ioc.getModel("frame",i);return t&&!t(o)||e.push(o),e},[])}getAllWorkspaceSummaries(...e){return e.reduce((e,t)=>(e.push(...t.summaries),e),[]).map(e=>Object.assign({},{id:e.id,width:e.config.widthInPx,height:e.config.heightInPx},e.config))}handleOnSaved(e){const t=t=>{"Workspace"===t.type&&e(t)},r=this.layouts.onAdded(t),i=this.layouts.onChanged(t);return()=>{r(),i()}}handleOnRemoved(e){return this.layouts.onRemoved(t=>{"Workspace"===t.type&&e(t)})}transformStreamPayloadToWorkspace(t){return e(this,void 0,void 0,(function*(){const e={summary:t.frameSummary},r={frame:this.ioc.getModel("frame",e),snapshot:t.workspaceSnapshot||(yield this.bridge.send(gt.getWorkspaceSnapshot.name,{itemId:t.workspaceSummary.id}))};return this.ioc.getModel("workspace",r)}))}fetchWorkspace(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(gt.getWorkspaceSnapshot.name,{itemId:t}),r={summary:e.frameSummary},i={frame:this.ioc.getModel("frame",r),snapshot:e};return this.ioc.getModel("workspace",i)}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.bundleWorkspace.name,{type:t,workspaceId:r})}))}getWorkspaceContext(e){const t="___workspace___"+e;return this.contexts.get(t)}setWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.set(r,t)}updateWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.update(r,t)}subscribeWorkspaceContextUpdated(e,t){const r="___workspace___"+e;return this.contexts.subscribe(r,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.restoreItem.name,{itemId:t})}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.maximizeItem.name,{itemId:t})}))}focusItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.focusItem.name,{itemId:t})}))}closeItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.closeItem.name,{itemId:t})}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.resizeItem.name,Object.assign({},{itemId:t},r))}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.moveFrame.name,Object.assign({},{itemId:t},r))}))}getGDWindow(e){return this.windows.list().find(t=>t.id===e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.forceLoadWindow.name,{itemId:t})).windowId}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(gt.ejectWindow.name,{itemId:t})}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.moveWindowTo.name,{itemId:t,containerId:r})}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){let e;return"workspace"===r?e=yield this.bridge.send(gt.getWorkspaceSnapshot.name,{itemId:t}):"frame"===r&&(e=yield this.bridge.send(gt.getFrameSnapshot.name,{itemId:t})),e}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.setItemTitle.name,{itemId:t,title:r})}))}refreshChildren(e){const{parent:t,children:r,existingChildren:i,workspace:o}=e;if(t instanceof Ot||"window"===t.type)return;const n=r.map(e=>{let r=i.find(t=>"window"===t.type?t.elementId===e.id:t.id===e.id);if(r)this.privateDataManager.remapChild(r,{parent:t,children:[],config:e.config});else{let i;i="window"===e.type?{id:e.id,parent:t,frame:o.frame,workspace:o,config:e.config}:{id:e.id,parent:t,frame:o.frame,workspace:o,config:e.config,children:[]},r=this.ioc.getModel(e.type,i)}return"window"!==e.type&&this.refreshChildren({workspace:o,existingChildren:i,children:e.children,parent:r}),r});return t instanceof zt||this.privateDataManager.remapChild(t,{children:n}),n}iterateFindChild(e,t){let r=e.find(e=>t(e));return r||(e.some(e=>!(e instanceof Ot)&&(r=this.iterateFindChild(e.children,t),!!r||void 0)),r)}iterateFilterChildren(e,t){const r=e.filter(e=>t(e)),i=e.reduce((e,r)=>(r instanceof Ot||e.push(...this.iterateFilterChildren(r.children,t)),e),[]);return r.push(...i),r}notifyWindowAdded(e){return new Promise(t=>{if(this.windows.list().some(t=>t.id===e))return t();const r=this.windows.onWindowAdded(i=>{i.id===e&&(r&&r(),t())})})}hibernateWorkspace(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.hibernateWorkspace.name,{workspaceId:t})}))}resumeWorkspace(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.resumeWorkspace.name,{workspaceId:t})}))}lockWorkspace(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.lockWorkspace.name,{workspaceId:t,config:r})}))}lockWindow(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.lockWindow.name,{windowPlacementId:t,config:r})}))}lockContainer(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.lockContainer.name,{itemId:t,type:r,config:i})}))}}class Vt{constructor(e,t){this.bridge=e,this.base=t}checkIsWindowLoaded(e){return this.base.checkIsWindowLoaded(e)}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.isWindowInWorkspace.name,{itemId:t})).inWorkspace}))}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r});return yield this.base.createWorkspace(e)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);if(null==r?void 0:r.frameId){if(!(yield this.bridge.send(gt.getAllFramesSummaries.name)).summaries.some(e=>e.id===r.frameId))throw new Error(`Cannot reuse the frame with id: ${r.frameId}, because there is no frame with that ID found`)}return yield this.base.restoreWorkspace(t,r)}))}add(t,r,i,o){return e(this,void 0,void 0,(function*(){return yield this.base.add(t,r,i,o)}))}processLocalSubscription(e,t){return window.glue42gd?this.handleEnterpriseLocalSubscription(e,t):this.handleCoreLocalSubscription(e,t)}processGlobalSubscription(e,t,r){return window.glue42gd?this.handleEnterpriseGlobalSubscription(e,t,r):this.handleCoreGlobalSubscription(e,t,r)}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId)return yield this.base.getFrame(t.windowId);if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(gt.getAllFramesSummaries.name);return this.base.getFrames(e.summaries,t)}))}getWorkspaceById(e){return this.base.fetchWorkspace(e)}transformStreamPayloadToWorkspace(e){return this.base.transformStreamPayloadToWorkspace(e)}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getWorkspacesByFrameId(t){return e(this,void 0,void 0,(function*(){const e=(yield this.getAllWorkspaceSummaries()).filter(e=>e.frameId===t);return yield Promise.all(e.map(e=>this.base.fetchWorkspace(e.id)))}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(gt.getAllWorkspacesSummaries.name,{});return this.base.getAllWorkspaceSummaries(e)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const o=r.getWindow(t);o&&(e=o,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const o=r.getBox(t);o&&(e=o,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.getAllLayoutsSummaries.name)).summaries}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.deleteLayout.name,{name:t})}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.exportAllLayouts.name)).layouts.reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}saveLayout(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(gt.saveLayout.name,t)}))}importLayout(t,r){return e(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>this.bridge.send(gt.importLayout.name,{layout:e,mode:r})))}))}handleOnSaved(e){return this.base.handleOnSaved(e)}handleOnRemoved(e){return this.base.handleOnRemoved(e)}bundleTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.bundleTo(t,r)}))}getWorkspaceContext(e){return this.base.getWorkspaceContext(e)}setWorkspaceContext(e,t){return this.base.setWorkspaceContext(e,t)}updateWorkspaceContext(e,t){return this.base.updateWorkspaceContext(e,t)}subscribeWorkspaceContextUpdated(e,t){return this.base.subscribeWorkspaceContextUpdated(e,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.restoreItem(t)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.maximizeItem(t)}))}focusItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.focusItem(t)}))}changeFrameState(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(gt.changeFrameState.name,{frameId:t,requestedState:r})}))}getFrameBounds(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.getFrameBounds.name,{itemId:t})).bounds}))}getFrameState(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(gt.getFrameState.name,{itemId:t})).state}))}closeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.closeItem(t)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.resizeItem(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.base.forceLoadWindow(t);return yield this.base.notifyWindowAdded(e),e}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=(yield this.base.ejectWindow(t)).windowId;return yield this.base.notifyWindowAdded(e),e}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveWindowTo(t,r)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.getSnapshot(t,r)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.setItemTitle(t,r)}))}flatChildren(e){return e.reduce((e,t)=>(e.push(t),"window"!==t.type&&e.push(...this.flatChildren(t.children)),e),[])}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}hibernateWorkspace(e){return this.base.hibernateWorkspace(e)}resumeWorkspace(e){return this.base.resumeWorkspace(e)}lockWorkspace(e,t){return this.base.lockWorkspace(e,t)}lockWindow(e,t){return this.base.lockWindow(e,t)}lockContainer(e,t,r){return this.base.lockContainer(e,t,r)}getFrameConstraints(t){return e(this,void 0,void 0,(function*(){const e=yield this.getSnapshot(t,"frame");return{minWidth:e.config.minWidth,maxWidth:e.config.maxWidth,minHeight:e.config.minHeight,maxHeight:e.config.maxHeight}}))}handleCoreLocalSubscription(t,r){return e(this,void 0,void 0,(function*(){if(yield this.bridge.createCoreEventSubscription(),t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.handleCoreSubscription(t)}))}handleEnterpriseLocalSubscription(t,r){if(t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.subscribe(t)}handleCoreGlobalSubscription(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.createCoreEventSubscription();const o={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));o.callback=r}return this.bridge.handleCoreSubscription(o)}))}handleEnterpriseGlobalSubscription(t,r,i){const o={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));o.callback=r}return this.bridge.subscribe(o)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const o of i){if(e)return;const i=yield this.base.fetchWorkspace(o.id);t(i,r)}}))}}class Xt{constructor(e,t,r,i){this.agm=e,this.windows=t,this.layouts=r,this.contexts=i}get baseController(){return this._baseController||(this._baseController=new Qt(this,this.windows,this.contexts,this.layouts)),this._baseController}get controller(){return this._controllerInstance||(this._controllerInstance=new Vt(this.bridge,this.baseController)),this._controllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new yt(this.transport,r())),this._bridgeInstance}get transport(){return this._transportInstance||(this._transportInstance=new vt(this.agm)),this._transportInstance}get privateDataManager(){return this._privateDataManagerInstance||(this._privateDataManagerInstance=new Nt),this._privateDataManagerInstance}get parentBase(){return this._parentBaseInstance||(this._parentBaseInstance=new qt(this.privateDataManager)),this._parentBaseInstance}initiate(t){return e(this,void 0,void 0,(function*(){yield this.transport.initiate(t)}))}getModel(e,t){switch(e){case"frame":{const e=new Gt(this.privateDataManager),{summary:r}=t,i={summary:r,controller:this.controller};return this.privateDataManager.setFrameData(e,i),e}case"window":{const{id:e,parent:r,frame:i,workspace:o,config:n}=t,s={type:"window",controller:this.controller,config:n,id:e,parent:r,frame:i,workspace:o},a=new Ot(this.privateDataManager);return this.privateDataManager.setWindowData(a,s),a}case"row":case"column":case"group":{const{id:r,children:i,parent:o,frame:n,workspace:s,config:a}=t,d="column"===e?new Mt(this.parentBase):"row"===e?new Ct(this.parentBase):new Tt(this.parentBase),c=this.buildChildren(i,n,s,d),h={id:r,parent:o,frame:n,workspace:s,config:a,type:e,controller:this.controller,children:c};return this.privateDataManager.setParentData(d,h),d}case"workspace":{const{snapshot:e,frame:r}=t,i=new zt(this.privateDataManager),o=this.buildChildren(e.children,r,i,i),n={id:e.id,type:"workspace",config:e.config,base:this.parentBase,controller:this.controller,children:o,frame:r,ioc:this};return this.privateDataManager.setWorkspaceData(i,n),i}default:throw new Error("Unrecognized type: "+e)}}getBuilder(e){e.definition=e.definition||{},Array.isArray(e.definition.children)||(e.definition.children=[]);const t=new bt(this.getBuilder.bind(this));switch(e.type){case"workspace":return new xt(e.definition,t,this.controller);case"row":case"column":case"group":return e.definition.type=e.type,new Wt(e.definition,t);default:throw new Error("Unexpected Builder creation error, provided config: "+JSON.stringify(e))}}buildChildren(e,t,r,i){return e.map(e=>{switch(e.type){case"window":return this.getModel("window",{id:e.id,config:e.config,frame:t,workspace:r,parent:i});case"column":case"row":case"group":return this.getModel(e.type,{id:e.id,config:e.config,children:e.children,frame:t,workspace:r,parent:i});default:throw new Error("Unsupported child type: "+e.type)}})}}const Yt=t=>e(void 0,void 0,void 0,(function*(){const r=new Xt(t.agm,t.windows,t.layouts,t.contexts),i=t.interop.instance.windowId;yield r.initiate(i),t.workspaces=((t,r)=>{const i=r.controller;return{inWorkspace:()=>{const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");return i.checkIsInSwimlane(e)},getBuilder:e=>{const t=re.runWithException(e);return r.getBuilder(t)},getMyFrame:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your frame, because this window is not in a workspace");return i.getFrame({windowId:e})})),getFrame:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getFrame({predicate:t})})),getAllFrames:t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.getFrames(t)})),getAllWorkspacesSummaries:()=>i.getAllWorkspaceSummaries(),getMyWorkspace:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my workspace, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your workspace, because this window is not in a workspace");return(yield i.getWorkspaces(t=>!!t.getWindow(t=>t.id===e)))[0]})),getWorkspace:t=>e(void 0,void 0,void 0,(function*(){return z(t),(yield i.getWorkspaces(t))[0]})),getWorkspaceById:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),i.getWorkspaceById(t)})),getAllWorkspaces:e=>(z(e,!0),i.getWorkspaces(e)),getWindow:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getWindow(t)})),getBox:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getParent(t)})),restoreWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){M.runWithException(t);const e=Z.runWithException(r);return i.restoreWorkspace(t,e)})),createWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){const e=te.runWithException(t),o=H.runWithException(r);return i.createWorkspace(e,o)})),layouts:{getSummaries:()=>i.getLayoutSummaries(),delete:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),i.deleteLayout(t)})),export:t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.exportLayout(t)})),import:(t,r="replace")=>e(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))throw new Error("The provided layouts argument is not an array: "+JSON.stringify(t));return t.forEach(e=>We.runWithException(e)),i.importLayout(t,r)})),save:t=>e(void 0,void 0,void 0,(function*(){const e=Ze.runWithException(t);return i.saveLayout(e)})),onSaved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnSaved(t)})),onRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnRemoved(t)}))},onFrameOpened:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},o=r.getModel("frame",i);t(o)},"frame","opened")})),onFrameClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id})},"frame","closed")})),onWorkspaceOpened:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(r=>e(void 0,void 0,void 0,(function*(){const e=yield i.transformStreamPayloadToWorkspace(r);t(e)})),"workspace","opened")})),onWorkspaceClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},"workspace","closed")})),onWindowAdded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(o=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(o.windowSummary.config.workspaceId,"workspace"),n={summary:e.frameSummary},s={frame:r.getModel("frame",n),snapshot:e},a=r.getModel("workspace",s).getBox(e=>e.id===o.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===o.windowSummary.config.positionIndex);t(a)})),"window","added")})),onWindowLoaded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(o=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(o.windowSummary.config.workspaceId,"workspace"),n={summary:e.frameSummary},s={frame:r.getModel("frame",n),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===o.windowSummary.config.windowId);t(a)})),"window","loaded")})),onWindowRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const{windowId:r,workspaceId:i,frameId:o}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:o})},"window","removed")}))}})(t,r)}));return"undefined"!=typeof window&&(window.GlueWorkspaces=Yt),Yt}));
//# sourceMappingURL=workspaces.umd.min.js.map
