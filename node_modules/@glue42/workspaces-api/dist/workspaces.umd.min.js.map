{"version":3,"file":"workspaces.umd.min.js","sources":["../node_modules/callback-registry/lib/index.js","../node_modules/decoder-validate/dist/index.es5.js","../src/shared/decoders.ts","../src/communication/constants.ts","../src/communication/bridge.ts","../src/communication/interop-transport.ts","../src/shared/promisePlus.ts","../src/builders/parentBuilder.ts","../src/builders/baseBuilder.ts","../src/builders/workspaceBuilder.ts","../src/models/row.ts","../src/models/column.ts","../src/models/group.ts","../src/models/workspace.ts","../src/models/window.ts","../src/models/frame.ts","../src/shared/privateDataManager.ts","../src/models/base/base.ts","../src/controllers/base.ts","../src/controllers/main.ts","../src/shared/ioc.ts","../src/main.ts","../src/index.ts"],"sourcesContent":["\"use strict\";\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map","/**\r\n * Wraps values in an `Ok` type.\r\n *\r\n * Example: `ok(5) // => {ok: true, result: 5}`\r\n */\r\nvar ok = function (result) { return ({ ok: true, result: result }); };\r\n/**\r\n * Typeguard for `Ok`.\r\n */\r\nvar isOk = function (r) { return r.ok === true; };\r\n/**\r\n * Wraps errors in an `Err` type.\r\n *\r\n * Example: `err('on fire') // => {ok: false, error: 'on fire'}`\r\n */\r\nvar err = function (error) { return ({ ok: false, error: error }); };\r\n/**\r\n * Typeguard for `Err`.\r\n */\r\nvar isErr = function (r) { return r.ok === false; };\r\n/**\r\n * Create a `Promise` that either resolves with the result of `Ok` or rejects\r\n * with the error of `Err`.\r\n */\r\nvar asPromise = function (r) {\r\n    return r.ok === true ? Promise.resolve(r.result) : Promise.reject(r.error);\r\n};\r\n/**\r\n * Unwraps a `Result` and returns either the result of an `Ok`, or\r\n * `defaultValue`.\r\n *\r\n * Example:\r\n * ```\r\n * Result.withDefault(5, number().run(json))\r\n * ```\r\n *\r\n * It would be nice if `Decoder` had an instance method that mirrored this\r\n * function. Such a method would look something like this:\r\n * ```\r\n * class Decoder<A> {\r\n *   runWithDefault = (defaultValue: A, json: any): A =>\r\n *     Result.withDefault(defaultValue, this.run(json));\r\n * }\r\n *\r\n * number().runWithDefault(5, json)\r\n * ```\r\n * Unfortunately, the type of `defaultValue: A` on the method causes issues\r\n * with type inference on  the `object` decoder in some situations. While these\r\n * inference issues can be solved by providing the optional type argument for\r\n * `object`s, the extra trouble and confusion doesn't seem worth it.\r\n */\r\nvar withDefault = function (defaultValue, r) {\r\n    return r.ok === true ? r.result : defaultValue;\r\n};\r\n/**\r\n * Return the successful result, or throw an error.\r\n */\r\nvar withException = function (r) {\r\n    if (r.ok === true) {\r\n        return r.result;\r\n    }\r\n    else {\r\n        throw r.error;\r\n    }\r\n};\r\n/**\r\n * Given an array of `Result`s, return the successful values.\r\n */\r\nvar successes = function (results) {\r\n    return results.reduce(function (acc, r) { return (r.ok === true ? acc.concat(r.result) : acc); }, []);\r\n};\r\n/**\r\n * Apply `f` to the result of an `Ok`, or pass the error through.\r\n */\r\nvar map = function (f, r) {\r\n    return r.ok === true ? ok(f(r.result)) : r;\r\n};\r\n/**\r\n * Apply `f` to the result of two `Ok`s, or pass an error through. If both\r\n * `Result`s are errors then the first one is returned.\r\n */\r\nvar map2 = function (f, ar, br) {\r\n    return ar.ok === false ? ar :\r\n        br.ok === false ? br :\r\n            ok(f(ar.result, br.result));\r\n};\r\n/**\r\n * Apply `f` to the error of an `Err`, or pass the success through.\r\n */\r\nvar mapError = function (f, r) {\r\n    return r.ok === true ? r : err(f(r.error));\r\n};\r\n/**\r\n * Chain together a sequence of computations that may fail, similar to a\r\n * `Promise`. If the first computation fails then the error will propagate\r\n * through. If it succeeds, then `f` will be applied to the value, returning a\r\n * new `Result`.\r\n */\r\nvar andThen = function (f, r) {\r\n    return r.ok === true ? f(r.result) : r;\r\n};\r\n\r\n\r\nvar result = Object.freeze({\r\n\tok: ok,\r\n\tisOk: isOk,\r\n\terr: err,\r\n\tisErr: isErr,\r\n\tasPromise: asPromise,\r\n\twithDefault: withDefault,\r\n\twithException: withException,\r\n\tsuccesses: successes,\r\n\tmap: map,\r\n\tmap2: map2,\r\n\tmapError: mapError,\r\n\tandThen: andThen\r\n});\r\n\r\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction isEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a === null && b === null) {\r\n        return true;\r\n    }\r\n    if (typeof (a) !== typeof (b)) {\r\n        return false;\r\n    }\r\n    if (typeof (a) === 'object') {\r\n        // Array\r\n        if (Array.isArray(a)) {\r\n            if (!Array.isArray(b)) {\r\n                return false;\r\n            }\r\n            if (a.length !== b.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (!isEqual(a[i], b[i])) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        // Hash table\r\n        var keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!b.hasOwnProperty(keys[i])) {\r\n                return false;\r\n            }\r\n            if (!isEqual(a[keys[i]], b[keys[i]])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n/**\r\n * Type guard for `DecoderError`. One use case of the type guard is in the\r\n * `catch` of a promise. Typescript types the error argument of `catch` as\r\n * `any`, so when dealing with a decoder as a promise you may need to\r\n * distinguish between a `DecoderError` and an error string.\r\n */\r\nvar isDecoderError = function (a) {\r\n    return a.kind === 'DecoderError' && typeof a.at === 'string' && typeof a.message === 'string';\r\n};\r\n/*\r\n * Helpers\r\n */\r\nvar isJsonArray = function (json) { return Array.isArray(json); };\r\nvar isJsonObject = function (json) {\r\n    return typeof json === 'object' && json !== null && !isJsonArray(json);\r\n};\r\nvar typeString = function (json) {\r\n    switch (typeof json) {\r\n        case 'string':\r\n            return 'a string';\r\n        case 'number':\r\n            return 'a number';\r\n        case 'boolean':\r\n            return 'a boolean';\r\n        case 'undefined':\r\n            return 'undefined';\r\n        case 'object':\r\n            if (json instanceof Array) {\r\n                return 'an array';\r\n            }\r\n            else if (json === null) {\r\n                return 'null';\r\n            }\r\n            else {\r\n                return 'an object';\r\n            }\r\n        default:\r\n            return JSON.stringify(json);\r\n    }\r\n};\r\nvar expectedGot = function (expected, got) {\r\n    return \"expected \" + expected + \", got \" + typeString(got);\r\n};\r\nvar printPath = function (paths) {\r\n    return paths.map(function (path) { return (typeof path === 'string' ? \".\" + path : \"[\" + path + \"]\"); }).join('');\r\n};\r\nvar prependAt = function (newAt, _a) {\r\n    var at = _a.at, rest = __rest(_a, [\"at\"]);\r\n    return (__assign({ at: newAt + (at || '') }, rest));\r\n};\r\n/**\r\n * Decoders transform json objects with unknown structure into known and\r\n * verified forms. You can create objects of type `Decoder<A>` with either the\r\n * primitive decoder functions, such as `boolean()` and `string()`, or by\r\n * applying higher-order decoders to the primitives, such as `array(boolean())`\r\n * or `dict(string())`.\r\n *\r\n * Each of the decoder functions are available both as a static method on\r\n * `Decoder` and as a function alias -- for example the string decoder is\r\n * defined at `Decoder.string()`, but is also aliased to `string()`. Using the\r\n * function aliases exported with the library is recommended.\r\n *\r\n * `Decoder` exposes a number of 'run' methods, which all decode json in the\r\n * same way, but communicate success and failure in different ways. The `map`\r\n * and `andThen` methods modify decoders without having to call a 'run' method.\r\n *\r\n * Alternatively, the main decoder `run()` method returns an object of type\r\n * `Result<A, DecoderError>`. This library provides a number of helper\r\n * functions for dealing with the `Result` type, so you can do all the same\r\n * things with a `Result` as with the decoder methods.\r\n */\r\nvar Decoder = /** @class */ (function () {\r\n    /**\r\n     * The Decoder class constructor is kept private to separate the internal\r\n     * `decode` function from the external `run` function. The distinction\r\n     * between the two functions is that `decode` returns a\r\n     * `Partial<DecoderError>` on failure, which contains an unfinished error\r\n     * report. When `run` is called on a decoder, the relevant series of `decode`\r\n     * calls is made, and then on failure the resulting `Partial<DecoderError>`\r\n     * is turned into a `DecoderError` by filling in the missing information.\r\n     *\r\n     * While hiding the constructor may seem restrictive, leveraging the\r\n     * provided decoder combinators and helper functions such as\r\n     * `andThen` and `map` should be enough to build specialized decoders as\r\n     * needed.\r\n     */\r\n    function Decoder(decode) {\r\n        var _this = this;\r\n        this.decode = decode;\r\n        /**\r\n         * Run the decoder and return a `Result` with either the decoded value or a\r\n         * `DecoderError` containing the json input, the location of the error, and\r\n         * the error message.\r\n         *\r\n         * Examples:\r\n         * ```\r\n         * number().run(12)\r\n         * // => {ok: true, result: 12}\r\n         *\r\n         * string().run(9001)\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {\r\n         * //     kind: 'DecoderError',\r\n         * //     input: 9001,\r\n         * //     at: 'input',\r\n         * //     message: 'expected a string, got 9001'\r\n         * //   }\r\n         * // }\r\n         * ```\r\n         */\r\n        this.run = function (json) {\r\n            return mapError(function (error) { return ({\r\n                kind: 'DecoderError',\r\n                input: json,\r\n                at: 'input' + (error.at || ''),\r\n                message: error.message || ''\r\n            }); }, _this.decode(json));\r\n        };\r\n        /**\r\n         * Run the decoder as a `Promise`.\r\n         */\r\n        this.runPromise = function (json) { return asPromise(_this.run(json)); };\r\n        /**\r\n         * Run the decoder and return the value on success, or throw an exception\r\n         * with a formatted error string.\r\n         */\r\n        this.runWithException = function (json) { return withException(_this.run(json)); };\r\n        /**\r\n         * Construct a new decoder that applies a transformation to the decoded\r\n         * result. If the decoder succeeds then `f` will be applied to the value. If\r\n         * it fails the error will propagated through.\r\n         *\r\n         * Example:\r\n         * ```\r\n         * number().map(x => x * 5).run(10)\r\n         * // => {ok: true, result: 50}\r\n         * ```\r\n         */\r\n        this.map = function (f) {\r\n            return new Decoder(function (json) { return map(f, _this.decode(json)); });\r\n        };\r\n        /**\r\n         * Chain together a sequence of decoders. The first decoder will run, and\r\n         * then the function will determine what decoder to run second. If the result\r\n         * of the first decoder succeeds then `f` will be applied to the decoded\r\n         * value. If it fails the error will propagate through.\r\n         *\r\n         * This is a very powerful method -- it can act as both the `map` and `where`\r\n         * methods, can improve error messages for edge cases, and can be used to\r\n         * make a decoder for custom types.\r\n         *\r\n         * Example of adding an error message:\r\n         * ```\r\n         * const versionDecoder = valueAt(['version'], number());\r\n         * const infoDecoder3 = object({a: boolean()});\r\n         *\r\n         * const decoder = versionDecoder.andThen(version => {\r\n         *   switch (version) {\r\n         *     case 3:\r\n         *       return infoDecoder3;\r\n         *     default:\r\n         *       return fail(`Unable to decode info, version ${version} is not supported.`);\r\n         *   }\r\n         * });\r\n         *\r\n         * decoder.run({version: 3, a: true})\r\n         * // => {ok: true, result: {a: true}}\r\n         *\r\n         * decoder.run({version: 5, x: 'abc'})\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {... message: 'Unable to decode info, version 5 is not supported.'}\r\n         * // }\r\n         * ```\r\n         *\r\n         * Example of decoding a custom type:\r\n         * ```\r\n         * // nominal type for arrays with a length of at least one\r\n         * type NonEmptyArray<T> = T[] & { __nonEmptyArrayBrand__: void };\r\n         *\r\n         * const nonEmptyArrayDecoder = <T>(values: Decoder<T>): Decoder<NonEmptyArray<T>> =>\r\n         *   array(values).andThen(arr =>\r\n         *     arr.length > 0\r\n         *       ? succeed(createNonEmptyArray(arr))\r\n         *       : fail(`expected a non-empty array, got an empty array`)\r\n         *   );\r\n         * ```\r\n         */\r\n        this.andThen = function (f) {\r\n            return new Decoder(function (json) {\r\n                return andThen(function (value) { return f(value).decode(json); }, _this.decode(json));\r\n            });\r\n        };\r\n        /**\r\n         * Add constraints to a decoder _without_ changing the resulting type. The\r\n         * `test` argument is a predicate function which returns true for valid\r\n         * inputs. When `test` fails on an input, the decoder fails with the given\r\n         * `errorMessage`.\r\n         *\r\n         * ```\r\n         * const chars = (length: number): Decoder<string> =>\r\n         *   string().where(\r\n         *     (s: string) => s.length === length,\r\n         *     `expected a string of length ${length}`\r\n         *   );\r\n         *\r\n         * chars(5).run('12345')\r\n         * // => {ok: true, result: '12345'}\r\n         *\r\n         * chars(2).run('HELLO')\r\n         * // => {ok: false, error: {... message: 'expected a string of length 2'}}\r\n         *\r\n         * chars(12).run(true)\r\n         * // => {ok: false, error: {... message: 'expected a string, got a boolean'}}\r\n         * ```\r\n         */\r\n        this.where = function (test, errorMessage) {\r\n            return _this.andThen(function (value) { return (test(value) ? Decoder.succeed(value) : Decoder.fail(errorMessage)); });\r\n        };\r\n    }\r\n    /**\r\n     * Decoder primitive that validates strings, and fails on all other input.\r\n     */\r\n    Decoder.string = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'string'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a string', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates numbers, and fails on all other input.\r\n     */\r\n    Decoder.number = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'number'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a number', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates booleans, and fails on all other input.\r\n     */\r\n    Decoder.boolean = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'boolean'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a boolean', json) });\r\n        });\r\n    };\r\n    Decoder.constant = function (value) {\r\n        return new Decoder(function (json) {\r\n            return isEqual(json, value)\r\n                ? ok(value)\r\n                : err({ message: \"expected \" + JSON.stringify(value) + \", got \" + JSON.stringify(json) });\r\n        });\r\n    };\r\n    Decoder.object = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json) && decoders) {\r\n                var obj = {};\r\n                for (var key in decoders) {\r\n                    if (decoders.hasOwnProperty(key)) {\r\n                        var r = decoders[key].decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            // tslint:disable-next-line:strict-type-predicates\r\n                            if (r.result !== undefined) {\r\n                                obj[key] = r.result;\r\n                            }\r\n                        }\r\n                        else if (json[key] === undefined) {\r\n                            return err({ message: \"the key '\" + key + \"' is required but was not present\" });\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else if (isJsonObject(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.array = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json) && decoder) {\r\n                var decodeValue_1 = function (v, i) {\r\n                    return mapError(function (err$$1) { return prependAt(\"[\" + i + \"]\", err$$1); }, decoder.decode(v));\r\n                };\r\n                return json.reduce(function (acc, v, i) {\r\n                    return map2(function (arr, result) { return arr.concat([result]); }, acc, decodeValue_1(v, i));\r\n                }, ok([]));\r\n            }\r\n            else if (isJsonArray(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an array', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.tuple = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json)) {\r\n                if (json.length !== decoders.length) {\r\n                    return err({\r\n                        message: \"expected a tuple of length \" + decoders.length + \", got one of length \" + json.length\r\n                    });\r\n                }\r\n                var result = [];\r\n                for (var i = 0; i < decoders.length; i++) {\r\n                    var nth = decoders[i].decode(json[i]);\r\n                    if (nth.ok) {\r\n                        result[i] = nth.result;\r\n                    }\r\n                    else {\r\n                        return err(prependAt(\"[\" + i + \"]\", nth.error));\r\n                    }\r\n                }\r\n                return ok(result);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot(\"a tuple of length \" + decoders.length, json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.union = function (ad, bd) {\r\n        var decoders = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            decoders[_i - 2] = arguments[_i];\r\n        }\r\n        return Decoder.oneOf.apply(Decoder, [ad, bd].concat(decoders));\r\n    };\r\n    Decoder.intersection = function (ad, bd) {\r\n        var ds = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            ds[_i - 2] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            return [ad, bd].concat(ds).reduce(function (acc, decoder) { return map2(Object.assign, acc, decoder.decode(json)); }, ok({}));\r\n        });\r\n    };\r\n    /**\r\n     * Escape hatch to bypass validation. Always succeeds and types the result as\r\n     * `any`. Useful for defining decoders incrementally, particularly for\r\n     * complex objects.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   name: string;\r\n     *   complexUserData: ComplexType;\r\n     * }\r\n     *\r\n     * const userDecoder: Decoder<User> = object({\r\n     *   name: string(),\r\n     *   complexUserData: anyJson()\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.anyJson = function () { return new Decoder(function (json) { return ok(json); }); };\r\n    /**\r\n     * Decoder identity function which always succeeds and types the result as\r\n     * `unknown`.\r\n     */\r\n    Decoder.unknownJson = function () {\r\n        return new Decoder(function (json) { return ok(json); });\r\n    };\r\n    /**\r\n     * Decoder for json objects where the keys are unknown strings, but the values\r\n     * should all be of the same type.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * dict(number()).run({chocolate: 12, vanilla: 10, mint: 37});\r\n     * // => {ok: true, result: {chocolate: 12, vanilla: 10, mint: 37}}\r\n     * ```\r\n     */\r\n    Decoder.dict = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json)) {\r\n                var obj = {};\r\n                for (var key in json) {\r\n                    if (json.hasOwnProperty(key)) {\r\n                        var r = decoder.decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            obj[key] = r.result;\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Decoder for values that may be `undefined`. This is primarily helpful for\r\n     * decoding interfaces with optional fields.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   id: number;\r\n     *   isOwner?: boolean;\r\n     * }\r\n     *\r\n     * const decoder: Decoder<User> = object({\r\n     *   id: number(),\r\n     *   isOwner: optional(boolean())\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.optional = function (decoder) {\r\n        return new Decoder(function (json) { return (json === undefined || json === null ? ok(undefined) : decoder.decode(json)); });\r\n    };\r\n    /**\r\n     * Decoder that attempts to run each decoder in `decoders` and either succeeds\r\n     * with the first successful decoder, or fails after all decoders have failed.\r\n     *\r\n     * Note that `oneOf` expects the decoders to all have the same return type,\r\n     * while `union` creates a decoder for the union type of all the input\r\n     * decoders.\r\n     *\r\n     * Examples:\r\n     * ```\r\n     * oneOf(string(), number().map(String))\r\n     * oneOf(constant('start'), constant('stop'), succeed('unknown'))\r\n     * ```\r\n     */\r\n    Decoder.oneOf = function () {\r\n        var decoders = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            decoders[_i] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            var errors = [];\r\n            for (var i = 0; i < decoders.length; i++) {\r\n                var r = decoders[i].decode(json);\r\n                if (r.ok === true) {\r\n                    return r;\r\n                }\r\n                else {\r\n                    errors[i] = r.error;\r\n                }\r\n            }\r\n            var errorsList = errors\r\n                .map(function (error) { return \"at error\" + (error.at || '') + \": \" + error.message; })\r\n                .join('\", \"');\r\n            return err({\r\n                message: \"expected a value matching one of the decoders, got the errors [\\\"\" + errorsList + \"\\\"]\"\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that always succeeds with either the decoded value, or a fallback\r\n     * default value.\r\n     */\r\n    Decoder.withDefault = function (defaultValue, decoder) {\r\n        return new Decoder(function (json) {\r\n            return ok(withDefault(defaultValue, decoder.decode(json)));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that pulls a specific field out of a json structure, instead of\r\n     * decoding and returning the full structure. The `paths` array describes the\r\n     * object keys and array indices to traverse, so that values can be pulled out\r\n     * of a nested structure.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * const decoder = valueAt(['a', 'b', 0], string());\r\n     *\r\n     * decoder.run({a: {b: ['surprise!']}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * decoder.run({a: {x: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b[0]' message: 'path does not exist'}}\r\n     * ```\r\n     *\r\n     * Note that the `decoder` is ran on the value found at the last key in the\r\n     * path, even if the last key is not found. This allows the `optional`\r\n     * decoder to succeed when appropriate.\r\n     * ```\r\n     * const optionalDecoder = valueAt(['a', 'b', 'c'], optional(string()));\r\n     *\r\n     * optionalDecoder.run({a: {b: {c: 'surprise!'}}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * optionalDecoder.run({a: {b: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b.c' message: 'expected an object, got \"cats\"'}\r\n     *\r\n     * optionalDecoder.run({a: {b: {z: 1}}})\r\n     * // => {ok: true, result: undefined}\r\n     * ```\r\n     */\r\n    Decoder.valueAt = function (paths, decoder) {\r\n        return new Decoder(function (json) {\r\n            var jsonAtPath = json;\r\n            for (var i = 0; i < paths.length; i++) {\r\n                if (jsonAtPath === undefined) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: 'path does not exist'\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'string' && !isJsonObject(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an object', jsonAtPath)\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'number' && !isJsonArray(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an array', jsonAtPath)\r\n                    });\r\n                }\r\n                else {\r\n                    jsonAtPath = jsonAtPath[paths[i]];\r\n                }\r\n            }\r\n            return mapError(function (error) {\r\n                return jsonAtPath === undefined\r\n                    ? { at: printPath(paths), message: 'path does not exist' }\r\n                    : prependAt(printPath(paths), error);\r\n            }, decoder.decode(jsonAtPath));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always succeeds with `fixedValue`.\r\n     */\r\n    Decoder.succeed = function (fixedValue) {\r\n        return new Decoder(function (json) { return ok(fixedValue); });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always fails with `errorMessage`.\r\n     */\r\n    Decoder.fail = function (errorMessage) {\r\n        return new Decoder(function (json) { return err({ message: errorMessage }); });\r\n    };\r\n    /**\r\n     * Decoder that allows for validating recursive data structures. Unlike with\r\n     * functions, decoders assigned to variables can't reference themselves\r\n     * before they are fully defined. We can avoid prematurely referencing the\r\n     * decoder by wrapping it in a function that won't be called until use, at\r\n     * which point the decoder has been defined.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface Comment {\r\n     *   msg: string;\r\n     *   replies: Comment[];\r\n     * }\r\n     *\r\n     * const decoder: Decoder<Comment> = object({\r\n     *   msg: string(),\r\n     *   replies: lazy(() => array(decoder))\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.lazy = function (mkDecoder) {\r\n        return new Decoder(function (json) { return mkDecoder().decode(json); });\r\n    };\r\n    return Decoder;\r\n}());\r\n\r\n/* tslint:disable:variable-name */\r\n/** See `Decoder.string` */\r\nvar string = Decoder.string;\r\n/** See `Decoder.number` */\r\nvar number = Decoder.number;\r\n/** See `Decoder.boolean` */\r\nvar boolean = Decoder.boolean;\r\n/** See `Decoder.anyJson` */\r\nvar anyJson = Decoder.anyJson;\r\n/** See `Decoder.unknownJson` */\r\nvar unknownJson = Decoder.unknownJson;\r\n/** See `Decoder.constant` */\r\nvar constant = Decoder.constant;\r\n/** See `Decoder.object` */\r\nvar object = Decoder.object;\r\n/** See `Decoder.array` */\r\nvar array = Decoder.array;\r\n/** See `Decoder.tuple` */\r\nvar tuple = Decoder.tuple;\r\n/** See `Decoder.dict` */\r\nvar dict = Decoder.dict;\r\n/** See `Decoder.optional` */\r\nvar optional = Decoder.optional;\r\n/** See `Decoder.oneOf` */\r\nvar oneOf = Decoder.oneOf;\r\n/** See `Decoder.union` */\r\nvar union = Decoder.union;\r\n/** See `Decoder.intersection` */\r\nvar intersection = Decoder.intersection;\r\n/** See `Decoder.withDefault` */\r\nvar withDefault$1 = Decoder.withDefault;\r\n/** See `Decoder.valueAt` */\r\nvar valueAt = Decoder.valueAt;\r\n/** See `Decoder.succeed` */\r\nvar succeed = Decoder.succeed;\r\n/** See `Decoder.fail` */\r\nvar fail = Decoder.fail;\r\n/** See `Decoder.lazy` */\r\nvar lazy = Decoder.lazy;\r\n\r\nexport { result as Result, Decoder, isDecoderError, string, number, boolean, anyJson, unknownJson, constant, object, array, tuple, dict, optional, oneOf, union, intersection, withDefault$1 as withDefault, valueAt, succeed, fail, lazy };\r\n//# sourceMappingURL=index.es5.js.map\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/no-use-before-define */\r\nimport { Decoder, object, boolean, string, optional, array, oneOf, constant, lazy, number, anyJson, intersection } from \"decoder-validate\";\r\nimport {\r\n    IsWindowInSwimlaneResult,\r\n    WorkspaceSnapshotResult,\r\n    ChildSnapshotResult,\r\n    WorkspaceConfigResult,\r\n    FrameSummaryResult,\r\n    WorkspaceCreateConfigProtocol,\r\n    GetFrameSummaryConfig,\r\n    WorkspaceSummaryResult,\r\n    LayoutSummariesResult,\r\n    LayoutSummary,\r\n    OpenWorkspaceConfig,\r\n    FrameSummariesResult,\r\n    WorkspaceSummariesResult,\r\n    ExportedLayoutsResult,\r\n    DeleteLayoutConfig,\r\n    SimpleItemConfig,\r\n    ResizeItemConfig,\r\n    MoveFrameConfig,\r\n    FrameSnapshotResult,\r\n    BaseChildSnapshotConfig,\r\n    ParentSnapshotConfig,\r\n    SwimlaneWindowSnapshotConfig,\r\n    SimpleWindowOperationSuccessResult,\r\n    SetItemTitleConfig,\r\n    MoveWindowConfig,\r\n    AddWindowConfig,\r\n    AddContainerConfig,\r\n    AddItemResult,\r\n    BundleConfig,\r\n    WorkspaceStreamData,\r\n    FrameStreamData,\r\n    ContainerStreamData,\r\n    ContainerSummaryResult,\r\n    WindowStreamData,\r\n    PingResult,\r\n    FrameStateConfig,\r\n    FrameStateResult,\r\n    WorkspaceSelector,\r\n    LockWorkspaceConfig,\r\n    LockWindowConfig,\r\n    LockContainerConfig,\r\n    SubParentSnapshotResult,\r\n    WindowSnapshotResult,\r\n    LockRowConfig,\r\n    LockColumnConfig,\r\n    LockGroupConfig,\r\n    FrameBoundsResult\r\n} from \"../types/protocol\";\r\nimport { WorkspaceEventType, WorkspaceEventAction } from \"../types/subscription\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\nexport const nonEmptyStringDecoder: Decoder<string> = string().where((s) => s.length > 0, \"Expected a non-empty string\");\r\nexport const nonNegativeNumberDecoder: Decoder<number> = number().where((num) => num >= 0, \"Expected a non-negative number\");\r\nexport const positiveNumberDecoder: Decoder<number> = number().where((num) => num > 0, \"Expected a positive number\");\r\n\r\n\r\nexport const isWindowInSwimlaneResultDecoder: Decoder<IsWindowInSwimlaneResult> = object({\r\n    inWorkspace: boolean()\r\n});\r\n\r\nexport const allParentDecoder: Decoder<\"workspace\" | \"row\" | \"column\" | \"group\"> = oneOf<\"workspace\" | \"row\" | \"column\" | \"group\">(\r\n    constant(\"workspace\"),\r\n    constant(\"row\"),\r\n    constant(\"column\"),\r\n    constant(\"group\")\r\n);\r\n\r\nexport const subParentDecoder: Decoder<\"row\" | \"column\" | \"group\"> = oneOf<\"row\" | \"column\" | \"group\">(\r\n    constant(\"row\"),\r\n    constant(\"column\"),\r\n    constant(\"group\")\r\n);\r\n\r\nexport const frameStateDecoder: Decoder<\"maximized\" | \"minimized\" | \"normal\"> = oneOf<\"maximized\" | \"minimized\" | \"normal\">(\r\n    constant(\"maximized\"),\r\n    constant(\"minimized\"),\r\n    constant(\"normal\")\r\n);\r\n\r\nexport const checkThrowCallback = (callback: unknown, allowUndefined?: boolean): void => {\r\n    const argumentType = typeof callback;\r\n\r\n    if (allowUndefined && argumentType !== \"function\" && argumentType !== \"undefined\") {\r\n        throw new Error(`Provided argument must be either undefined or of type function, provided: ${argumentType}`);\r\n    }\r\n\r\n    if (!allowUndefined && argumentType !== \"function\") {\r\n        throw new Error(`Provided argument must be of type function, provided: ${argumentType}`);\r\n    }\r\n};\r\n\r\nexport const workspaceBuilderCreateConfigDecoder: Decoder<Glue42Workspaces.WorkspaceCreateConfig> = optional(object({\r\n    saveLayout: optional(boolean())\r\n}));\r\n\r\nexport const deleteLayoutConfigDecoder: Decoder<DeleteLayoutConfig> = object({\r\n    name: nonEmptyStringDecoder\r\n});\r\n\r\nexport const windowDefinitionConfigDecoder: Decoder<Glue42Workspaces.WorkspaceWindowDefinitionConfig> = object({\r\n    minWidth: optional(number()),\r\n    maxWidth: optional(number()),\r\n    minHeight: optional(number()),\r\n    maxHeight: optional(number()),\r\n    allowExtract: optional(boolean()),\r\n    showCloseButton: optional(boolean())\r\n});\r\n\r\nexport const groupDefinitionConfigDecoder: Decoder<Glue42Workspaces.GroupDefinitionConfig> = object({\r\n    minWidth: optional(number()),\r\n    maxWidth: optional(number()),\r\n    minHeight: optional(number()),\r\n    maxHeight: optional(number()),\r\n    allowExtract: optional(boolean()),\r\n    allowDrop: optional(boolean()),\r\n    allowDropHeader: optional(boolean()),\r\n    allowDropLeft: optional(boolean()),\r\n    allowDropRight: optional(boolean()),\r\n    allowDropTop: optional(boolean()),\r\n    allowDropBottom: optional(boolean()),\r\n    showMaximizeButton: optional(boolean()),\r\n    showEjectButton: optional(boolean()),\r\n    showAddWindowButton: optional(boolean())\r\n});\r\n\r\nexport const rowDefinitionConfigDecoder: Decoder<Glue42Workspaces.RowDefinitionConfig> = object({\r\n    minHeight: optional(number()),\r\n    maxHeight: optional(number()),\r\n    allowDrop: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n    isPinned: optional(boolean())\r\n});\r\n\r\nexport const columnDefinitionConfigDecoder: Decoder<Glue42Workspaces.ColumnDefinitionConfig> = object({\r\n    minWidth: optional(number()),\r\n    maxWidth: optional(number()),\r\n    allowDrop: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n    isPinned: optional(boolean())\r\n});\r\n\r\nexport const swimlaneWindowDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceWindowDefinition> = object({\r\n    type: optional(constant(\"window\")),\r\n    appName: optional(nonEmptyStringDecoder),\r\n    windowId: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson()),\r\n    config: optional(windowDefinitionConfigDecoder)\r\n});\r\n\r\nexport const strictSwimlaneWindowDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceWindowDefinition> = object({\r\n    type: constant(\"window\"),\r\n    appName: optional(nonEmptyStringDecoder),\r\n    windowId: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson()),\r\n    config: optional(windowDefinitionConfigDecoder)\r\n});\r\n\r\nexport const parentDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = optional(object({\r\n    type: optional(subParentDecoder),\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                swimlaneWindowDefinitionDecoder,\r\n                parentDefinitionDecoder\r\n            )\r\n        ))\r\n    ),\r\n    config: optional(anyJson())\r\n}));\r\n\r\n\r\nexport const strictColumnDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = object({\r\n    type: constant(\"column\"),\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                strictSwimlaneWindowDefinitionDecoder,\r\n                strictParentDefinitionDecoder\r\n            )\r\n        ))\r\n    ),\r\n    config: optional(columnDefinitionConfigDecoder)\r\n});\r\n\r\nexport const strictRowDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = object({\r\n    type: constant(\"row\"),\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                strictSwimlaneWindowDefinitionDecoder,\r\n                strictParentDefinitionDecoder\r\n            )\r\n        ))\r\n    ),\r\n    config: optional(rowDefinitionConfigDecoder)\r\n});\r\n\r\nexport const strictGroupDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = object({\r\n    type: constant(\"group\"),\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                strictSwimlaneWindowDefinitionDecoder,\r\n                strictParentDefinitionDecoder\r\n            )\r\n        ))\r\n    ),\r\n    config: optional(groupDefinitionConfigDecoder)\r\n});\r\n\r\nexport const strictParentDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = oneOf(strictGroupDefinitionDecoder, strictColumnDefinitionDecoder, strictRowDefinitionDecoder);\r\n\r\nexport const stateDecoder: Decoder<\"maximized\" | \"normal\"> = oneOf<\"maximized\" | \"normal\">(\r\n    (string().where((s) => s.toLowerCase() === \"maximized\", \"Expected a case insensitive variation of 'maximized'\") as Decoder<\"maximized\">),\r\n    (string().where((s) => s.toLowerCase() === \"normal\", \"Expected a case insensitive variation of 'normal'\") as Decoder<\"normal\">)\r\n);\r\n\r\nexport const newFrameConfigDecoder: Decoder<Glue42Workspaces.NewFrameConfig> = object({\r\n    bounds: optional(object({\r\n        left: optional(number()),\r\n        top: optional(number()),\r\n        width: optional(nonNegativeNumberDecoder),\r\n        height: optional(nonNegativeNumberDecoder)\r\n    }))\r\n});\r\n\r\nexport const loadingStrategyDecoder: Decoder<Glue42Workspaces.LoadingStrategy> = oneOf<\"direct\" | \"delayed\" | \"lazy\">(\r\n    constant(\"direct\"),\r\n    constant(\"delayed\"),\r\n    constant(\"lazy\")\r\n);\r\n\r\nexport const restoreWorkspaceConfigDecoder: Decoder<Glue42Workspaces.RestoreWorkspaceConfig> = optional(object({\r\n    app: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson()),\r\n    loadingStrategy: optional(loadingStrategyDecoder),\r\n    title: optional(nonEmptyStringDecoder),\r\n    reuseWorkspaceId: optional(nonEmptyStringDecoder),\r\n    frameId: optional(nonEmptyStringDecoder),\r\n    lockdown: optional(boolean()),\r\n    activateFrame: optional(boolean()),\r\n    newFrame: optional(oneOf<Glue42Workspaces.NewFrameConfig | boolean>(\r\n        newFrameConfigDecoder,\r\n        boolean()\r\n    )),\r\n    noTabHeader: optional(boolean()),\r\n    inMemoryLayout: optional(boolean())\r\n}));\r\n\r\nexport const openWorkspaceConfigDecoder: Decoder<OpenWorkspaceConfig> = object({\r\n    name: nonEmptyStringDecoder,\r\n    restoreOptions: optional(restoreWorkspaceConfigDecoder)\r\n});\r\n\r\nexport const workspaceDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceDefinition> = object({\r\n    children: optional(array(oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n        swimlaneWindowDefinitionDecoder,\r\n        parentDefinitionDecoder\r\n    ))),\r\n    context: optional(anyJson()),\r\n    config: optional(object({\r\n        title: optional(nonEmptyStringDecoder),\r\n        position: optional(nonNegativeNumberDecoder),\r\n        isFocused: optional(boolean()),\r\n        noTabHeader: optional(boolean()),\r\n        reuseWorkspaceId: optional(nonEmptyStringDecoder),\r\n        loadingStrategy: optional(loadingStrategyDecoder),\r\n        allowDrop: optional(boolean()),\r\n        allowDropLeft:optional(boolean()),\r\n        allowDropTop:optional(boolean()),\r\n        allowDropRight:optional(boolean()),\r\n        allowDropBottom:optional(boolean()),\r\n        allowExtract: optional(boolean()),\r\n        showSaveButton: optional(boolean()),\r\n        showCloseButton: optional(boolean()),\r\n        allowSplitters: optional(boolean()),\r\n        showWindowCloseButtons: optional(boolean()),\r\n        showEjectButtons: optional(boolean()),\r\n        showAddWindowButtons: optional(boolean())\r\n    })),\r\n    frame: optional(object({\r\n        reuseFrameId: optional(nonEmptyStringDecoder),\r\n        newFrame: optional(oneOf<boolean | Glue42Workspaces.NewFrameConfig>(\r\n            boolean(),\r\n            newFrameConfigDecoder\r\n        ))\r\n    }))\r\n});\r\n\r\nexport const builderConfigDecoder: Decoder<Glue42Workspaces.BuilderConfig> = object({\r\n    type: allParentDecoder,\r\n    definition: optional(oneOf<Glue42Workspaces.WorkspaceDefinition | Glue42Workspaces.BoxDefinition>(\r\n        workspaceDefinitionDecoder,\r\n        parentDefinitionDecoder\r\n    ))\r\n});\r\n\r\nexport const workspaceCreateConfigDecoder: Decoder<WorkspaceCreateConfigProtocol> = intersection(\r\n    workspaceDefinitionDecoder,\r\n    object({\r\n        saveConfig: optional(object({\r\n            saveLayout: optional(boolean())\r\n        }))\r\n    })\r\n);\r\n\r\nexport const getFrameSummaryConfigDecoder: Decoder<GetFrameSummaryConfig> = object({\r\n    itemId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const frameSummaryDecoder: Decoder<FrameSummaryResult> = object({\r\n    id: nonEmptyStringDecoder\r\n});\r\n\r\nexport const containerSummaryDecoder: Decoder<Glue42Workspaces.BoxSummary> = object({\r\n    type: subParentDecoder,\r\n    id: nonEmptyStringDecoder,\r\n    frameId: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    positionIndex: number()\r\n});\r\n\r\nexport const eventTypeDecoder: Decoder<WorkspaceEventType> = oneOf<\"frame\" | \"workspace\" | \"container\" | \"window\">(\r\n    constant(\"frame\"),\r\n    constant(\"workspace\"),\r\n    constant(\"container\"),\r\n    constant(\"window\")\r\n);\r\n\r\nexport const streamRequestArgumentsDecoder: Decoder<{ type: WorkspaceEventType; branch: string }> = object({\r\n    type: eventTypeDecoder,\r\n    branch: nonEmptyStringDecoder\r\n});\r\n\r\nexport const workspaceEventActionDecoder: Decoder<WorkspaceEventAction> = oneOf<\"opened\" | \"closing\" | \"closed\" | \"focus\" | \"added\" | \"loaded\" | \"removed\" | \"childrenUpdate\" | \"containerChange\" | \"maximized\" | \"minimized\" | \"normal\" | \"selected\">(\r\n    constant(\"opened\"),\r\n    constant(\"closing\"),\r\n    constant(\"closed\"),\r\n    constant(\"focus\"),\r\n    constant(\"added\"),\r\n    constant(\"loaded\"),\r\n    constant(\"removed\"),\r\n    constant(\"childrenUpdate\"),\r\n    constant(\"containerChange\"),\r\n    constant(\"maximized\"),\r\n    constant(\"minimized\"),\r\n    constant(\"normal\"),\r\n    constant(\"selected\")\r\n);\r\n\r\nexport const workspaceConfigResultDecoder: Decoder<WorkspaceConfigResult> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    title: nonEmptyStringDecoder,\r\n    positionIndex: nonNegativeNumberDecoder,\r\n    name: nonEmptyStringDecoder,\r\n    layoutName: optional(nonEmptyStringDecoder),\r\n    isHibernated: optional(boolean()),\r\n    isSelected: optional(boolean()),\r\n    allowDrop: optional(boolean()),\r\n    allowExtract: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n    showCloseButton: optional(boolean()),\r\n    showSaveButton: optional(boolean()),\r\n    allowDropLeft: optional(boolean()),\r\n    allowDropTop: optional(boolean()),\r\n    allowDropRight: optional(boolean()),\r\n    allowDropBottom: optional(boolean()),\r\n    minWidth: optional(number()),\r\n    maxWidth: optional(number()),\r\n    minHeight: optional(number()),\r\n    maxHeight: optional(number()),\r\n    showAddWindowButtons: optional(boolean()),\r\n    showEjectButtons: optional(boolean()),\r\n    showWindowCloseButtons: optional(boolean()),\r\n    widthInPx: optional(number()),\r\n    heightInPx: optional(number())\r\n});\r\n\r\n// todo: remove number positionIndex when fixed\r\nexport const baseChildSnapshotConfigDecoder: Decoder<BaseChildSnapshotConfig> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    positionIndex: number(),\r\n    minWidth: optional(number()),\r\n    maxWidth: optional(number()),\r\n    minHeight: optional(number()),\r\n    maxHeight: optional(number())\r\n});\r\n\r\nexport const parentSnapshotConfigDecoder: Decoder<ParentSnapshotConfig> = anyJson();\r\n\r\n// todo: remove optional isMaximized when fixed\r\nexport const swimlaneWindowSnapshotConfigDecoder: Decoder<SwimlaneWindowSnapshotConfig> = intersection(\r\n    baseChildSnapshotConfigDecoder,\r\n    object({\r\n        windowId: optional(nonEmptyStringDecoder),\r\n        isMaximized: optional(boolean()),\r\n        isFocused: boolean(),\r\n        title: optional(string()),\r\n        appName: optional(nonEmptyStringDecoder),\r\n        allowExtract: optional(boolean()),\r\n        showCloseButton: optional(boolean()),\r\n        minWidth: optional(number()),\r\n        minHeigth: optional(number()),\r\n        maxWidth: optional(number()),\r\n        maxHeight: optional(number()),\r\n        widthInPx: optional(number()),\r\n        heightInPx: optional(number())\r\n    })\r\n) as any;\r\n\r\nexport const customWorkspaceSubParentSnapshotDecoder: Decoder<SubParentSnapshotResult> = object({\r\n    id: optional(nonEmptyStringDecoder),\r\n    config: parentSnapshotConfigDecoder,\r\n    children: optional(lazy(() => array(customWorkspaceChildSnapshotDecoder))),\r\n    type: oneOf<\"row\" | \"column\" | \"group\">(\r\n        constant(\"row\"),\r\n        constant(\"column\"),\r\n        constant(\"group\")\r\n    )\r\n});\r\n\r\nexport const customWorkspaceWindowSnapshotDecoder: Decoder<WindowSnapshotResult> = object({\r\n    id: optional(nonEmptyStringDecoder),\r\n    config: swimlaneWindowSnapshotConfigDecoder,\r\n    type: constant(\"window\")\r\n});\r\n\r\nexport const customWorkspaceChildSnapshotDecoder: Decoder<ChildSnapshotResult> = oneOf<WindowSnapshotResult | SubParentSnapshotResult>(\r\n    customWorkspaceWindowSnapshotDecoder,\r\n    customWorkspaceSubParentSnapshotDecoder);\r\n\r\nexport const childSnapshotResultDecoder: Decoder<ChildSnapshotResult> = customWorkspaceChildSnapshotDecoder;\r\n\r\nexport const workspaceSnapshotResultDecoder: Decoder<WorkspaceSnapshotResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: workspaceConfigResultDecoder,\r\n    children: array(childSnapshotResultDecoder),\r\n    frameSummary: frameSummaryDecoder\r\n});\r\n\r\nexport const windowLayoutItemDecoder: Decoder<Glue42Workspaces.WindowLayoutItem> = object({\r\n    type: constant(\"window\"),\r\n    config: object({\r\n        appName: nonEmptyStringDecoder,\r\n        url: optional(nonEmptyStringDecoder),\r\n        title: optional(string()),\r\n        allowExtract: optional(boolean()),\r\n        showCloseButton: optional(boolean()),\r\n        minWidth: optional(number()),\r\n        minHeigth: optional(number()),\r\n        maxWidth: optional(number()),\r\n        maxHeight: optional(number())\r\n    })\r\n});\r\n\r\nexport const groupLayoutItemDecoder: Decoder<Glue42Workspaces.GroupLayoutItem> = object({\r\n    type: constant(\"group\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.WindowLayoutItem>(\r\n        windowLayoutItemDecoder\r\n    ))\r\n});\r\n\r\nexport const columnLayoutItemDecoder: Decoder<Glue42Workspaces.ColumnLayoutItem> = object({\r\n    type: constant(\"column\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n        groupLayoutItemDecoder,\r\n        windowLayoutItemDecoder,\r\n        lazy(() => columnLayoutItemDecoder),\r\n        lazy(() => rowLayoutItemDecoder)\r\n    ))\r\n});\r\n\r\nexport const rowLayoutItemDecoder: Decoder<Glue42Workspaces.RowLayoutItem> = object({\r\n    type: constant(\"row\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n        columnLayoutItemDecoder,\r\n        groupLayoutItemDecoder,\r\n        windowLayoutItemDecoder,\r\n        lazy(() => rowLayoutItemDecoder)\r\n    ))\r\n});\r\n\r\nexport const workspaceLayoutDecoder: Decoder<Glue42Workspaces.WorkspaceLayout> = object({\r\n    name: nonEmptyStringDecoder,\r\n    type: constant(\"Workspace\"),\r\n    metadata: optional(anyJson()),\r\n    components: array(object({\r\n        type: constant(\"Workspace\"),\r\n        state: object({\r\n            config: anyJson(),\r\n            context: anyJson(),\r\n            children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n                rowLayoutItemDecoder,\r\n                columnLayoutItemDecoder,\r\n                groupLayoutItemDecoder,\r\n                windowLayoutItemDecoder\r\n            ))\r\n        })\r\n    }))\r\n});\r\n\r\nexport const workspacesImportLayoutDecoder: Decoder<{ layout: Glue42Workspaces.WorkspaceLayout; mode: \"replace\" | \"merge\" }> = object({\r\n    layout: workspaceLayoutDecoder,\r\n    mode: oneOf<\"replace\" | \"merge\">(\r\n        constant(\"replace\"),\r\n        constant(\"merge\")\r\n    )\r\n});\r\n\r\nexport const exportedLayoutsResultDecoder: Decoder<ExportedLayoutsResult> = object({\r\n    layouts: array(workspaceLayoutDecoder)\r\n});\r\n\r\nexport const frameSummaryResultDecoder: Decoder<FrameSummaryResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n});\r\n\r\nexport const frameSummariesResultDecoder: Decoder<FrameSummariesResult> = object({\r\n    summaries: array(frameSummaryResultDecoder)\r\n});\r\n\r\nexport const workspaceSummaryResultDecoder: Decoder<WorkspaceSummaryResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: workspaceConfigResultDecoder\r\n});\r\n\r\nexport const workspaceSummariesResultDecoder: Decoder<WorkspaceSummariesResult> = object({\r\n    summaries: array(workspaceSummaryResultDecoder)\r\n});\r\n\r\nexport const frameSnapshotResultDecoder: Decoder<FrameSnapshotResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: anyJson(),\r\n    workspaces: array(workspaceSnapshotResultDecoder)\r\n});\r\n\r\nexport const layoutSummaryDecoder: Decoder<LayoutSummary> = object({\r\n    name: nonEmptyStringDecoder\r\n});\r\n\r\nexport const layoutSummariesDecoder: Decoder<LayoutSummariesResult> = object({\r\n    summaries: array(layoutSummaryDecoder)\r\n});\r\n\r\nexport const simpleWindowOperationSuccessResultDecoder: Decoder<SimpleWindowOperationSuccessResult> = object({\r\n    windowId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const voidResultDecoder: Decoder<{}> = anyJson();\r\n\r\nexport const frameStateResultDecoder: Decoder<FrameStateResult> = object({\r\n    state: frameStateDecoder\r\n});\r\n\r\nexport const frameBoundsResultDecoder: Decoder<FrameBoundsResult> = object({\r\n    bounds: object({\r\n        top: number(),\r\n        left: number(),\r\n        width: nonNegativeNumberDecoder,\r\n        height: nonNegativeNumberDecoder\r\n    })\r\n});\r\n\r\nexport const resizeConfigDecoder: Decoder<Glue42Workspaces.ResizeConfig> = object({\r\n    width: optional(positiveNumberDecoder),\r\n    height: optional(positiveNumberDecoder),\r\n    relative: optional(boolean())\r\n});\r\n\r\nexport const moveConfigDecoder: Decoder<Glue42Workspaces.MoveConfig> = object({\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    relative: optional(boolean())\r\n});\r\n\r\nexport const simpleItemConfigDecoder: Decoder<SimpleItemConfig> = object({\r\n    itemId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const frameStateConfigDecoder: Decoder<FrameStateConfig> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    requestedState: frameStateDecoder\r\n});\r\n\r\nexport const setItemTitleConfigDecoder: Decoder<SetItemTitleConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    title: nonEmptyStringDecoder\r\n});\r\n\r\nexport const moveWindowConfigDecoder: Decoder<MoveWindowConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    containerId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const resizeItemConfigDecoder: Decoder<ResizeItemConfig> = intersection(\r\n    simpleItemConfigDecoder,\r\n    resizeConfigDecoder\r\n);\r\n\r\nexport const moveFrameConfigDecoder: Decoder<MoveFrameConfig> = intersection(\r\n    simpleItemConfigDecoder,\r\n    moveConfigDecoder\r\n);\r\n\r\nexport const simpleParentDecoder: Decoder<{ id: string; type: \"row\" | \"column\" | \"group\" }> = object({\r\n    id: nonEmptyStringDecoder,\r\n    type: subParentDecoder\r\n});\r\n\r\nexport const addWindowConfigDecoder: Decoder<AddWindowConfig> = object({\r\n    definition: swimlaneWindowDefinitionDecoder,\r\n    parentId: nonEmptyStringDecoder,\r\n    parentType: allParentDecoder\r\n});\r\n\r\nexport const addContainerConfigDecoder: Decoder<AddContainerConfig> = object({\r\n    definition: strictParentDefinitionDecoder,\r\n    parentId: nonEmptyStringDecoder,\r\n    parentType: allParentDecoder\r\n});\r\n\r\nexport const addItemResultDecoder: Decoder<AddItemResult> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    windowId: optional(nonEmptyStringDecoder)\r\n});\r\n\r\nexport const pingResultDecoder: Decoder<PingResult> = object({\r\n    live: boolean()\r\n});\r\n\r\nexport const bundleConfigDecoder: Decoder<BundleConfig> = object({\r\n    type: oneOf<\"row\" | \"column\">(\r\n        constant(\"row\"),\r\n        constant(\"column\")\r\n    ),\r\n    workspaceId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const containerSummaryResultDecoder: Decoder<ContainerSummaryResult> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    config: parentSnapshotConfigDecoder\r\n});\r\n\r\nexport const frameStreamDataDecoder: Decoder<FrameStreamData> = object({\r\n    frameSummary: frameSummaryDecoder\r\n});\r\n\r\nexport const workspaceStreamDataDecoder: Decoder<WorkspaceStreamData> = object({\r\n    workspaceSummary: workspaceSummaryResultDecoder,\r\n    frameSummary: frameSummaryDecoder,\r\n    workspaceSnapshot: optional(workspaceSnapshotResultDecoder)\r\n});\r\n\r\nexport const containerStreamDataDecoder: Decoder<ContainerStreamData> = object({\r\n    containerSummary: containerSummaryResultDecoder\r\n});\r\n\r\nexport const windowStreamDataDecoder: Decoder<WindowStreamData> = object({\r\n    windowSummary: object({\r\n        itemId: nonEmptyStringDecoder,\r\n        parentId: nonEmptyStringDecoder,\r\n        config: swimlaneWindowSnapshotConfigDecoder\r\n    })\r\n});\r\n\r\nexport const workspaceLayoutSaveConfigDecoder: Decoder<Glue42Workspaces.WorkspaceLayoutSaveConfig> = object({\r\n    name: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    saveContext: optional(boolean())\r\n});\r\n\r\nexport const workspaceSelectorDecoder: Decoder<WorkspaceSelector> = object({\r\n    workspaceId: nonEmptyStringDecoder,\r\n});\r\n\r\nexport const workspaceLockConfigDecoder: Decoder<Glue42Workspaces.WorkspaceLockConfig> = object({\r\n    allowDrop: optional(boolean()),\r\n    allowDropLeft: optional(boolean()),\r\n    allowDropTop: optional(boolean()),\r\n    allowDropRight: optional(boolean()),\r\n    allowDropBottom: optional(boolean()),\r\n    allowExtract: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n    showCloseButton: optional(boolean()),\r\n    showSaveButton: optional(boolean()),\r\n    showWindowCloseButtons: optional(boolean()),\r\n    showAddWindowButtons: optional(boolean()),\r\n    showEjectButtons: optional(boolean()),\r\n});\r\n\r\nexport const lockWorkspaceDecoder: Decoder<LockWorkspaceConfig> = object({\r\n    workspaceId: nonEmptyStringDecoder,\r\n    config: optional(workspaceLockConfigDecoder)\r\n});\r\n\r\nexport const windowLockConfigDecoder: Decoder<Glue42Workspaces.WorkspaceWindowLockConfig> = object({\r\n    allowExtract: optional(boolean()),\r\n    showCloseButton: optional(boolean())\r\n});\r\n\r\nexport const elementResizeConfigDecoder: Decoder<Glue42Workspaces.ElementResizeConfig> = object({\r\n    width: optional(nonNegativeNumberDecoder),\r\n    height: optional(nonNegativeNumberDecoder)\r\n});\r\n\r\nexport const lockWindowDecoder: Decoder<LockWindowConfig> = object({\r\n    windowPlacementId: nonEmptyStringDecoder,\r\n    config: optional(windowLockConfigDecoder)\r\n});\r\n\r\nexport const rowLockConfigDecoder: Decoder<Glue42Workspaces.RowLockConfig> = object({\r\n    allowDrop: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n});\r\n\r\nexport const columnLockConfigDecoder: Decoder<Glue42Workspaces.ColumnLockConfig> = object({\r\n    allowDrop: optional(boolean()),\r\n    allowSplitters: optional(boolean()),\r\n});\r\n\r\nexport const groupLockConfigDecoder: Decoder<Glue42Workspaces.GroupLockConfig> = object({\r\n    allowExtract: optional(boolean()),\r\n    allowDrop: optional(boolean()),\r\n    allowDropLeft: optional(boolean()),\r\n    allowDropRight: optional(boolean()),\r\n    allowDropTop: optional(boolean()),\r\n    allowDropBottom: optional(boolean()),\r\n    allowDropHeader: optional(boolean()),\r\n    showMaximizeButton: optional(boolean()),\r\n    showEjectButton: optional(boolean()),\r\n    showAddWindowButton: optional(boolean()),\r\n});\r\n\r\nexport const lockRowDecoder: Decoder<LockRowConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    type: constant(\"row\"),\r\n    config: optional(rowLockConfigDecoder)\r\n});\r\n\r\nexport const lockColumnDecoder: Decoder<LockColumnConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    type: constant(\"column\"),\r\n    config: optional(columnLockConfigDecoder)\r\n});\r\n\r\nexport const lockGroupDecoder: Decoder<LockGroupConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    type: constant(\"group\"),\r\n    config: optional(groupLockConfigDecoder)\r\n});\r\n\r\n\r\nexport const lockContainerDecoder: Decoder<LockContainerConfig> = oneOf<LockGroupConfig | LockColumnConfig | LockRowConfig>(lockRowDecoder, lockColumnDecoder, lockGroupDecoder);\r\n","import {\r\n    isWindowInSwimlaneResultDecoder,\r\n    frameSummaryDecoder,\r\n    workspaceSnapshotResultDecoder,\r\n    frameSummariesResultDecoder,\r\n    workspaceCreateConfigDecoder,\r\n    getFrameSummaryConfigDecoder,\r\n    layoutSummariesDecoder,\r\n    openWorkspaceConfigDecoder,\r\n    workspaceSummariesResultDecoder,\r\n    voidResultDecoder,\r\n    exportedLayoutsResultDecoder,\r\n    workspaceLayoutDecoder,\r\n    deleteLayoutConfigDecoder,\r\n    simpleItemConfigDecoder,\r\n    resizeItemConfigDecoder,\r\n    moveFrameConfigDecoder,\r\n    frameSnapshotResultDecoder,\r\n    simpleWindowOperationSuccessResultDecoder,\r\n    setItemTitleConfigDecoder,\r\n    moveWindowConfigDecoder,\r\n    addWindowConfigDecoder,\r\n    addContainerConfigDecoder,\r\n    addItemResultDecoder,\r\n    bundleConfigDecoder,\r\n    workspaceStreamDataDecoder,\r\n    frameStreamDataDecoder,\r\n    containerStreamDataDecoder,\r\n    windowStreamDataDecoder,\r\n    workspaceLayoutSaveConfigDecoder,\r\n    pingResultDecoder,\r\n    frameStateConfigDecoder,\r\n    frameStateResultDecoder,\r\n    workspacesImportLayoutDecoder,\r\n    workspaceSelectorDecoder,\r\n    lockWorkspaceDecoder,\r\n    lockWindowDecoder,\r\n    lockContainerDecoder,\r\n    frameBoundsResultDecoder\r\n} from \"../shared/decoders\";\r\nimport { ControlOperation, StreamOperation } from \"../types/protocol\";\r\nimport { WorkspaceEventType } from \"../types/subscription\";\r\n\r\ntype OperationsTypes = \"isWindowInWorkspace\" |\r\n    \"createWorkspace\" |\r\n    \"getAllFramesSummaries\" |\r\n    \"getFrameSummary\" |\r\n    \"getAllWorkspacesSummaries\" |\r\n    \"getWorkspaceSnapshot\" |\r\n    \"getAllLayoutsSummaries\" |\r\n    \"openWorkspace\" |\r\n    \"deleteLayout\" |\r\n    \"saveLayout\" |\r\n    \"importLayout\" |\r\n    \"exportAllLayouts\" |\r\n    \"restoreItem\" |\r\n    \"maximizeItem\" |\r\n    \"focusItem\" |\r\n    \"closeItem\" |\r\n    \"resizeItem\" |\r\n    \"moveFrame\" |\r\n    \"getFrameSnapshot\" |\r\n    \"forceLoadWindow\" |\r\n    \"ejectWindow\" |\r\n    \"setItemTitle\" |\r\n    \"moveWindowTo\" |\r\n    \"addWindow\" |\r\n    \"addContainer\" |\r\n    \"bundleWorkspace\" |\r\n    \"ping\" |\r\n    \"changeFrameState\" |\r\n    \"getFrameState\" |\r\n    \"getFrameBounds\" |\r\n    \"hibernateWorkspace\" |\r\n    \"resumeWorkspace\" |\r\n    \"lockWorkspace\" |\r\n    \"lockWindow\" |\r\n    \"lockContainer\";\r\ntype MethodsTypes = \"control\" | \"frameStream\" | \"workspaceStream\" | \"containerStream\" | \"windowStream\";\r\n\r\nexport const webPlatformMethodName = \"T42.Web.Platform.Control\";\r\nexport const webPlatformWspStreamName = \"T42.Web.Platform.WSP.Stream\";\r\n\r\nexport const METHODS: { [key in MethodsTypes]: { name: string; isStream: boolean } } = {\r\n    control: { name: \"T42.Workspaces.Control\", isStream: false },\r\n    frameStream: { name: \"T42.Workspaces.Stream.Frame\", isStream: true },\r\n    workspaceStream: { name: \"T42.Workspaces.Stream.Workspace\", isStream: true },\r\n    containerStream: { name: \"T42.Workspaces.Stream.Container\", isStream: true },\r\n    windowStream: { name: \"T42.Workspaces.Stream.Window\", isStream: true }\r\n};\r\n\r\nexport const STREAMS: { [key in WorkspaceEventType]: StreamOperation } = {\r\n    frame: { name: \"T42.Workspaces.Stream.Frame\", payloadDecoder: frameStreamDataDecoder },\r\n    workspace: { name: \"T42.Workspaces.Stream.Workspace\", payloadDecoder: workspaceStreamDataDecoder },\r\n    container: { name: \"T42.Workspaces.Stream.Container\", payloadDecoder: containerStreamDataDecoder },\r\n    window: { name: \"T42.Workspaces.Stream.Window\", payloadDecoder: windowStreamDataDecoder }\r\n};\r\n\r\nexport const OPERATIONS: { [key in OperationsTypes]: ControlOperation } = {\r\n    ping: { name: \"ping\", resultDecoder: pingResultDecoder },\r\n    isWindowInWorkspace: { name: \"isWindowInWorkspace\", argsDecoder: simpleItemConfigDecoder, resultDecoder: isWindowInSwimlaneResultDecoder },\r\n    createWorkspace: { name: \"createWorkspace\", resultDecoder: workspaceSnapshotResultDecoder, argsDecoder: workspaceCreateConfigDecoder },\r\n    getAllFramesSummaries: { name: \"getAllFramesSummaries\", resultDecoder: frameSummariesResultDecoder },\r\n    getFrameSummary: { name: \"getFrameSummary\", resultDecoder: frameSummaryDecoder, argsDecoder: getFrameSummaryConfigDecoder },\r\n    getAllWorkspacesSummaries: { name: \"getAllWorkspacesSummaries\", resultDecoder: workspaceSummariesResultDecoder },\r\n    getWorkspaceSnapshot: { name: \"getWorkspaceSnapshot\", resultDecoder: workspaceSnapshotResultDecoder, argsDecoder: simpleItemConfigDecoder },\r\n    getAllLayoutsSummaries: { name: \"getAllLayoutsSummaries\", resultDecoder: layoutSummariesDecoder },\r\n    openWorkspace: { name: \"openWorkspace\", argsDecoder: openWorkspaceConfigDecoder, resultDecoder: workspaceSnapshotResultDecoder },\r\n    deleteLayout: { name: \"deleteLayout\", resultDecoder: voidResultDecoder, argsDecoder: deleteLayoutConfigDecoder },\r\n    saveLayout: { name: \"saveLayout\", resultDecoder: workspaceLayoutDecoder, argsDecoder: workspaceLayoutSaveConfigDecoder },\r\n    importLayout: { name: \"importLayout\", resultDecoder: voidResultDecoder, argsDecoder: workspacesImportLayoutDecoder },\r\n    exportAllLayouts: { name: \"exportAllLayouts\", resultDecoder: exportedLayoutsResultDecoder },\r\n    restoreItem: { name: \"restoreItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    maximizeItem: { name: \"maximizeItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    focusItem: { name: \"focusItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    closeItem: { name: \"closeItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    resizeItem: { name: \"resizeItem\", argsDecoder: resizeItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    changeFrameState: { name: \"changeFrameState\", argsDecoder: frameStateConfigDecoder, resultDecoder: voidResultDecoder },\r\n    getFrameState: { name: \"getFrameState\", argsDecoder: simpleItemConfigDecoder, resultDecoder: frameStateResultDecoder },\r\n    getFrameBounds: { name: \"getFrameBounds\", argsDecoder: simpleItemConfigDecoder, resultDecoder: frameBoundsResultDecoder },\r\n    moveFrame: { name: \"moveFrame\", argsDecoder: moveFrameConfigDecoder, resultDecoder: voidResultDecoder },\r\n    getFrameSnapshot: { name: \"getFrameSnapshot\", argsDecoder: simpleItemConfigDecoder, resultDecoder: frameSnapshotResultDecoder },\r\n    forceLoadWindow: { name: \"forceLoadWindow\", argsDecoder: simpleItemConfigDecoder, resultDecoder: simpleWindowOperationSuccessResultDecoder },\r\n    ejectWindow: { name: \"ejectWindow\", argsDecoder: simpleItemConfigDecoder, resultDecoder: simpleWindowOperationSuccessResultDecoder },\r\n    setItemTitle: { name: \"setItemTitle\", argsDecoder: setItemTitleConfigDecoder, resultDecoder: voidResultDecoder },\r\n    moveWindowTo: { name: \"moveWindowTo\", argsDecoder: moveWindowConfigDecoder, resultDecoder: voidResultDecoder },\r\n    addWindow: { name: \"addWindow\", argsDecoder: addWindowConfigDecoder, resultDecoder: addItemResultDecoder },\r\n    addContainer: { name: \"addContainer\", argsDecoder: addContainerConfigDecoder, resultDecoder: addItemResultDecoder },\r\n    bundleWorkspace: { name: \"bundleWorkspace\", argsDecoder: bundleConfigDecoder, resultDecoder: voidResultDecoder },\r\n    hibernateWorkspace: { name: \"hibernateWorkspace\", argsDecoder: workspaceSelectorDecoder, resultDecoder: voidResultDecoder },\r\n    resumeWorkspace: { name: \"resumeWorkspace\", argsDecoder: workspaceSelectorDecoder, resultDecoder: voidResultDecoder },\r\n    lockWorkspace: { name: \"lockWorkspace\", argsDecoder: lockWorkspaceDecoder, resultDecoder: voidResultDecoder },\r\n    lockWindow: { name: \"lockWindow\", argsDecoder: lockWindowDecoder, resultDecoder: voidResultDecoder },\r\n    lockContainer: { name: \"lockContainer\", argsDecoder: lockContainerDecoder, resultDecoder: voidResultDecoder }\r\n};\r\n","import { CallbackRegistry, UnsubscribeFunction } from \"callback-registry\";\r\nimport { SubscriptionConfig, ActiveSubscription, WorkspaceEventType, WorkspaceEventAction, WorkspacePayload, WorkspaceEventScope } from \"../types/subscription\";\r\nimport { STREAMS } from \"./constants\";\r\nimport { OPERATIONS } from \"./constants\";\r\nimport { eventTypeDecoder, streamRequestArgumentsDecoder, workspaceEventActionDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { InteropTransport } from \"./interop-transport\";\r\n\r\nexport class Bridge {\r\n\r\n    private readonly activeSubscriptions: ActiveSubscription[] = [];\r\n\r\n    constructor(\r\n        private readonly transport: InteropTransport,\r\n        private readonly registry: CallbackRegistry\r\n    ) { }\r\n\r\n    public async createCoreEventSubscription(): Promise<void> {\r\n        await this.transport.coreSubscriptionReady(this.handleCoreEvent.bind(this));\r\n    }\r\n\r\n    public handleCoreSubscription(config: SubscriptionConfig): UnsubscribeFunction {\r\n        const registryKey = `${config.eventType}-${config.action}`;\r\n        const scope = config.scope;\r\n        const scopeId = config.scopeId;\r\n\r\n        return this.registry.add(registryKey, (args) => {\r\n            const scopeConfig = {\r\n                type: scope,\r\n                id: scopeId\r\n            };\r\n\r\n            const receivedIds = {\r\n                frame: args.frameSummary?.id || args.windowSummary?.config.frameId,\r\n                workspace: args.workspaceSummary?.id || args.windowSummary?.config.workspaceId,\r\n                window: args.windowSummary?.config.windowId\r\n            };\r\n\r\n            const shouldInvokeCallback = this.checkScopeMatch(scopeConfig, receivedIds);\r\n\r\n            if (!shouldInvokeCallback) {\r\n                return;\r\n            }\r\n\r\n            config.callback(args);\r\n        });\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    public async send<T>(operationName: string, operationArgs?: any): Promise<T> {\r\n\r\n        const operationDefinition = Object.values(OPERATIONS).find((operation) => operation.name === operationName);\r\n\r\n        if (!operationDefinition) {\r\n            throw new Error(`Cannot find definition for operation name: ${operationName}`);\r\n        }\r\n\r\n        if (operationDefinition.argsDecoder) {\r\n            try {\r\n                operationDefinition.argsDecoder.runWithException(operationArgs);\r\n            } catch (error) {\r\n                throw new Error(`Unexpected internal outgoing validation error: ${error.message}, for input: ${JSON.stringify(error.input)}, for operation ${operationName}`);\r\n            }\r\n        }\r\n\r\n        let operationResult;\r\n\r\n        try {\r\n            const operationResultRaw = await this.transport.transmitControl(operationDefinition.name, operationArgs);\r\n            operationResult = operationDefinition.resultDecoder.runWithException(operationResultRaw);\r\n        } catch (error) {\r\n            if (error.kind) {\r\n                throw new Error(`Unexpected internal incoming validation error: ${error.message}, for input: ${JSON.stringify(error.input)}, for operation ${operationName}`);\r\n            }\r\n            throw new Error(error.message);\r\n        }\r\n\r\n        return operationResult;\r\n    }\r\n\r\n    public async subscribe(config: SubscriptionConfig): Promise<Glue42Workspaces.Unsubscribe> {\r\n        let activeSub = this.getActiveSubscription(config);\r\n        const registryKey = this.getRegistryKey(config);\r\n\r\n        if (!activeSub) {\r\n            const stream = STREAMS[config.eventType];\r\n            const gdSub = await this.transport.subscribe(stream.name, this.getBranchKey(config), config.eventType);\r\n\r\n            gdSub.onData((streamData) => {\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                const data = streamData.data as { action: string; payload: any };\r\n\r\n                // important to decode without exception, because we do not want to throw an exception here\r\n                const requestedArgumentsResult = streamRequestArgumentsDecoder.run(streamData.requestArguments);\r\n                const actionResult = workspaceEventActionDecoder.run(data.action);\r\n\r\n                if (!requestedArgumentsResult.ok || !actionResult.ok) {\r\n                    return;\r\n                }\r\n\r\n                const streamType = requestedArgumentsResult.result.type;\r\n                const branch = requestedArgumentsResult.result.branch;\r\n\r\n                const validatedPayload = STREAMS[streamType].payloadDecoder.run(data.payload);\r\n\r\n                if (!validatedPayload.ok) {\r\n                    return;\r\n                }\r\n\r\n                const keyToExecute = `${streamType}-${branch}-${actionResult.result}`;\r\n                this.registry.execute(keyToExecute, validatedPayload.result);\r\n            });\r\n\r\n            activeSub = {\r\n                streamType: config.eventType,\r\n                level: config.scope,\r\n                levelId: config.scopeId,\r\n                callbacksCount: 0,\r\n                gdSub\r\n            };\r\n\r\n            this.activeSubscriptions.push(activeSub);\r\n        }\r\n\r\n        const unsubscribe = this.registry.add(registryKey, config.callback);\r\n\r\n        ++activeSub.callbacksCount;\r\n\r\n        return (): void => {\r\n            unsubscribe();\r\n\r\n            --activeSub.callbacksCount;\r\n\r\n            if (activeSub.callbacksCount === 0) {\r\n                activeSub.gdSub.close();\r\n                this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(activeSub), 1);\r\n            }\r\n        };\r\n    }\r\n\r\n    private checkScopeMatch(scope: { type: WorkspaceEventScope; id?: string }, receivedIds: { frame: string; workspace: string; window: string }): boolean {\r\n\r\n        if (scope.type === \"global\") {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"frame\" && scope.id === receivedIds.frame) {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"workspace\" && scope.id === receivedIds.workspace) {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"window\" && scope.id === receivedIds.window) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    private handleCoreEvent(args: any): void {\r\n        const data = args.data;\r\n        try {\r\n            const verifiedAction: WorkspaceEventAction = workspaceEventActionDecoder.runWithException(data.action);\r\n            const verifiedType: WorkspaceEventType = eventTypeDecoder.runWithException(data.type);\r\n            const verifiedPayload: WorkspacePayload = STREAMS[verifiedType].payloadDecoder.runWithException(data.payload);\r\n\r\n            const registryKey = `${verifiedType}-${verifiedAction}`;\r\n\r\n            this.registry.execute(registryKey, verifiedPayload);\r\n        } catch (error) {\r\n            console.warn(`Cannot handle event with data ${JSON.stringify(data)}, because of validation error: ${error.message}`);\r\n        }\r\n    }\r\n\r\n    private getBranchKey(config: SubscriptionConfig): string {\r\n        return config.scope === \"global\" ? config.scope : `${config.scope}_${config.scopeId}`;\r\n    }\r\n\r\n    private getRegistryKey(config: SubscriptionConfig): string {\r\n        return `${config.eventType}-${this.getBranchKey(config)}-${config.action}`;\r\n    }\r\n\r\n    private getActiveSubscription(config: SubscriptionConfig): ActiveSubscription {\r\n        return this.activeSubscriptions\r\n            .find((activeSub) => activeSub.streamType === config.eventType &&\r\n                activeSub.level === config.scope &&\r\n                activeSub.levelId === config.scopeId\r\n            );\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { METHODS, webPlatformMethodName, webPlatformWspStreamName } from \"./constants\";\r\nimport { promisePlus } from \"../shared/promisePlus\";\r\nimport { WorkspaceEventType } from \"../types/subscription\";\r\nimport { InteropAPI, Subscription, InvocationResult } from \"../types/glue\";\r\nimport { Glue42Core } from \"@glue42/core\";\r\n\r\nexport class InteropTransport {\r\n\r\n    private readonly defaultTransportTimeout: number = 30000;\r\n    private coreEventMethodInitiated = false;\r\n    private corePlatformSubPromise: Promise<Glue42Core.Interop.Subscription>;\r\n\r\n    constructor(private readonly agm: InteropAPI) { }\r\n\r\n    public async initiate(actualWindowId: string): Promise<void> {\r\n\r\n        if (window.glue42gd) {\r\n            await Promise.all(\r\n                Object.values(METHODS).map((method) => {\r\n\r\n                    return this.verifyMethodLive(method.name);\r\n                })\r\n            );\r\n\r\n            return;\r\n        }\r\n\r\n        await Promise.all([\r\n            this.verifyMethodLive(webPlatformMethodName),\r\n            this.verifyMethodLive(webPlatformWspStreamName)\r\n        ]);\r\n\r\n        await this.transmitControl(\"frameHello\", { windowId: actualWindowId });\r\n    }\r\n\r\n    public coreSubscriptionReady(eventCallback: (args?: any) => void): Promise<Glue42Core.Interop.Subscription> {\r\n        if (!this.coreEventMethodInitiated) {\r\n            this.subscribePlatform(eventCallback);\r\n        }\r\n        return this.corePlatformSubPromise;\r\n    }\r\n\r\n    public subscribePlatform(eventCallback: (args?: any) => void): void {\r\n        this.coreEventMethodInitiated = true;\r\n\r\n        this.corePlatformSubPromise = this.agm.subscribe(webPlatformWspStreamName);\r\n\r\n        this.corePlatformSubPromise\r\n            .then((sub) => {\r\n                sub.onData((data) => eventCallback(data.data));\r\n            });\r\n    }\r\n\r\n    public async subscribe(streamName: string, streamBranch: string, streamType: WorkspaceEventType): Promise<Subscription> {\r\n\r\n        const subscriptionArgs = {\r\n            branch: streamBranch,\r\n            type: streamType\r\n        };\r\n\r\n        let subscription: Subscription;\r\n\r\n        try {\r\n            subscription = await this.agm.subscribe(streamName, { arguments: subscriptionArgs });\r\n        } catch (error) {\r\n            const message = `Internal subscription error! Error details: stream - ${streamName}, branch: ${streamBranch}. Internal message: ${error.message}`;\r\n            throw new Error(message);\r\n        }\r\n\r\n        return subscription;\r\n    }\r\n\r\n    public async transmitControl(operation: string, operationArguments: any): Promise<any> {\r\n\r\n        const invocationArguments = window.glue42gd ? { operation, operationArguments } : { operation, domain: \"workspaces\", data: operationArguments };\r\n        const methodName = window.glue42gd ? METHODS.control.name : webPlatformMethodName;\r\n\r\n        let invocationResult: InvocationResult<any>;\r\n        const baseErrorMessage = `Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(invocationArguments)}. `;\r\n\r\n        // using the 0 index of the errors and values collections, because we expect only one server and\r\n        // this is to safeguard in case in future we decide to deprecate the default returned/message properties in favor of using only collections\r\n        try {\r\n            invocationResult = await this.agm.invoke(methodName, invocationArguments, \"best\", { methodResponseTimeoutMs: this.defaultTransportTimeout });\r\n\r\n            if (!invocationResult) {\r\n                throw new Error(\"Received unsupported result from GD - empty result\");\r\n            }\r\n\r\n            if (!Array.isArray(invocationResult.all_return_values) || invocationResult.all_return_values.length === 0) {\r\n                throw new Error(\"Received unsupported result from GD - empty values collection\");\r\n            }\r\n\r\n        } catch (error) {\r\n            if (error && error.all_errors && error.all_errors.length) {\r\n                // IMPORTANT: Do NOT change the `Inner message:` string, because it is used by other programs to extract the inner message of a communication error\r\n                const invocationErrorMessage = error.all_errors[0].message;\r\n                throw new Error(`${baseErrorMessage} -> Inner message: ${invocationErrorMessage}`);\r\n\r\n            }\r\n            // IMPORTANT: Do NOT change the `Inner message:` string, because it is used by other programs to extract the inner message of a communication error\r\n            throw new Error(`${baseErrorMessage} -> Inner message: ${error.message}`);\r\n        }\r\n\r\n        return invocationResult.all_return_values[0].returned;\r\n    }\r\n\r\n    private verifyMethodLive(name: string): Promise<void> {\r\n        return promisePlus(() => {\r\n            return new Promise((resolve) => {\r\n                const hasMethod = this.agm.methods().some((method) => method.name === name);\r\n\r\n                if (hasMethod) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                let unsubscribe = this.agm.methodAdded((method) => {\r\n                    if (method.name !== name) {\r\n                        return;\r\n                    }\r\n\r\n                    if (unsubscribe) {\r\n                        unsubscribe();\r\n                        unsubscribe = null;\r\n                    } else {\r\n                        setTimeout(() => {\r\n                            if (unsubscribe) {\r\n                                unsubscribe();\r\n                            }\r\n                        }, 0);\r\n                    }\r\n                    resolve();\r\n                });\r\n            });\r\n        }, 15000, \"Timeout waiting for the Workspaces communication channels\");\r\n    }\r\n}\r\n","export const promisePlus = <T>(promise: () => Promise<T>, timeoutMilliseconds: number, timeoutMessage?: string): Promise<T> => {\r\n    return new Promise<T>((resolve, reject) => {\r\n\r\n        let promiseActive = true;\r\n\r\n        const timeout = setTimeout(() => {\r\n            if (!promiseActive) {\r\n                return;\r\n            }\r\n            promiseActive = false;\r\n            const message = timeoutMessage || `Promise timeout hit: ${timeoutMilliseconds}`;\r\n\r\n            reject(message);\r\n        }, timeoutMilliseconds);\r\n\r\n        promise()\r\n            .then((result) => {\r\n                if (!promiseActive) {\r\n                    return;\r\n                }\r\n                promiseActive = false;\r\n                clearTimeout(timeout);\r\n                resolve(result);\r\n            })\r\n            .catch((error) => {\r\n                if (!promiseActive) {\r\n                    return;\r\n                }\r\n                promiseActive = false;\r\n                clearTimeout(timeout);\r\n                reject(error);\r\n            });\r\n    });\r\n};\r\n","import { BaseBuilder } from \"./baseBuilder\";\r\nimport { ChildBuilder } from \"../types/builders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\ninterface PrivateData {\r\n    definition: Glue42Workspaces.BoxDefinition;\r\n    base: BaseBuilder;\r\n    children: ChildBuilder[];\r\n}\r\n\r\nconst privateData = new WeakMap<ParentBuilder, PrivateData>();\r\n\r\nexport class ParentBuilder implements ParentBuilder {\r\n\r\n    constructor(\r\n        definition: Glue42Workspaces.BoxDefinition,\r\n        base: BaseBuilder\r\n    ) {\r\n        const children = base.wrapChildren(definition.children);\r\n\r\n        delete definition.children;\r\n\r\n        privateData.set(this, { base, children, definition });\r\n    }\r\n\r\n    public get type(): \"column\" | \"row\" | \"group\" {\r\n        return privateData.get(this).definition.type;\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"column\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"row\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"group\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        base.addWindow(privateData.get(this).children, definition);\r\n\r\n        return this;\r\n    }\r\n\r\n    public serialize(): Glue42Workspaces.BoxDefinition {\r\n        const definition = privateData.get(this).definition;\r\n        definition.children = privateData.get(this).base.serializeChildren(privateData.get(this).children);\r\n        return definition;\r\n    }\r\n\r\n}\r\n","import { ParentBuilder } from \"./parentBuilder\";\r\nimport { ChildDefinition, ChildBuilder } from \"../types/builders\";\r\nimport { parentDefinitionDecoder, swimlaneWindowDefinitionDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspaceBuilder } from \"./workspaceBuilder\";\r\n\r\nexport class BaseBuilder {\r\n\r\n    constructor(\r\n        private readonly getBuilder: (config: Glue42Workspaces.BuilderConfig) => ParentBuilder | WorkspaceBuilder,\r\n    ) { }\r\n\r\n    public wrapChildren(children: ChildDefinition[]): ChildBuilder[] {\r\n        return children.map((child) => {\r\n            if (child.type === \"window\") {\r\n                return child;\r\n            }\r\n\r\n            return this.getBuilder({ type: child.type, definition: child }) as ParentBuilder;\r\n        });\r\n    }\r\n\r\n    public add(type: \"row\" | \"column\" | \"group\", children: ChildBuilder[], definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const validatedDefinition = parentDefinitionDecoder.runWithException(definition);\r\n\r\n        const childBuilder = this.getBuilder({ type, definition: validatedDefinition }) as ParentBuilder;\r\n\r\n        children.push(childBuilder);\r\n\r\n        return childBuilder;\r\n    }\r\n\r\n    public addWindow(children: ChildBuilder[], definition: Glue42Workspaces.WorkspaceWindowDefinition): void {\r\n        const validatedDefinition = swimlaneWindowDefinitionDecoder.runWithException(definition);\r\n\r\n        validatedDefinition.type = \"window\";\r\n\r\n        children.push(validatedDefinition);\r\n    }\r\n\r\n    public serializeChildren(children: ChildBuilder[]): ChildDefinition[] {\r\n        return children.map((child) => {\r\n            if (child instanceof ParentBuilder) {\r\n                return child.serialize();\r\n            } else {\r\n                return child as Glue42Workspaces.WorkspaceWindowDefinition;\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { BaseBuilder } from \"./baseBuilder\";\r\nimport { ChildBuilder } from \"../types/builders\";\r\nimport { ParentBuilder } from \"./parentBuilder\";\r\nimport { workspaceBuilderCreateConfigDecoder, nonNegativeNumberDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\n\r\ninterface PrivateData {\r\n    definition: Glue42Workspaces.WorkspaceDefinition;\r\n    children: ChildBuilder[];\r\n    base: BaseBuilder;\r\n    controller: WorkspacesController;\r\n}\r\n\r\nconst privateData = new WeakMap<WorkspaceBuilder, PrivateData>();\r\n\r\nexport class WorkspaceBuilder implements WorkspaceBuilder {\r\n\r\n    constructor(\r\n        definition: Glue42Workspaces.WorkspaceDefinition,\r\n        base: BaseBuilder,\r\n        controller: WorkspacesController\r\n    ) {\r\n        const children = base.wrapChildren(definition.children);\r\n\r\n        delete definition.children;\r\n\r\n        privateData.set(this, { base, children, definition, controller });\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        const areAllColumns = children.every((child) => child instanceof ParentBuilder && child.type === \"column\");\r\n\r\n        if (!areAllColumns) {\r\n            throw new Error(\"Cannot add a column to this workspace, because there are already children of another type\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"column\", children, definition);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        const areAllRows = children.every((child) => child instanceof ParentBuilder && child.type === \"row\");\r\n\r\n        if (!areAllRows) {\r\n            throw new Error(\"Cannot add a row to this workspace, because there are already children of another type\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"row\", children, definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        if (children.length !== 0) {\r\n            throw new Error(\"Cannot add a group to this workspace, because there are already defined children.\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"group\", children, definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): WorkspaceBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        if (children.length !== 0) {\r\n            throw new Error(\"Cannot add a window to this workspace, because there are already defined children.\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        base.addWindow(children, definition);\r\n\r\n        return this;\r\n    }\r\n\r\n    public getChildAt(index: number): ChildBuilder {\r\n        nonNegativeNumberDecoder.runWithException(index);\r\n        const data = privateData.get(this).children;\r\n\r\n        return data[index];\r\n    }\r\n\r\n    public async create(config?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> {\r\n        const saveConfig = workspaceBuilderCreateConfigDecoder.runWithException(config);\r\n\r\n        const definition = privateData.get(this).definition;\r\n        definition.children = privateData.get(this).base.serializeChildren(privateData.get(this).children);\r\n\r\n        const controller = privateData.get(this).controller;\r\n\r\n        return controller.createWorkspace(definition, saveConfig);\r\n    }\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\nimport { nonNegativeNumberDecoder, rowLockConfigDecoder } from \"../shared/decoders\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Row, PrivateData>();\r\n\r\nconst getBase = (model: Row): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Row implements Glue42Workspaces.Row {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"row\" {\r\n        return \"row\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public get allowDrop(): boolean {\r\n        return getBase(this).getAllowDrop(this);\r\n    }\r\n\r\n    public get allowSplitters(): boolean {\r\n        return getBase(this).getAllowSplitters(this);\r\n    }\r\n\r\n    public get minWidth(): number {\r\n        return getBase(this).getMinWidth(this);\r\n    }\r\n\r\n    public get minHeight(): number {\r\n        return getBase(this).getMinHeight(this);\r\n    }\r\n\r\n    public get maxWidth(): number {\r\n        return getBase(this).getMaxWidth(this);\r\n    }\r\n\r\n    public get maxHeight(): number {\r\n        return getBase(this).getMaxHeight(this);\r\n    }\r\n\r\n    public get width(): number {\r\n        return getBase(this).getWidthInPx(this);\r\n    }\r\n\r\n    public get height(): number {\r\n        return getBase(this).getHeightInPx(this);\r\n    }\r\n\r\n    public get isPinned(): boolean {\r\n        return getBase(this).getIsPinned(this);\r\n    }\r\n\r\n    public get isMaximized(): boolean {\r\n        return getBase(this).getIsMaximized(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"row\");\r\n    }\r\n\r\n    public async addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Group> {\r\n        if (definition?.type && definition.type !== \"group\") {\r\n            throw new Error(`Expected a group definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Group>(this, \"group\", \"row\", definition);\r\n    }\r\n\r\n    public async addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Column> {\r\n        if (definition?.type && definition.type !== \"column\") {\r\n            throw new Error(`Expected a column definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Column>(this, \"column\", \"row\", definition);\r\n    }\r\n\r\n    public async addRow(): Promise<Row> {\r\n        throw new Error(\"Adding rows as row children is not supported\");\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n    public lock(config?: Glue42Workspaces.RowLockConfig | ((config: Glue42Workspaces.RowLockConfig) => Glue42Workspaces.RowLockConfig)): Promise<void> {\r\n        let lockConfigResult = undefined;\r\n\r\n        if (typeof config === \"function\") {\r\n            const currentLockConfig = {\r\n                allowDrop: this.allowDrop,\r\n                allowSplitters: this.allowSplitters\r\n            };\r\n\r\n            lockConfigResult = config(currentLockConfig);\r\n        } else {\r\n            lockConfigResult = config;\r\n        }\r\n\r\n        const verifiedConfig = lockConfigResult === undefined ? undefined : rowLockConfigDecoder.runWithException(lockConfigResult);\r\n\r\n        return getBase(this).lockContainer(this, verifiedConfig);\r\n    }\r\n\r\n    public async setHeight(height: number): Promise<void> {\r\n        nonNegativeNumberDecoder.runWithException(height);\r\n        return getBase(this).setHeight(this, height);\r\n    }\r\n\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\nimport { columnLockConfigDecoder, nonNegativeNumberDecoder } from \"../shared/decoders\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Column, PrivateData>();\r\n\r\nconst getBase = (model: Column): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Column implements Glue42Workspaces.Column {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"column\" {\r\n        return \"column\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public get allowDrop(): boolean {\r\n        return getBase(this).getAllowDrop(this);\r\n    }\r\n\r\n    public get allowSplitters(): boolean {\r\n        return getBase(this).getAllowSplitters(this);\r\n    }\r\n\r\n    public get minWidth(): number {\r\n        return getBase(this).getMinWidth(this);\r\n    }\r\n\r\n    public get minHeight(): number {\r\n        return getBase(this).getMinHeight(this);\r\n    }\r\n\r\n    public get maxWidth(): number {\r\n        return getBase(this).getMaxWidth(this);\r\n    }\r\n\r\n    public get maxHeight(): number {\r\n        return getBase(this).getMaxHeight(this);\r\n    }\r\n\r\n    public get width(): number {\r\n        return getBase(this).getWidthInPx(this);\r\n    }\r\n\r\n    public get height(): number {\r\n        return getBase(this).getHeightInPx(this);\r\n    }\r\n\r\n    public get isPinned(): boolean {\r\n        return getBase(this).getIsPinned(this);\r\n    }\r\n\r\n    public get isMaximized(): boolean {\r\n        return getBase(this).getIsMaximized(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"column\");\r\n    }\r\n\r\n    public async addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Group> {\r\n        if (definition?.type && definition.type !== \"group\") {\r\n            throw new Error(`Expected a group definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Group>(this, \"group\", \"column\", definition);\r\n    }\r\n\r\n    public async addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Column> {\r\n        throw new Error(\"Adding columns as column children is not supported\");\r\n        return getBase(this).addParent<Column>(this, \"column\", \"column\", definition);\r\n    }\r\n\r\n    public async addRow(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Row> {\r\n        if (definition?.type && definition.type !== \"row\") {\r\n            throw new Error(`Expected a row definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Row>(this, \"row\", \"column\", definition);\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n    public lock(config?: Glue42Workspaces.ColumnLockConfig | ((config: Glue42Workspaces.ColumnLockConfig) => Glue42Workspaces.ColumnLockConfig)): Promise<void> {\r\n        let lockConfigResult = undefined;\r\n\r\n        if (typeof config === \"function\") {\r\n            const currentLockConfig = {\r\n                allowDrop: this.allowDrop,\r\n                allowSplitters: this.allowSplitters\r\n            };\r\n\r\n            lockConfigResult = config(currentLockConfig);\r\n\r\n        } else {\r\n            lockConfigResult = config;\r\n        }\r\n        const verifiedConfig = lockConfigResult === undefined ? undefined : columnLockConfigDecoder.runWithException(lockConfigResult);\r\n        return getBase(this).lockContainer(this, verifiedConfig);\r\n    }\r\n\r\n    public async setWidth(width: number): Promise<void> {\r\n        nonNegativeNumberDecoder.runWithException(width);\r\n        return getBase(this).setWidth(this, width);\r\n    }\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\nimport { elementResizeConfigDecoder, groupLockConfigDecoder } from \"../shared/decoders\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Group, PrivateData>();\r\n\r\nconst getBase = (model: Group): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Group implements Glue42Workspaces.Group {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"group\" {\r\n        return \"group\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public get allowExtract(): boolean {\r\n        return getBase(this).getAllowExtract(this);\r\n    }\r\n\r\n    public get allowDropLeft(): boolean {\r\n        return getBase(this).getAllowDropLeft(this);\r\n    }\r\n\r\n    public get allowDropRight(): boolean {\r\n        return getBase(this).getAllowDropRight(this);\r\n    }\r\n\r\n    public get allowDropTop(): boolean {\r\n        return getBase(this).getAllowDropTop(this);\r\n    }\r\n\r\n    public get allowDropBottom(): boolean {\r\n        return getBase(this).getAllowDropBottom(this);\r\n    }\r\n\r\n    public get allowDropHeader(): boolean {\r\n        return getBase(this).getAllowDropHeader(this);\r\n    }\r\n\r\n    public get allowDrop(): boolean {\r\n        return getBase(this).getAllowDrop(this);\r\n    }\r\n\r\n    public get showMaximizeButton(): boolean {\r\n        return getBase(this).getShowMaximizeButton(this);\r\n    }\r\n\r\n    public get showEjectButton(): boolean {\r\n        return getBase(this).getShowEjectButton(this);\r\n    }\r\n\r\n    public get showAddWindowButton(): boolean {\r\n        return getBase(this).getShowAddWindowButton(this);\r\n    }\r\n\r\n    public get minWidth(): number {\r\n        return getBase(this).getMinWidth(this);\r\n    }\r\n\r\n    public get minHeight(): number {\r\n        return getBase(this).getMinHeight(this);\r\n    }\r\n\r\n    public get maxWidth(): number {\r\n        return getBase(this).getMaxWidth(this);\r\n    }\r\n\r\n    public get maxHeight(): number {\r\n        return getBase(this).getMaxHeight(this);\r\n    }\r\n\r\n    public get width(): number {\r\n        return getBase(this).getWidthInPx(this);\r\n    }\r\n\r\n    public get height(): number {\r\n        return getBase(this).getHeightInPx(this);\r\n    }\r\n\r\n    public get isMaximized(): boolean {\r\n        return getBase(this).getIsMaximized(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"group\");\r\n    }\r\n\r\n    public async addGroup(): Promise<Group> {\r\n        throw new Error(\"Adding groups as group child is not supported\");\r\n    }\r\n\r\n    public async addColumn(): Promise<Glue42Workspaces.Column> {\r\n        throw new Error(\"Adding columns as group child is not supported\");\r\n    }\r\n\r\n    public async addRow(): Promise<Glue42Workspaces.Row> {\r\n        throw new Error(\"Adding rows as group child is not supported\");\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n    public lock(config?: Glue42Workspaces.GroupLockConfig | ((config: Glue42Workspaces.GroupLockConfig) => Glue42Workspaces.GroupLockConfig)): Promise<void> {\r\n        let lockConfigResult = undefined;\r\n\r\n        if (typeof config === \"function\") {\r\n            const currentLockConfig = {\r\n                allowDrop: this.allowDrop,\r\n                allowDropHeader: this.allowDropHeader,\r\n                allowDropLeft: this.allowDropLeft,\r\n                allowDropRight: this.allowDropRight,\r\n                allowDropTop: this.allowDropTop,\r\n                allowDropBottom: this.allowDropBottom,\r\n                allowExtract: this.allowExtract,\r\n                showAddWindowButton: this.showAddWindowButton,\r\n                showEjectButton: this.showEjectButton,\r\n                showMaximizeButton: this.showMaximizeButton\r\n            };\r\n\r\n            lockConfigResult = config(currentLockConfig);\r\n        } else {\r\n            lockConfigResult = config;\r\n        }\r\n        const verifiedConfig = lockConfigResult === undefined ? undefined : groupLockConfigDecoder.runWithException(lockConfigResult);\r\n        return getBase(this).lockContainer(this, verifiedConfig);\r\n    }\r\n\r\n    public async setSize(config: Glue42Workspaces.ElementResizeConfig): Promise<void> {\r\n        const verifiedConfig = elementResizeConfigDecoder.runWithException(config);\r\n\r\n        if (!verifiedConfig.width && !verifiedConfig.height) {\r\n            throw new Error(\"Expected either width or height to be passed.\");\r\n        }\r\n\r\n\r\n        return getBase(this).setSize(this, config.width, config.height);\r\n    }\r\n\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { WorkspaceSnapshotResult, WindowStreamData } from \"../types/protocol\";\r\nimport { checkThrowCallback, nonEmptyStringDecoder, workspaceLockConfigDecoder } from \"../shared/decoders\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { FrameCreateConfig } from \"../types/ioc\";\r\nimport { Frame } from \"./frame\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { WorkspacePrivateData } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Workspace, PrivateData>();\r\n\r\nconst getData = (model: Workspace): WorkspacePrivateData => {\r\n    return data.get(model).manager.getWorkspaceData(model);\r\n};\r\n\r\nconst getDataManager = (model: Workspace): PrivateDataManager => {\r\n    return data.get(model).manager;\r\n};\r\n\r\nexport class Workspace implements Glue42Workspaces.Workspace {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).id;\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getData(this).config.frameId;\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getData(this).config.positionIndex;\r\n    }\r\n\r\n    public get title(): string {\r\n        return getData(this).config.title;\r\n    }\r\n\r\n    public get layoutName(): string {\r\n        return getData(this).config.layoutName;\r\n    }\r\n\r\n    public get isHibernated(): boolean | undefined {\r\n        return getData(this).config.isHibernated;\r\n    }\r\n\r\n    public get isSelected(): boolean {\r\n        return getData(this).config.isSelected;\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getData(this).children;\r\n    }\r\n\r\n    public get frame(): Frame {\r\n        return getData(this).frame;\r\n    }\r\n\r\n    public get allowSplitters(): boolean {\r\n        return getData(this).config.allowSplitters;\r\n    }\r\n\r\n    public get allowDrop(): boolean {\r\n        return getData(this).config.allowDrop;\r\n    }\r\n\r\n    public get allowDropLeft(): boolean {\r\n        return getData(this).config.allowDropLeft;\r\n    }\r\n\r\n    public get allowDropTop(): boolean {\r\n        return getData(this).config.allowDropTop;\r\n    }\r\n\r\n    public get allowDropRight(): boolean {\r\n        return getData(this).config.allowDropRight;\r\n    }\r\n\r\n    public get allowDropBottom(): boolean {\r\n        return getData(this).config.allowDropBottom;\r\n    }\r\n\r\n    public get allowExtract(): boolean {\r\n        return getData(this).config.allowExtract;\r\n    }\r\n\r\n    public get showCloseButton(): boolean {\r\n        return getData(this).config.showCloseButton;\r\n    }\r\n\r\n    public get showSaveButton(): boolean {\r\n        return getData(this).config.showSaveButton;\r\n    }\r\n\r\n    public get minWidth(): number {\r\n        return getData(this).config.minWidth;\r\n    }\r\n\r\n    public get minHeight(): number {\r\n        return getData(this).config.minHeight;\r\n    }\r\n\r\n    public get maxWidth(): number {\r\n        return getData(this).config.maxWidth;\r\n    }\r\n\r\n    public get maxHeight(): number {\r\n        return getData(this).config.maxHeight;\r\n    }\r\n\r\n    public get width(): number {\r\n        return getData(this).config.widthInPx;\r\n    }\r\n\r\n    public get height(): number {\r\n        return getData(this).config.heightInPx;\r\n    }\r\n\r\n    public get showWindowCloseButtons(): boolean {\r\n        return getData(this).config.showWindowCloseButtons;\r\n    }\r\n\r\n    public get showEjectButtons(): boolean {\r\n        return getData(this).config.showEjectButtons;\r\n    }\r\n\r\n    public get showAddWindowButtons(): boolean {\r\n        return getData(this).config.showAddWindowButtons;\r\n    }\r\n\r\n    public async removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const child = this.children.find(predicate);\r\n        if (!child) {\r\n            return;\r\n        }\r\n        await child.close();\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async remove(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const controller = getData(this).controller;\r\n\r\n        const child = controller.iterateFindChild(this.children, predicate);\r\n\r\n        await child.close();\r\n\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async focus(): Promise<void> {\r\n        await getData(this).controller.focusItem(this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async close(): Promise<void> {\r\n        const controller = getData(this).controller;\r\n\r\n        const workspaces = await getData(this).frame.workspaces();\r\n\r\n        const shouldCloseFrame = workspaces.length === 1 && workspaces.every((wsp) => wsp.id === this.id);\r\n\r\n        if (shouldCloseFrame) {\r\n            return this.frame.close();\r\n        }\r\n\r\n        await controller.closeItem(this.id);\r\n    }\r\n\r\n    public snapshot(): Promise<Glue42Workspaces.WorkspaceSnapshot> {\r\n        return getData(this).controller.getSnapshot(this.id, \"workspace\");\r\n    }\r\n\r\n    public async saveLayout(name: string, config?: { saveContext?: boolean }): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        await getData(this).controller.saveLayout({ name, workspaceId: this.id, saveContext: config?.saveContext });\r\n    }\r\n\r\n    public async setTitle(title: string): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(title);\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.setItemTitle(this.id, title);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public getContext(): Promise<any> {\r\n        const controller = getData(this).controller;\r\n        return controller.getWorkspaceContext(this.id);\r\n    }\r\n\r\n    public setContext(data: any): Promise<void> {\r\n        const controller = getData(this).controller;\r\n        return controller.setWorkspaceContext(this.id, data);\r\n    }\r\n\r\n    public updateContext(data: any): Promise<void> {\r\n        const controller = getData(this).controller;\r\n        return controller.updateWorkspaceContext(this.id, data);\r\n    }\r\n\r\n    public onContextUpdated(callback: (data: any) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        const controller = getData(this).controller;\r\n        return controller.subscribeWorkspaceContextUpdated(this.id, callback);\r\n    }\r\n\r\n    public async refreshReference(): Promise<void> {\r\n        const newSnapshot = (await getData(this).controller.getSnapshot(this.id, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n        const currentChildrenFlat = getData(this).controller.flatChildren(getData(this).children);\r\n\r\n        const newChildren = getData(this).controller.refreshChildren({\r\n            existingChildren: currentChildrenFlat,\r\n            workspace: this,\r\n            parent: this,\r\n            children: newSnapshot.children\r\n        });\r\n\r\n        const currentFrame = this.frame;\r\n        let actualFrame: Frame;\r\n\r\n        if (currentFrame.id === newSnapshot.config.frameId) {\r\n            getDataManager(this).remapFrame(currentFrame, newSnapshot.frameSummary);\r\n            actualFrame = currentFrame;\r\n        } else {\r\n            const frameCreateConfig: FrameCreateConfig = {\r\n                summary: newSnapshot.frameSummary\r\n            };\r\n            const newFrame = getData(this).ioc.getModel<\"frame\">(\"frame\", frameCreateConfig);\r\n            actualFrame = newFrame;\r\n        }\r\n\r\n        getDataManager(this).remapWorkspace(this, {\r\n            config: newSnapshot.config,\r\n            children: newChildren,\r\n            frame: actualFrame\r\n        });\r\n    }\r\n\r\n    public getBox(predicate: (box: Glue42Workspaces.WorkspaceBox) => boolean): Glue42Workspaces.WorkspaceBox {\r\n        checkThrowCallback(predicate);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.iterateFindChild(children, (child) => child.type !== \"window\" && predicate(child)) as Glue42Workspaces.WorkspaceBox;\r\n    }\r\n\r\n    public getAllBoxes(predicate?: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Glue42Workspaces.WorkspaceBox[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        const allParents = controller.iterateFilterChildren(children, (child) => child.type !== \"window\") as Glue42Workspaces.WorkspaceBox[];\r\n\r\n        if (!predicate) {\r\n            return allParents;\r\n        }\r\n\r\n        return allParents.filter(predicate);\r\n    }\r\n\r\n    public getRow(predicate: (row: Glue42Workspaces.Row) => boolean): Glue42Workspaces.Row {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"row\" && predicate(parent)) as Glue42Workspaces.Row;\r\n    }\r\n\r\n    public getAllRows(predicate?: (row: Glue42Workspaces.Row) => boolean): Glue42Workspaces.Row[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"row\" && predicate(parent)) as Glue42Workspaces.Row[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"row\") as Glue42Workspaces.Row[];\r\n    }\r\n\r\n    public getColumn(predicate: (column: Glue42Workspaces.Column) => boolean): Glue42Workspaces.Column {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"column\" && predicate(parent)) as Glue42Workspaces.Column;\r\n    }\r\n\r\n    public getAllColumns(predicate?: (columns: Glue42Workspaces.Column) => boolean): Glue42Workspaces.Column[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"column\" && predicate(parent)) as Glue42Workspaces.Column[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"column\") as Glue42Workspaces.Column[];\r\n    }\r\n\r\n    public getGroup(predicate: (group: Glue42Workspaces.Group) => boolean): Glue42Workspaces.Group {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"group\" && predicate(parent)) as Glue42Workspaces.Group;\r\n    }\r\n\r\n    public getAllGroups(predicate?: (group: Glue42Workspaces.Group) => boolean): Glue42Workspaces.Group[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"group\" && predicate(parent)) as Glue42Workspaces.Group[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"group\") as Glue42Workspaces.Group[];\r\n    }\r\n\r\n    public getWindow(predicate: (window: Glue42Workspaces.WorkspaceWindow) => boolean): Glue42Workspaces.WorkspaceWindow {\r\n        checkThrowCallback(predicate);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.iterateFindChild(children, (child) => child.type === \"window\" && predicate(child)) as Glue42Workspaces.WorkspaceWindow;\r\n    }\r\n\r\n    public getAllWindows(predicate?: (window: Glue42Workspaces.WorkspaceWindow) => boolean): Glue42Workspaces.WorkspaceWindow[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        const allWindows = controller.iterateFilterChildren(children, (child) => child.type === \"window\") as Glue42Workspaces.WorkspaceWindow[];\r\n\r\n        if (!predicate) {\r\n            return allWindows;\r\n        }\r\n\r\n        return allWindows.filter(predicate);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Row> {\r\n        return getData(this).base.addParent<Glue42Workspaces.Row>(this, \"row\", \"workspace\", definition);\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Column> {\r\n        return getData(this).base.addParent<Glue42Workspaces.Column>(this, \"column\", \"workspace\", definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Group> {\r\n        return getData(this).base.addParent<Glue42Workspaces.Group>(this, \"group\", \"workspace\", definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getData(this).base.addWindow(this, definition, \"workspace\");\r\n    }\r\n\r\n    public async bundleToRow(): Promise<void> {\r\n        await getData(this).controller.bundleTo(\"row\", this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async bundleToColumn(): Promise<void> {\r\n        await getData(this).controller.bundleTo(\"column\", this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async hibernate(): Promise<void> {\r\n        await getData(this).controller.hibernateWorkspace(this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async resume(): Promise<void> {\r\n        await getData(this).controller.resumeWorkspace(this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async lock(config?: Glue42Workspaces.WorkspaceLockConfig | ((config: Glue42Workspaces.WorkspaceLockConfig) => Glue42Workspaces.WorkspaceLockConfig)): Promise<void> {\r\n        let lockConfigResult = undefined;\r\n\r\n        if (typeof config === \"function\") {\r\n            const currentLockConfig = {\r\n                allowDrop: this.allowDrop,\r\n                allowDropLeft: this.allowDropLeft,\r\n                allowDropTop: this.allowDropTop,\r\n                allowDropRight: this.allowDropRight,\r\n                allowDropBottom: this.allowDropBottom,\r\n                allowExtract: this.allowExtract,\r\n                allowSplitters: this.allowSplitters,\r\n                showCloseButton: this.showCloseButton,\r\n                showSaveButton: this.showSaveButton,\r\n                showAddWindowButtons: this.showAddWindowButtons,\r\n                showEjectButtons: this.showEjectButtons,\r\n                showWindowCloseButtons: this.showWindowCloseButtons\r\n            };\r\n\r\n            lockConfigResult = config(currentLockConfig);\r\n        } else {\r\n            lockConfigResult = config;\r\n        }\r\n\r\n        const verifiedConfig = lockConfigResult === undefined ? undefined : workspaceLockConfigDecoder.runWithException(lockConfigResult);\r\n\r\n        await getData(this).controller.lockWorkspace(this.id, verifiedConfig);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async onClosed(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (): Promise<void> => {\r\n            // await this.refreshReference();\r\n            callback();\r\n        };\r\n        const config: SubscriptionConfig = {\r\n            action: \"closed\",\r\n            eventType: \"workspace\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowAdded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const windowParent = this.getBox((parent) => parent.id === payload.windowSummary.parentId);\r\n\r\n            const foundWindow = windowParent.children.find((child) => {\r\n\r\n                return child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex;\r\n            });\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"added\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowRemoved(callback: (removed: { windowId?: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowLoaded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const foundWindow = this.getWindow((win) => {\r\n                return win.id && win.id === payload.windowSummary.config.windowId;\r\n            });\r\n            callback(foundWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"loaded\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { checkThrowCallback, nonEmptyStringDecoder, windowLockConfigDecoder, elementResizeConfigDecoder } from \"../shared//decoders\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { WindowPrivateData } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { GDWindow } from \"../types/glue\";\r\nimport { Row } from \"./row\";\r\nimport { Column } from \"./column\";\r\nimport { Group } from \"./group\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Window, PrivateData>();\r\n\r\nconst getData = (model: Window): WindowPrivateData => {\r\n    return data.get(model).manager.getWindowData(model);\r\n};\r\n\r\nexport class Window implements Glue42Workspaces.WorkspaceWindow {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).config.windowId;\r\n    }\r\n\r\n    public get elementId(): string {\r\n        return getData(this).id;\r\n    }\r\n\r\n    public get type(): \"window\" {\r\n        return \"window\";\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getData(this).frame.id;\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getData(this).workspace.id;\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getData(this).config.positionIndex;\r\n    }\r\n\r\n    public get isMaximized(): boolean {\r\n        return getData(this).config.isMaximized;\r\n    }\r\n\r\n    public get isLoaded(): boolean {\r\n        return getData(this).controller.checkIsWindowLoaded(this.id);\r\n    }\r\n\r\n    public get focused(): boolean {\r\n        return getData(this).config.isFocused;\r\n    }\r\n\r\n    public get title(): string {\r\n        return getData(this).config.title;\r\n    }\r\n\r\n    public get allowExtract(): boolean {\r\n        return getData(this).config.allowExtract;\r\n    }\r\n\r\n    public get showCloseButton(): boolean {\r\n        return getData(this).config.showCloseButton;\r\n    }\r\n\r\n    public get width(): number {\r\n        return getData(this).config.widthInPx;\r\n    }\r\n\r\n    public get height(): number {\r\n        return getData(this).config.heightInPx;\r\n    }\r\n\r\n    public get minWidth(): number {\r\n        return getData(this).config.minWidth;\r\n    }\r\n\r\n    public get minHeight(): number {\r\n        return getData(this).config.minHeight;\r\n    }\r\n\r\n    public get maxWidth(): number {\r\n        return getData(this).config.maxWidth;\r\n    }\r\n\r\n    public get maxHeight(): number {\r\n        return getData(this).config.maxHeight;\r\n    }\r\n\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getData(this).workspace;\r\n    }\r\n\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getData(this).frame;\r\n    }\r\n\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.Row | Glue42Workspaces.Column | Glue42Workspaces.Group {\r\n        return getData(this).parent;\r\n    }\r\n\r\n    public get appName(): string {\r\n        return getData(this).config.appName;\r\n    }\r\n\r\n    public async forceLoad(): Promise<void> {\r\n        if (this.isLoaded) {\r\n            return;\r\n        }\r\n        const controller = getData(this).controller;\r\n        const itemId = getData(this).id;\r\n\r\n        const windowId = await controller.forceLoadWindow(itemId);\r\n\r\n        getData(this).config.windowId = windowId;\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async focus(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.focusItem(id);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async close(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.closeItem(id);\r\n\r\n        await getData(this)\r\n            .parent\r\n            .removeChild((child) => child.id === id);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async setTitle(title: string): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(title);\r\n\r\n        const itemId = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.setItemTitle(itemId, title);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async maximize(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.maximizeItem(id);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async restore(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.restoreItem(id);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async eject(): Promise<GDWindow> {\r\n        if (!this.isLoaded) {\r\n            throw new Error(\"Cannot eject this window, because it is not loaded yet\");\r\n        }\r\n        const itemId: string = getData(this).id;\r\n\r\n        const newWindowId: string = await getData(this).controller.ejectWindow(itemId);\r\n\r\n        getData(this).config.windowId = newWindowId;\r\n\r\n        await this.workspace.refreshReference();\r\n\r\n        return this.getGdWindow();\r\n    }\r\n\r\n    public getGdWindow(): GDWindow {\r\n        if (!this.isLoaded) {\r\n            throw new Error(\"Cannot fetch this GD window, because the window is not yet loaded\");\r\n        }\r\n\r\n        const myId = getData(this).config.windowId;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.getGDWindow(myId);\r\n    }\r\n\r\n    public async moveTo(parent: Glue42Workspaces.Row | Glue42Workspaces.Column | Glue42Workspaces.Group): Promise<void> {\r\n        if (!(parent instanceof Row || parent instanceof Column || parent instanceof Group)) {\r\n            throw new Error(\"Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group\");\r\n        }\r\n\r\n        const myId = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        const foundParent = await controller.getParent((p) => p.id === parent.id);\r\n\r\n        if (!foundParent) {\r\n            throw new Error(\"Cannot move the window to the selected parent, because this parent does not exist.\");\r\n        }\r\n\r\n        await controller.moveWindowTo(myId, parent.id);\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async lock(config?: Glue42Workspaces.WorkspaceWindowLockConfig | ((config: Glue42Workspaces.WorkspaceWindowLockConfig) => Glue42Workspaces.WorkspaceWindowLockConfig)): Promise<void> {\r\n        let lockConfigResult = undefined;\r\n\r\n        if (typeof config === \"function\") {\r\n            const currentLockConfig = {\r\n                allowExtract: this.allowExtract,\r\n                showCloseButton: this.showCloseButton\r\n            };\r\n            lockConfigResult = config(currentLockConfig);\r\n        } else {\r\n            lockConfigResult = config;\r\n        }\r\n\r\n        const verifiedConfig = lockConfigResult === undefined ? undefined : windowLockConfigDecoder.runWithException(lockConfigResult);\r\n        const windowPlacementId = getData(this).id;\r\n        await getData(this).controller.lockWindow(windowPlacementId, verifiedConfig);\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async setSize(config: Glue42Workspaces.ElementResizeConfig): Promise<void> {\r\n        const verifiedConfig = elementResizeConfigDecoder.runWithException(config);\r\n\r\n        if (!verifiedConfig.width && !verifiedConfig.height) {\r\n            throw new Error(\"Expected either width or height to be passed.\");\r\n        }\r\n\r\n        const myId = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.resizeItem(myId, {\r\n            height: verifiedConfig.height,\r\n            width: verifiedConfig.width,\r\n            relative: false\r\n        });\r\n\r\n        await this.workspace.refreshReference();\r\n    }\r\n\r\n    public async onRemoved(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n        const wrappedCallback = async (): Promise<void> => {\r\n            await this.workspace.refreshReference();\r\n            callback();\r\n        };\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"window\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { checkThrowCallback, nonEmptyStringDecoder, restoreWorkspaceConfigDecoder, workspaceDefinitionDecoder, workspaceBuilderCreateConfigDecoder, resizeConfigDecoder, moveConfigDecoder } from \"../shared/decoders\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { FrameStreamData, WorkspaceStreamData, WindowStreamData } from \"../types/protocol\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\nimport { FramePrivateData } from \"../types/privateData\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Frame, PrivateData>();\r\n\r\nconst getData = (model: Frame): FramePrivateData => {\r\n    return data.get(model).manager.getFrameData(model);\r\n};\r\n\r\nexport class Frame implements Glue42Workspaces.Frame {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).summary.id;\r\n    }\r\n\r\n    public getBounds(): Promise<Glue42Workspaces.FrameBounds> {\r\n        const myId = getData(this).summary.id;\r\n\r\n        return getData(this).controller.getFrameBounds(myId);\r\n    }\r\n\r\n    public async resize(config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        const validatedConfig = resizeConfigDecoder.runWithException(config);\r\n        const myId = getData(this).summary.id;\r\n\r\n        return getData(this).controller.resizeItem(myId, validatedConfig);\r\n    }\r\n\r\n    public async move(config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        const validatedConfig = moveConfigDecoder.runWithException(config);\r\n\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.moveFrame(myId, validatedConfig);\r\n    }\r\n\r\n    public focus(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.focusItem(myId);\r\n    }\r\n\r\n    public async state(): Promise<Glue42Workspaces.FrameState> {\r\n        if (!window.glue42gd) {\r\n            throw new Error(\"State operations are not supported in Glue42 Core\");\r\n        }\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.getFrameState(myId);\r\n    }\r\n\r\n    public async minimize(): Promise<void> {\r\n        if (!window.glue42gd) {\r\n            throw new Error(\"State operations are not supported in Glue42 Core\");\r\n        }\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"minimized\");\r\n    }\r\n\r\n    public async maximize(): Promise<void> {\r\n        if (!window.glue42gd) {\r\n            throw new Error(\"State operations are not supported in Glue42 Core\");\r\n        }\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"maximized\");\r\n    }\r\n\r\n    public async restore(): Promise<void> {\r\n        if (!window.glue42gd) {\r\n            throw new Error(\"State operations are not supported in Glue42 Core\");\r\n        }\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"normal\");\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.closeItem(myId);\r\n    }\r\n\r\n    public snapshot(): Promise<Glue42Workspaces.FrameSnapshot> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.getSnapshot(myId, \"frame\");\r\n    }\r\n\r\n    public async workspaces(): Promise<Glue42Workspaces.Workspace[]> {\r\n        const controller = getData(this).controller;\r\n        return controller.getWorkspacesByFrameId(this.id);\r\n    }\r\n\r\n    public async getConstraints(): Promise<Glue42Workspaces.FrameConstraints> {\r\n        const controller = getData(this).controller;\r\n        const myId = getData(this).summary.id;\r\n\r\n        return controller.getFrameConstraints(myId);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Glue42Workspaces.Workspace> {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        const validatedOptions = restoreWorkspaceConfigDecoder.runWithException(options);\r\n\r\n        return getData(this).controller.restoreWorkspace(name, validatedOptions);\r\n    }\r\n\r\n    public createWorkspace(definition: Glue42Workspaces.WorkspaceDefinition, config?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> {\r\n        const validatedDefinition = workspaceDefinitionDecoder.runWithException(definition);\r\n        const validatedConfig = workspaceBuilderCreateConfigDecoder.runWithException(config);\r\n\r\n        return getData(this).controller.createWorkspace(validatedDefinition, validatedConfig);\r\n    }\r\n\r\n    public async onClosed(callback: (closed: { frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"closed\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onMaximized(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"maximized\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onMinimized(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"minimized\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onNormal(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"normal\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceOpened(callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const workspace = await getData(this).controller.transformStreamPayloadToWorkspace(payload);\r\n            callback(workspace);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"opened\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceSelected(callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const workspace = await getData(this).controller.getWorkspaceById(payload.workspaceSummary.id);\r\n            callback(workspace);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"selected\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceClosed(callback: (closed: { frameId: string; workspaceId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: WorkspaceStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id, workspaceId: payload.workspaceSummary.id });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"closed\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowAdded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const foundParent = await getData(this).controller.getParent((parent) => parent.id === payload.windowSummary.parentId);\r\n            const foundWindow = foundParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"added\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowRemoved(callback: (removed: { windowId?: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: WindowStreamData): void => {\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowLoaded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const foundParent = await getData(this).controller.getParent((parent) => {\r\n                return parent.id === payload.windowSummary.parentId;\r\n            });\r\n            const foundWindow = foundParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"loaded\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { Row } from \"../models/row\";\r\nimport { Column } from \"../models/column\";\r\nimport { Group } from \"../models/group\";\r\nimport { ParentPrivateData, WorkspacePrivateData, WindowPrivateData, FramePrivateData, RemapChildData, RemapWorkspaceData } from \"../types/privateData\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { Window } from \"../models/window\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { SwimlaneWindowSnapshotConfig, ParentSnapshotConfig, FrameSummaryResult } from \"../types/protocol\";\r\nimport { Child, SubParentTypes } from \"../types/builders\";\r\n\r\nexport class PrivateDataManager {\r\n    private readonly parentsData = new WeakMap<SubParentTypes, ParentPrivateData>();\r\n    private readonly workspacesData = new WeakMap<Workspace, WorkspacePrivateData>();\r\n    private readonly windowsData = new WeakMap<Window, WindowPrivateData>();\r\n    private readonly framesData = new WeakMap<Frame, FramePrivateData>();\r\n    // Without this collection there is no way to get a window instance before its loaded\r\n    // e.g addWindow returns a window however this window doesn't have a placement id needed for force load\r\n    private readonly windowPlacementIdData: { [key: string]: Window } = {};\r\n\r\n    public deleteData<T>(model: T): void {\r\n        if (model instanceof Window) {\r\n            const keyForDeleting =\r\n                Object.keys(this.windowPlacementIdData)\r\n                    .find((k) => this.windowPlacementIdData[k] === model);\r\n\r\n            if (keyForDeleting) {\r\n                delete this.windowPlacementIdData[keyForDeleting];\r\n            }\r\n\r\n            this.windowsData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Workspace) {\r\n            this.workspacesData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Row || model instanceof Column || model instanceof Group) {\r\n            this.parentsData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Frame) {\r\n            this.framesData.delete(model);\r\n        }\r\n    }\r\n\r\n    public setWindowData(model: Window, data: WindowPrivateData): void {\r\n\r\n        this.windowPlacementIdData[data.id] = model;\r\n        this.windowsData.set(model, data);\r\n    }\r\n\r\n    public setWorkspaceData(model: Workspace, data: WorkspacePrivateData): void {\r\n        this.workspacesData.set(model, data);\r\n    }\r\n\r\n    public setParentData(model: SubParentTypes, data: ParentPrivateData): void {\r\n        this.parentsData.set(model, data);\r\n    }\r\n\r\n    public setFrameData(model: Frame, data: FramePrivateData): void {\r\n        this.framesData.set(model, data);\r\n    }\r\n\r\n    public getWindowData(model: Window): WindowPrivateData {\r\n        return this.windowsData.get(model);\r\n    }\r\n\r\n    public getWindowByPlacementId(placementId: string): Window {\r\n        return this.windowPlacementIdData[placementId];\r\n    }\r\n\r\n    public getWorkspaceData(model: Workspace): WorkspacePrivateData {\r\n        return this.workspacesData.get(model);\r\n    }\r\n\r\n    public getParentData(model: SubParentTypes): ParentPrivateData {\r\n        return this.parentsData.get(model);\r\n    }\r\n\r\n    public getFrameData(model: Frame): FramePrivateData {\r\n        return this.framesData.get(model);\r\n    }\r\n\r\n    public remapChild(model: Child, newData: RemapChildData): void {\r\n        if (model instanceof Window) {\r\n            const data = this.windowsData.get(model);\r\n            data.parent = newData.parent || data.parent;\r\n            data.config = newData.config as SwimlaneWindowSnapshotConfig || data.config;\r\n        }\r\n\r\n        if (model instanceof Row || model instanceof Column || model instanceof Group) {\r\n            const data = this.parentsData.get(model);\r\n            data.parent = newData.parent || data.parent;\r\n            data.config = newData.config as ParentSnapshotConfig || data.config;\r\n            data.children = newData.children || data.children;\r\n        }\r\n    }\r\n\r\n    public remapFrame(model: Frame, newData: FrameSummaryResult): void {\r\n        const data = this.framesData.get(model);\r\n        data.summary = newData;\r\n    }\r\n\r\n    public remapWorkspace(model: Workspace, newData: RemapWorkspaceData): void {\r\n        const data = this.workspacesData.get(model);\r\n        data.frame = newData.frame || data.frame;\r\n        data.config = newData.config || data.config;\r\n        data.children = newData.children || data.children;\r\n    }\r\n}\r\n","import { Workspace } from \"../workspace\";\r\nimport { ParentBuilder } from \"../../builders/parentBuilder\";\r\nimport { strictParentDefinitionDecoder, swimlaneWindowDefinitionDecoder, checkThrowCallback } from \"../../shared/decoders\";\r\nimport { SubParent, AllParentTypes, Child, SubParentTypes, AllParent, ContainerLockConfig } from \"../../types/builders\";\r\nimport { PrivateDataManager } from \"../../shared/privateDataManager\";\r\nimport { ParentPrivateData, WorkspacePrivateData } from \"../../types/privateData\";\r\nimport { Window } from \"../../models/window\";\r\nimport { Glue42Workspaces } from \"../../../workspaces\";\r\nimport { Group } from \"../group\";\r\nimport { Row } from \"../row\";\r\nimport { Column } from \"../column\";\r\nimport { ColumnSnapshotConfig, GroupSnapshotConfig, RowSnapshotConfig } from \"../../types/protocol\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Base, PrivateData>();\r\n\r\nconst getData = (base: Base, model: AllParentTypes): WorkspacePrivateData | ParentPrivateData => {\r\n    const manager = data.get(base).manager;\r\n\r\n    if (model instanceof Workspace) {\r\n        return manager.getWorkspaceData(model);\r\n    }\r\n\r\n    return data.get(base).manager.getParentData(model as SubParentTypes);\r\n};\r\n\r\nconst getWindowFromPlacementId = (base: Base, placemenId: string): Window => {\r\n    const manager = data.get(base).manager;\r\n\r\n    return manager.getWindowByPlacementId(placemenId);\r\n};\r\n\r\nexport class Base {\r\n    public frameId: string;\r\n    public workspaceId: string;\r\n    public positionIndex: number;\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public getId(model: AllParentTypes): string {\r\n        return getData(this, model).id;\r\n    }\r\n\r\n    public getPositionIndex(model: AllParentTypes): number {\r\n        return getData(this, model).config.positionIndex;\r\n    }\r\n\r\n    public getWorkspaceId(model: AllParentTypes): string {\r\n        const privateData = getData(this, model) as ParentPrivateData;\r\n        return privateData.config.workspaceId || privateData.workspace.id;\r\n    }\r\n\r\n    public getFrameId(model: AllParentTypes): string {\r\n        return getData(this, model).frame.id;\r\n    }\r\n\r\n    public getAllChildren(model: AllParentTypes, predicate?: (child: Child) => boolean): Child[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this, model).children;\r\n\r\n        if (typeof predicate === \"undefined\") {\r\n            return children;\r\n        }\r\n\r\n        return children.filter(predicate);\r\n    }\r\n\r\n    public getMyParent(model: AllParentTypes): AllParentTypes {\r\n        if (model instanceof Workspace) {\r\n            return;\r\n        }\r\n        return (getData(this, model) as ParentPrivateData).parent;\r\n    }\r\n\r\n    public getMyFrame(model: AllParentTypes): Glue42Workspaces.Frame {\r\n        return getData(this, model).frame;\r\n    }\r\n\r\n    public getMyWorkspace(model: AllParentTypes): Workspace {\r\n        if (model instanceof Workspace) {\r\n            return;\r\n        }\r\n        return (getData(this, model) as ParentPrivateData).workspace;\r\n    }\r\n\r\n    public async addWindow(model: AllParentTypes, definition: Glue42Workspaces.WorkspaceWindowDefinition, parentType: AllParent): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        if (!definition.appName && !definition.windowId) {\r\n            throw new Error(\"The window definition should contain either an appName or a windowId\");\r\n        }\r\n\r\n        const validatedDefinition = swimlaneWindowDefinitionDecoder.runWithException(definition);\r\n        const controller = getData(this, model).controller;\r\n\r\n        const operationResult = await controller.add(\"window\", getData(this, model).id, parentType, validatedDefinition);\r\n\r\n        if (model instanceof Workspace) {\r\n            await model.refreshReference();\r\n            return getWindowFromPlacementId(this, operationResult.itemId);\r\n        }\r\n\r\n        await this.getMyWorkspace(model).refreshReference();\r\n\r\n        return getWindowFromPlacementId(this, operationResult.itemId);\r\n    }\r\n\r\n    public async addParent<T>(model: AllParentTypes, typeToAdd: SubParent, parentType: AllParent, definition?: Glue42Workspaces.BoxDefinition | ParentBuilder): Promise<T> {\r\n        const parentDefinition = this.transformDefinition(typeToAdd, definition);\r\n        const controller = getData(this, model).controller;\r\n\r\n        const newParentId = (await controller.add(\"container\", getData(this, model).id, parentType, parentDefinition)).itemId;\r\n\r\n        if (model instanceof Workspace) {\r\n            await model.refreshReference();\r\n            return model.getBox((parent) => parent.id === newParentId) as unknown as T;\r\n        }\r\n\r\n        const myWorkspace = this.getMyWorkspace(model);\r\n        await myWorkspace.refreshReference();\r\n\r\n        return myWorkspace.getBox((parent) => parent.id === newParentId) as unknown as T;\r\n    }\r\n\r\n    public async removeChild(model: AllParentTypes, predicate: (child: Child) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const child = this.getAllChildren(model).find(predicate);\r\n        if (!child) {\r\n            return;\r\n        }\r\n\r\n        await child.close();\r\n\r\n        if (model instanceof Workspace) {\r\n\r\n            await model.refreshReference();\r\n            return;\r\n        }\r\n\r\n        await this.getMyWorkspace(model).refreshReference();\r\n    }\r\n\r\n    public async maximize(model: SubParentTypes): Promise<void> {\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.maximizeItem(getData(this, model).id);\r\n\r\n        if (model.parent instanceof Workspace) {\r\n            await model.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(model.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public async restore(model: SubParentTypes): Promise<void> {\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.restoreItem(getData(this, model).id);\r\n\r\n        if (model.parent instanceof Workspace) {\r\n            await model.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(model.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public async close(model: SubParentTypes): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.closeItem(modelData.id);\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public async lockContainer(model: SubParentTypes, config?: ContainerLockConfig): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.lockContainer(modelData.id, model.type, config);\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public getAllowDrop(model: SubParentTypes): boolean {\r\n        return getData(this, model).config.allowDrop;\r\n    }\r\n\r\n    public getAllowDropLeft(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Property allowDropLeft is available only for groups and not on ${model.type} ${model.id}`);\r\n        }\r\n        return privateData.config.allowDropLeft;\r\n    }\r\n\r\n    public getAllowDropRight(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Property allowDropRight is available only for groups and not on ${model.type} ${model.id}`);\r\n        }\r\n        return privateData.config.allowDropRight;\r\n    }\r\n\r\n    public getAllowDropTop(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Property allowDropTop is available only for groups and not on ${model.type} ${model.id}`);\r\n        }\r\n        return privateData.config.allowDropTop;\r\n    }\r\n\r\n    public getAllowDropBottom(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Property allowDropBottom is available only for groups and not on ${model.type} ${model.id}`);\r\n        }\r\n        return privateData.config.allowDropBottom;\r\n    }\r\n\r\n    public getAllowDropHeader(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Property allowDropHeader is available only for groups and not on ${model.type} ${model.id}`);\r\n        }\r\n        return privateData.config.allowDropHeader;\r\n    }\r\n\r\n    public getAllowSplitters(model: Row | Column): boolean {\r\n        const privateData = getData(this, model);\r\n\r\n        if (privateData.type === \"group\") {\r\n            throw new Error(`Cannot get allow splitters from private data ${privateData.type}`);\r\n        }\r\n\r\n        return privateData.config.allowSplitters;\r\n    }\r\n\r\n    public getAllowExtract(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Cannot get allow extract from private data${privateData.type} with config ${privateData.type !== \"workspace\" ? privateData.config.type : \"\"}`);\r\n        }\r\n        return privateData.config.allowExtract;\r\n    }\r\n\r\n    public getShowMaximizeButton(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Cannot get show maximize button from private data${privateData.type} with config ${privateData.type !== \"workspace\" ? privateData.config.type : \"\"}`);\r\n        }\r\n        return privateData.config.showMaximizeButton;\r\n    }\r\n\r\n    public getShowEjectButton(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Cannot get show eject button from private data${privateData.type} with config ${privateData.type !== \"workspace\" ? privateData.config.type : \"\"}`);\r\n        }\r\n        return privateData.config.showEjectButton;\r\n    }\r\n\r\n    public getShowAddWindowButton(model: Group): boolean {\r\n        const privateData = getData(this, model);\r\n        if (privateData.type !== \"group\") {\r\n            throw new Error(`Cannot get add window button from private data${privateData.type} with config ${privateData.type !== \"workspace\" ? privateData.config.type : \"\"}`);\r\n        }\r\n        return privateData.config.showAddWindowButton;\r\n    }\r\n\r\n    public getMinWidth(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.minWidth;\r\n    }\r\n\r\n    public getMaxWidth(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.maxWidth;\r\n    }\r\n\r\n    public getMinHeight(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.minHeight;\r\n    }\r\n\r\n    public getMaxHeight(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.maxHeight;\r\n    }\r\n\r\n    public getWidthInPx(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.widthInPx;\r\n    }\r\n\r\n    public getHeightInPx(model: SubParentTypes): number {\r\n        const privateData = getData(this, model);\r\n\r\n        return privateData.config.heightInPx;\r\n    }\r\n\r\n    public getIsPinned(model: Column | Row): boolean {\r\n        const privateData = getData(this, model);\r\n\r\n        return (privateData.config as RowSnapshotConfig | ColumnSnapshotConfig).isPinned;\r\n    }\r\n\r\n    public getIsMaximized(model: Column | Row | Group): boolean {\r\n        const privateData = getData(this, model);\r\n\r\n        return (privateData.config as RowSnapshotConfig | ColumnSnapshotConfig | GroupSnapshotConfig).isMaximized;\r\n    }\r\n\r\n    public async setHeight(model: Row, height: number): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n        const { controller } = modelData;\r\n\r\n        await controller.resizeItem(getData(this, model).id, {\r\n            height\r\n        });\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public async setWidth(model: Column, width: number): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n        const { controller } = modelData;\r\n\r\n        await controller.resizeItem(getData(this, model).id, {\r\n            width\r\n        });\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    public async setSize(model: Group, width?: number, height?: number): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n        const { controller } = modelData;\r\n\r\n        await controller.resizeItem(getData(this, model).id, {\r\n            width,\r\n            height\r\n        });\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    private transformDefinition(type: \"group\" | \"row\" | \"column\", definition?: Glue42Workspaces.BoxDefinition | ParentBuilder): Glue42Workspaces.BoxDefinition {\r\n        let parentDefinition: Glue42Workspaces.BoxDefinition;\r\n\r\n        if (typeof definition === \"undefined\") {\r\n            parentDefinition = { type, children: [] };\r\n        } else if (definition instanceof ParentBuilder) {\r\n            parentDefinition = definition.serialize();\r\n        } else {\r\n            if (typeof definition.type === \"undefined\") {\r\n                definition.type = type;\r\n            }\r\n            parentDefinition = strictParentDefinitionDecoder.runWithException(definition);\r\n            parentDefinition.children = parentDefinition.children || [];\r\n        }\r\n\r\n        return parentDefinition;\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { WorkspaceSnapshotResult, WorkspaceCreateConfigProtocol, FrameSummaryResult, AddItemResult, WorkspaceSummariesResult, WorkspaceSummaryResult, SimpleWindowOperationSuccessResult, FrameSnapshotResult, WorkspaceStreamData } from \"../types/protocol\";\r\nimport { OPERATIONS } from \"../communication/constants\";\r\nimport { FrameCreateConfig, WorkspaceIoCCreateConfig, WindowCreateConfig, ParentCreateConfig } from \"../types/ioc\";\r\nimport { IoC } from \"../shared/ioc\";\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { GDWindow, WindowsAPI, ContextsAPI, LayoutsAPI } from \"../types/glue\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { RefreshChildrenConfig } from \"../types/privateData\";\r\nimport { AllParentTypes, Child, ContainerLockConfig, SubParentTypes } from \"../types/builders\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { Window } from \"../models/window\";\r\nimport { UnsubscribeFunction } from \"callback-registry\";\r\n\r\nexport class BaseController {\r\n\r\n    constructor(\r\n        private readonly ioc: IoC,\r\n        private readonly windows: WindowsAPI,\r\n        private readonly contexts: ContextsAPI,\r\n        private readonly layouts: LayoutsAPI,\r\n    ) { }\r\n\r\n    private get bridge(): Bridge {\r\n        return this.ioc.bridge;\r\n    }\r\n\r\n    private get privateDataManager(): PrivateDataManager {\r\n        return this.ioc.privateDataManager;\r\n    }\r\n\r\n    public checkIsWindowLoaded(windowId: string): boolean {\r\n        return windowId && this.windows.list().some((win) => win.id === windowId);\r\n    }\r\n\r\n    public async createWorkspace(createConfig: WorkspaceCreateConfigProtocol): Promise<Workspace> {\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.createWorkspace.name, createConfig);\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: snapshot.frameSummary\r\n        };\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Workspace> {\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.openWorkspace.name, { name, restoreOptions: options });\r\n\r\n        const frameSummary = await this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId: snapshot.config.frameId });\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: frameSummary\r\n        };\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n    }\r\n\r\n    public async add(type: \"container\" | \"window\", parentId: string, parentType: \"row\" | \"column\" | \"group\" | \"workspace\", definition: Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition): Promise<AddItemResult> {\r\n        let operationName: string;\r\n        const operationArgs = { definition, parentId, parentType };\r\n\r\n        if (type === \"window\") {\r\n            operationName = OPERATIONS.addWindow.name;\r\n        } else if (type === \"container\") {\r\n            operationName = OPERATIONS.addContainer.name;\r\n        } else {\r\n            throw new Error(`Unrecognized add type: ${type}`);\r\n        }\r\n\r\n        return await this.bridge.send<AddItemResult>(operationName, operationArgs);\r\n    }\r\n\r\n    public async getFrame(windowId: string): Promise<Frame> {\r\n        const frameSummary = await this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId: windowId });\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: frameSummary\r\n        };\r\n        return this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n    }\r\n\r\n    public getFrames(allFrameSummaries: FrameSummaryResult[], predicate?: (frame: Frame) => boolean): Frame[] {\r\n\r\n        return allFrameSummaries.reduce<Frame[]>((frames, frameSummary) => {\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: frameSummary\r\n            };\r\n            const frameToCheck = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            if (!predicate || predicate(frameToCheck)) {\r\n                frames.push(frameToCheck);\r\n            }\r\n\r\n            return frames;\r\n        }, []);\r\n    }\r\n\r\n    public getAllWorkspaceSummaries(...bridgeResults: WorkspaceSummariesResult[]): Glue42Workspaces.WorkspaceSummary[] {\r\n\r\n        const allSummaries = bridgeResults.reduce<WorkspaceSummaryResult[]>((summaries, summaryResult) => {\r\n            summaries.push(...summaryResult.summaries);\r\n            return summaries;\r\n        }, []);\r\n\r\n        return allSummaries.map<Glue42Workspaces.WorkspaceSummary>((summary) => {\r\n\r\n            return Object.assign(\r\n                {},\r\n                { id: summary.id, width: summary.config.widthInPx, height: summary.config.heightInPx },\r\n                summary.config\r\n            );\r\n        });\r\n    }\r\n\r\n    public handleOnSaved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        const wrappedCallback = (layout: Glue42Workspaces.WorkspaceLayout): void => {\r\n            if (layout.type !== \"Workspace\") {\r\n                return;\r\n            }\r\n\r\n            callback(layout);\r\n        };\r\n\r\n        const addedUnSub: UnsubscribeFunction = this.layouts.onAdded(wrappedCallback);\r\n        const changedUnSub: UnsubscribeFunction = this.layouts.onChanged(wrappedCallback);\r\n\r\n        return (): void => {\r\n            addedUnSub();\r\n            changedUnSub();\r\n        };\r\n    }\r\n\r\n    public handleOnRemoved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        const wrappedCallback = (layout: Glue42Workspaces.WorkspaceLayout): void => {\r\n            if (layout.type !== \"Workspace\") {\r\n                return;\r\n            }\r\n\r\n            callback(layout);\r\n        };\r\n\r\n        return this.layouts.onRemoved(wrappedCallback);\r\n    }\r\n\r\n    public async transformStreamPayloadToWorkspace(payload: WorkspaceStreamData): Promise<Workspace> {\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: payload.frameSummary\r\n        };\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const snapshot = payload.workspaceSnapshot || (await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.getWorkspaceSnapshot.name, { itemId: payload.workspaceSummary.id }));\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        const workspace = this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n        return workspace;\r\n    }\r\n\r\n    public async fetchWorkspace(workspaceId: string): Promise<Workspace> {\r\n\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.getWorkspaceSnapshot.name, { itemId: workspaceId });\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: snapshot.frameSummary\r\n        };\r\n\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n    }\r\n\r\n    public async bundleTo(type: \"row\" | \"column\", workspaceId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.bundleWorkspace.name, { type, workspaceId });\r\n    }\r\n\r\n    public getWorkspaceContext(workspaceId: string): Promise<any> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.get(contextName);\r\n    }\r\n\r\n    public setWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.set(contextName, data);\r\n    }\r\n\r\n    public updateWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.update(contextName, data);\r\n    }\r\n\r\n    public subscribeWorkspaceContextUpdated(workspaceId: string, callback: (data: any) => void): Promise<UnsubscribeFunction> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.subscribe(contextName, callback);\r\n    }\r\n\r\n    public async restoreItem(itemId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.restoreItem.name, { itemId });\r\n    }\r\n\r\n    public async maximizeItem(itemId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.maximizeItem.name, { itemId });\r\n    }\r\n\r\n    public async focusItem(itemId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.focusItem.name, { itemId });\r\n    }\r\n\r\n    public async closeItem(itemId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.closeItem.name, { itemId });\r\n    }\r\n\r\n    public async resizeItem(itemId: string, config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.resizeItem.name, Object.assign({}, { itemId }, config));\r\n    }\r\n\r\n    public async moveFrame(itemId: string, config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.moveFrame.name, Object.assign({}, { itemId }, config));\r\n    }\r\n\r\n    public getGDWindow(itemId: string): GDWindow {\r\n        return this.windows.list().find((gdWindow) => gdWindow.id === itemId);\r\n    }\r\n\r\n    public async forceLoadWindow(itemId: string): Promise<string> {\r\n        const controlResult = await this.bridge.send<SimpleWindowOperationSuccessResult>(OPERATIONS.forceLoadWindow.name, { itemId });\r\n\r\n        return controlResult.windowId;\r\n    }\r\n\r\n    public async ejectWindow(itemId: string): Promise<SimpleWindowOperationSuccessResult> {\r\n        return await this.bridge.send<SimpleWindowOperationSuccessResult>(OPERATIONS.ejectWindow.name, { itemId });\r\n    }\r\n\r\n    public async moveWindowTo(itemId: string, newParentId: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.moveWindowTo.name, { itemId, containerId: newParentId });\r\n    }\r\n\r\n    public async getSnapshot(itemId: string, type: \"workspace\" | \"frame\"): Promise<WorkspaceSnapshotResult | FrameSnapshotResult> {\r\n        let result: WorkspaceSnapshotResult | FrameSnapshotResult;\r\n\r\n        if (type === \"workspace\") {\r\n            result = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.getWorkspaceSnapshot.name, { itemId });\r\n        } else if (type === \"frame\") {\r\n            result = await this.bridge.send<FrameSnapshotResult>(OPERATIONS.getFrameSnapshot.name, { itemId });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public async setItemTitle(itemId: string, title: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.setItemTitle.name, { itemId, title });\r\n    }\r\n\r\n    public refreshChildren(config: RefreshChildrenConfig): Child[] {\r\n        const { parent, children, existingChildren, workspace } = config;\r\n        if (parent instanceof Window || (parent as Glue42Workspaces.WorkspaceWindow).type === \"window\") {\r\n            return;\r\n        }\r\n\r\n        const newChildren = children.map((newChildSnapshot) => {\r\n            let childToAdd = existingChildren.find((child) => {\r\n                return child.type === \"window\" ? child.elementId === newChildSnapshot.id : child.id === newChildSnapshot.id;\r\n            });\r\n\r\n            if (childToAdd) {\r\n                this.privateDataManager.remapChild(childToAdd, {\r\n                    parent: parent as AllParentTypes,\r\n                    children: [],\r\n                    config: newChildSnapshot.config\r\n                });\r\n            } else {\r\n                let createConfig: WindowCreateConfig | ParentCreateConfig;\r\n                if (newChildSnapshot.type === \"window\") {\r\n                    createConfig = {\r\n                        id: newChildSnapshot.id,\r\n                        parent: parent as AllParentTypes,\r\n                        frame: workspace.frame,\r\n                        workspace,\r\n                        config: newChildSnapshot.config,\r\n                    } as WindowCreateConfig;\r\n                } else {\r\n                    createConfig = {\r\n                        id: newChildSnapshot.id,\r\n                        parent: parent as AllParentTypes,\r\n                        frame: workspace.frame,\r\n                        workspace,\r\n                        config: newChildSnapshot.config,\r\n                        children: []\r\n                    } as ParentCreateConfig;\r\n                }\r\n\r\n                childToAdd = this.ioc.getModel<\"child\">(newChildSnapshot.type, createConfig);\r\n            }\r\n\r\n            if (newChildSnapshot.type !== \"window\") {\r\n                this.refreshChildren({\r\n                    workspace, existingChildren,\r\n                    children: newChildSnapshot.children,\r\n                    parent: childToAdd\r\n                });\r\n            }\r\n\r\n            return childToAdd;\r\n        });\r\n\r\n        if (parent instanceof Workspace) {\r\n            return newChildren;\r\n        } else {\r\n            this.privateDataManager.remapChild(parent as SubParentTypes, { children: newChildren });\r\n            return newChildren;\r\n        }\r\n    }\r\n\r\n    public iterateFindChild(children: Child[], predicate: (child: Child) => boolean): Child {\r\n        let foundChild = children.find((child) => predicate(child));\r\n\r\n        if (foundChild) {\r\n            return foundChild;\r\n        }\r\n\r\n        children.some((child) => {\r\n            if (child instanceof Window) {\r\n                return false;\r\n            }\r\n\r\n            foundChild = this.iterateFindChild((child as SubParentTypes).children, predicate);\r\n\r\n            if (foundChild) {\r\n                return true;\r\n            }\r\n        });\r\n\r\n        return foundChild;\r\n    }\r\n\r\n    public iterateFilterChildren(children: Child[], predicate: (child: Child) => boolean): Child[] {\r\n        const foundChildren = children.filter((child) => predicate(child));\r\n\r\n        const grandChildren = children.reduce<Child[]>((innerFound, child) => {\r\n            if (child instanceof Window) {\r\n                return innerFound;\r\n            }\r\n\r\n            innerFound.push(...this.iterateFilterChildren((child as SubParentTypes).children, predicate));\r\n\r\n            return innerFound;\r\n        }, []);\r\n\r\n        foundChildren.push(...grandChildren);\r\n\r\n        return foundChildren;\r\n    }\r\n\r\n    public notifyWindowAdded(windowId: string): Promise<void> {\r\n        return new Promise((resolve) => {\r\n\r\n            const alreadyPresent: boolean = this.windows.list().some((win) => win.id === windowId);\r\n\r\n            if (alreadyPresent) {\r\n                return resolve();\r\n            }\r\n\r\n            const unsubscribe: UnsubscribeFunction = this.windows.onWindowAdded((win) => {\r\n\r\n                if (win.id !== windowId) {\r\n                    return;\r\n                }\r\n\r\n                if (unsubscribe) {\r\n                    unsubscribe();\r\n                }\r\n\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    public async hibernateWorkspace(workspaceId: string): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.hibernateWorkspace.name, { workspaceId });\r\n    }\r\n\r\n    public async resumeWorkspace(workspaceId: string): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.resumeWorkspace.name, { workspaceId });\r\n    }\r\n\r\n    public async lockWorkspace(workspaceId: string, config?: Glue42Workspaces.WorkspaceLockConfig): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.lockWorkspace.name, { workspaceId, config });\r\n    }\r\n\r\n    public async lockWindow(windowPlacementId: string, config?: Glue42Workspaces.WorkspaceWindowLockConfig): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.lockWindow.name, { windowPlacementId, config });\r\n    }\r\n\r\n    public async lockContainer(itemId: string, type: SubParentTypes[\"type\"], config?: ContainerLockConfig): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.lockContainer.name, { itemId, type, config });\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { IsWindowInSwimlaneResult, WorkspaceCreateConfigProtocol, WorkspaceSnapshotResult, FrameSummariesResult, WorkspaceSummariesResult, LayoutSummariesResult, ExportedLayoutsResult, FrameSnapshotResult, AddItemResult, WindowStreamData, FrameStateResult, FrameBoundsResult, WorkspaceStreamData } from \"../types/protocol\";\r\nimport { OPERATIONS } from \"../communication/constants\";\r\nimport { SubscriptionConfig, WorkspaceEventType, WorkspaceEventAction } from \"../types/subscription\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { Child, ContainerLockConfig, SubParentTypes } from \"../types/builders\";\r\nimport { RefreshChildrenConfig } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\nimport { GDWindow } from \"../types/glue\";\r\nimport { BaseController } from \"./base\";\r\nimport { UnsubscribeFunction } from \"callback-registry\";\r\n\r\nexport class MainController implements WorkspacesController {\r\n\r\n    constructor(\r\n        private readonly bridge: Bridge,\r\n        private readonly base: BaseController\r\n    ) { }\r\n\r\n    public checkIsWindowLoaded(windowId: string): boolean {\r\n        return this.base.checkIsWindowLoaded(windowId);\r\n    }\r\n\r\n    public async checkIsInSwimlane(windowId: string): Promise<boolean> {\r\n\r\n        const controlResult = await this.bridge.send<IsWindowInSwimlaneResult>(OPERATIONS.isWindowInWorkspace.name, { itemId: windowId });\r\n\r\n        return controlResult.inWorkspace;\r\n    }\r\n\r\n    public async createWorkspace(definition: Glue42Workspaces.WorkspaceDefinition, saveConfig?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Workspace> {\r\n        const createConfig: WorkspaceCreateConfigProtocol = Object.assign({}, definition, { saveConfig });\r\n\r\n        return await this.base.createWorkspace(createConfig);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Workspace> {\r\n        const allLayouts = await this.getLayoutSummaries();\r\n\r\n        const layoutExists = allLayouts.some((summary) => summary.name === name);\r\n\r\n        if (!layoutExists) {\r\n            throw new Error(`This layout: ${name} cannot be restored, because it doesn't exist.`);\r\n        }\r\n\r\n        if (options?.frameId) {\r\n            const allFrameSummaries = await this.bridge.send<FrameSummariesResult>(OPERATIONS.getAllFramesSummaries.name);\r\n\r\n            const foundMatchingFrame = allFrameSummaries.summaries.some((summary) => summary.id === options.frameId);\r\n\r\n            if (!foundMatchingFrame) {\r\n                throw new Error(`Cannot reuse the frame with id: ${options.frameId}, because there is no frame with that ID found`);\r\n            }\r\n        }\r\n\r\n        return await this.base.restoreWorkspace(name, options);\r\n    }\r\n\r\n    public async add(type: \"container\" | \"window\", parentId: string, parentType: \"row\" | \"column\" | \"group\" | \"workspace\", definition: Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition): Promise<AddItemResult> {\r\n        return await this.base.add(type, parentId, parentType, definition);\r\n    }\r\n\r\n    public processLocalSubscription(config: SubscriptionConfig, levelId: string): Promise<Glue42Workspaces.Unsubscribe> {\r\n        return window.glue42gd ?\r\n            this.handleEnterpriseLocalSubscription(config, levelId) :\r\n            this.handleCoreLocalSubscription(config, levelId);\r\n    }\r\n\r\n    public processGlobalSubscription(callback: (callbackData: unknown) => void, eventType: WorkspaceEventType, action: WorkspaceEventAction): Promise<Glue42Workspaces.Unsubscribe> {\r\n        return window.glue42gd ?\r\n            this.handleEnterpriseGlobalSubscription(callback, eventType, action) :\r\n            this.handleCoreGlobalSubscription(callback, eventType, action);\r\n    }\r\n\r\n    public async getFrame(selector: { windowId?: string; predicate?: (frame: Frame) => boolean }): Promise<Frame> {\r\n\r\n        if (selector.windowId) {\r\n            return await this.base.getFrame(selector.windowId);\r\n        }\r\n\r\n        if (selector.predicate) {\r\n            return (await this.getFrames(selector.predicate))[0];\r\n        }\r\n\r\n        throw new Error(`The provided selector is not valid: ${JSON.stringify(selector)}`);\r\n    }\r\n\r\n    public async getFrames(predicate?: (frame: Frame) => boolean): Promise<Frame[]> {\r\n\r\n        const allFrameSummaries = await this.bridge.send<FrameSummariesResult>(OPERATIONS.getAllFramesSummaries.name);\r\n\r\n        return this.base.getFrames(allFrameSummaries.summaries, predicate);\r\n    }\r\n\r\n    public getWorkspaceById(workspaceId: string): Promise<Workspace> {\r\n        return this.base.fetchWorkspace(workspaceId);\r\n    }\r\n\r\n    public transformStreamPayloadToWorkspace(payload: WorkspaceStreamData): Promise<Workspace> {\r\n        return this.base.transformStreamPayloadToWorkspace(payload);\r\n    }\r\n\r\n    public async getWorkspace(predicate: (workspace: Workspace) => boolean): Promise<Workspace> {\r\n        let foundWorkspace: Workspace;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            if (predicate(wsp)) {\r\n                foundWorkspace = wsp;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return foundWorkspace;\r\n    }\r\n\r\n    public async getWorkspaces(predicate?: (workspace: Workspace) => boolean): Promise<Workspace[]> {\r\n        const matchingWorkspaces: Workspace[] = [] as Workspace[];\r\n\r\n        await this.iterateWorkspaces((wsp) => {\r\n            if (!predicate || predicate(wsp)) {\r\n                matchingWorkspaces.push(wsp);\r\n            }\r\n        });\r\n\r\n        return matchingWorkspaces;\r\n    }\r\n\r\n    public async getWorkspacesByFrameId(frameId: string): Promise<Workspace[]> {\r\n        const workspaceSummaries = await this.getAllWorkspaceSummaries();\r\n        const summariesForFrame = workspaceSummaries.filter((s) => s.frameId === frameId);\r\n\r\n        const workspacesForFrame = await Promise.all(summariesForFrame.map((summary) => {\r\n            return this.base.fetchWorkspace(summary.id);\r\n        }));\r\n\r\n        return workspacesForFrame;\r\n    }\r\n\r\n    public async getAllWorkspaceSummaries(): Promise<Glue42Workspaces.WorkspaceSummary[]> {\r\n\r\n        const allSummariesResult = await this.bridge.send<WorkspaceSummariesResult>(OPERATIONS.getAllWorkspacesSummaries.name, {});\r\n\r\n        return this.base.getAllWorkspaceSummaries(allSummariesResult);\r\n    }\r\n\r\n    public async getWindow(predicate: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => boolean): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        let resultWindow: Glue42Workspaces.WorkspaceWindow;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            const foundWindow = wsp.getWindow(predicate);\r\n\r\n            if (foundWindow) {\r\n                resultWindow = foundWindow;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultWindow;\r\n    }\r\n\r\n    public async getParent(predicate: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Promise<Glue42Workspaces.WorkspaceBox> {\r\n        let resultParent: Glue42Workspaces.WorkspaceBox;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n\r\n            const foundParent = wsp.getBox(predicate);\r\n\r\n            if (foundParent) {\r\n                resultParent = foundParent;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultParent;\r\n    }\r\n\r\n    public async getLayoutSummaries(): Promise<Glue42Workspaces.WorkspaceLayoutSummary[]> {\r\n        const allLayouts = await this.bridge.send<LayoutSummariesResult>(OPERATIONS.getAllLayoutsSummaries.name);\r\n        return allLayouts.summaries;\r\n    }\r\n\r\n    public async deleteLayout(name: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.deleteLayout.name, { name });\r\n    }\r\n\r\n    public async exportLayout(predicate?: (layout: Glue42Workspaces.WorkspaceLayout) => boolean): Promise<Glue42Workspaces.WorkspaceLayout[]> {\r\n        const allLayoutsResult = await this.bridge.send<ExportedLayoutsResult>(OPERATIONS.exportAllLayouts.name);\r\n        return allLayoutsResult.layouts.reduce<Glue42Workspaces.WorkspaceLayout[]>((matchingLayouts, layout) => {\r\n\r\n            if (!predicate || predicate(layout)) {\r\n                matchingLayouts.push(layout);\r\n            }\r\n\r\n            return matchingLayouts;\r\n        }, []);\r\n    }\r\n\r\n    public async saveLayout(config: Glue42Workspaces.WorkspaceLayoutSaveConfig): Promise<Glue42Workspaces.WorkspaceLayout> {\r\n        return await this.bridge.send(OPERATIONS.saveLayout.name, config);\r\n    }\r\n\r\n    public async importLayout(layouts: Glue42Workspaces.WorkspaceLayout[], mode: \"replace\" | \"merge\"): Promise<void> {\r\n\r\n        await Promise.all(layouts.map((layout) => this.bridge.send(OPERATIONS.importLayout.name, { layout, mode })));\r\n    }\r\n\r\n    public handleOnSaved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnSaved(callback);\r\n    }\r\n\r\n    public handleOnRemoved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnRemoved(callback);\r\n    }\r\n\r\n    public async bundleTo(type: \"row\" | \"column\", workspaceId: string): Promise<void> {\r\n        return await this.base.bundleTo(type, workspaceId);\r\n    }\r\n\r\n    public getWorkspaceContext(workspaceId: string): Promise<any> {\r\n        return this.base.getWorkspaceContext(workspaceId);\r\n    }\r\n\r\n    public setWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.setWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public updateWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.updateWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public subscribeWorkspaceContextUpdated(workspaceId: string, callback: (data: any) => void): Promise<import(\"callback-registry\").UnsubscribeFunction> {\r\n        return this.base.subscribeWorkspaceContextUpdated(workspaceId, callback);\r\n    }\r\n\r\n    public async restoreItem(itemId: string): Promise<void> {\r\n        return await this.base.restoreItem(itemId);\r\n    }\r\n\r\n    public async maximizeItem(itemId: string): Promise<void> {\r\n        return await this.base.maximizeItem(itemId);\r\n    }\r\n\r\n    public async focusItem(itemId: string): Promise<void> {\r\n        return await this.base.focusItem(itemId);\r\n    }\r\n\r\n    public async changeFrameState(frameId: string, state: Glue42Workspaces.FrameState): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.changeFrameState.name, { frameId, requestedState: state });\r\n    }\r\n\r\n    public async getFrameBounds(frameId: string): Promise<Glue42Workspaces.FrameBounds> {\r\n        const frameResult = await this.bridge.send<FrameBoundsResult>(OPERATIONS.getFrameBounds.name, { itemId: frameId });\r\n        return frameResult.bounds;\r\n    }\r\n\r\n    public async getFrameState(frameId: string): Promise<Glue42Workspaces.FrameState> {\r\n        const frameResult = await this.bridge.send<FrameStateResult>(OPERATIONS.getFrameState.name, { itemId: frameId });\r\n        return frameResult.state;\r\n    }\r\n\r\n    public async closeItem(itemId: string): Promise<void> {\r\n        return await this.base.closeItem(itemId);\r\n    }\r\n\r\n    public async resizeItem(itemId: string, config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        return await this.base.resizeItem(itemId, config);\r\n    }\r\n\r\n    public async moveFrame(itemId: string, config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        return await this.base.moveFrame(itemId, config);\r\n    }\r\n\r\n    public getGDWindow(itemId: string): GDWindow {\r\n        return this.base.getGDWindow(itemId);\r\n    }\r\n\r\n    public async forceLoadWindow(itemId: string): Promise<string> {\r\n        const windowId = await this.base.forceLoadWindow(itemId);\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async ejectWindow(itemId: string): Promise<string> {\r\n        const windowId: string = (await this.base.ejectWindow(itemId)).windowId;\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async moveWindowTo(itemId: string, newParentId: string): Promise<void> {\r\n        return await this.base.moveWindowTo(itemId, newParentId);\r\n    }\r\n\r\n    public async getSnapshot(itemId: string, type: \"workspace\"): Promise<WorkspaceSnapshotResult>\r\n    public async getSnapshot(itemId: string, type: \"frame\"): Promise<FrameSnapshotResult>\r\n    public async getSnapshot(itemId: string, type: \"workspace\" | \"frame\"): Promise<WorkspaceSnapshotResult | FrameSnapshotResult> {\r\n        return await this.base.getSnapshot(itemId, type);\r\n    }\r\n\r\n    public async setItemTitle(itemId: string, title: string): Promise<void> {\r\n        return await this.base.setItemTitle(itemId, title);\r\n    }\r\n\r\n    public flatChildren(children: Child[]): Child[] {\r\n        return children.reduce<Child[]>((soFar, child) => {\r\n\r\n            soFar.push(child);\r\n\r\n            if (child.type !== \"window\") {\r\n                soFar.push(...this.flatChildren(child.children));\r\n            }\r\n\r\n            return soFar;\r\n        }, []);\r\n    }\r\n\r\n    public refreshChildren(config: RefreshChildrenConfig): Child[] {\r\n        return this.base.refreshChildren(config);\r\n    }\r\n\r\n    public iterateFindChild(children: Child[], predicate: (child: Child) => boolean): Child {\r\n        return this.base.iterateFindChild(children, predicate);\r\n    }\r\n\r\n    public iterateFilterChildren(children: Child[], predicate: (child: Child) => boolean): Child[] {\r\n        return this.base.iterateFilterChildren(children, predicate);\r\n    }\r\n\r\n    public hibernateWorkspace(workspaceId: string): Promise<void> {\r\n        return this.base.hibernateWorkspace(workspaceId);\r\n    }\r\n\r\n    public resumeWorkspace(workspaceId: string): Promise<void> {\r\n        return this.base.resumeWorkspace(workspaceId);\r\n    }\r\n\r\n    public lockWorkspace(workspaceId: string, config?: Glue42Workspaces.WorkspaceLockConfig): Promise<void> {\r\n        return this.base.lockWorkspace(workspaceId, config);\r\n    }\r\n\r\n    public lockWindow(windowPlacementId: string, config?: Glue42Workspaces.WorkspaceWindowLockConfig): Promise<void> {\r\n        return this.base.lockWindow(windowPlacementId, config);\r\n    }\r\n\r\n    public lockContainer(itemId: string, type: SubParentTypes[\"type\"], config?: ContainerLockConfig): Promise<void> {\r\n        return this.base.lockContainer(itemId, type, config);\r\n    }\r\n\r\n    public async getFrameConstraints(frameId: string): Promise<Glue42Workspaces.FrameConstraints> {\r\n        const frameSnapshot = await this.getSnapshot(frameId, \"frame\");\r\n\r\n        return {\r\n            minWidth: frameSnapshot.config.minWidth,\r\n            maxWidth: frameSnapshot.config.maxWidth,\r\n            minHeight: frameSnapshot.config.minHeight,\r\n            maxHeight: frameSnapshot.config.maxHeight,\r\n        };\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private async handleCoreLocalSubscription(config: SubscriptionConfig, levelId: string): Promise<Glue42Workspaces.Unsubscribe> {\r\n        await this.bridge.createCoreEventSubscription();\r\n\r\n        config.scopeId = config.scopeId || levelId;\r\n\r\n        if (config.eventType === \"window\" && config.action === \"loaded\") {\r\n            const originalCB = config.callback;\r\n\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                originalCB(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.handleCoreSubscription(config);\r\n    }\r\n\r\n    private handleEnterpriseLocalSubscription(config: SubscriptionConfig, levelId: string): Promise<Glue42Workspaces.Unsubscribe> {\r\n        config.scopeId = config.scopeId || levelId;\r\n\r\n        if (config.eventType === \"window\" && config.action === \"loaded\") {\r\n            const originalCB = config.callback;\r\n\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n                originalCB(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.subscribe(config);\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private async handleCoreGlobalSubscription(callback: (callbackData: unknown) => void, eventType: WorkspaceEventType, action: WorkspaceEventAction): Promise<Glue42Workspaces.Unsubscribe> {\r\n        await this.bridge.createCoreEventSubscription();\r\n\r\n        const config: SubscriptionConfig = {\r\n            eventType, callback, action,\r\n            scope: \"global\",\r\n        };\r\n\r\n        if (eventType === \"window\" && action === \"loaded\") {\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                callback(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.handleCoreSubscription(config);\r\n    }\r\n\r\n    private handleEnterpriseGlobalSubscription(callback: (callbackData: unknown) => void, eventType: WorkspaceEventType, action: WorkspaceEventAction): Promise<Glue42Workspaces.Unsubscribe> {\r\n        const config: SubscriptionConfig = {\r\n            eventType, callback, action,\r\n            scope: \"global\",\r\n        };\r\n\r\n        if (eventType === \"window\" && action === \"loaded\") {\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                callback(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.subscribe(config);\r\n    }\r\n\r\n    private async iterateWorkspaces(callback: (workspace: Workspace, end: () => void) => void): Promise<void> {\r\n        let ended = false;\r\n\r\n        const end = (): void => { ended = true; };\r\n\r\n        const workspaceSummaries = await this.getAllWorkspaceSummaries();\r\n\r\n        for (const summary of workspaceSummaries) {\r\n            if (ended) {\r\n                return;\r\n            }\r\n\r\n            const wsp = await this.base.fetchWorkspace(summary.id);\r\n\r\n            callback(wsp, end);\r\n        }\r\n    }\r\n}\r\n","/*eslint indent: [2, 4, {\"SwitchCase\": 1}]*/\r\nimport CallbackFactory from \"callback-registry\";\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { InteropTransport } from \"../communication/interop-transport\";\r\nimport { BaseBuilder } from \"../builders/baseBuilder\";\r\nimport { ParentBuilder } from \"../builders/parentBuilder\";\r\nimport { WorkspaceBuilder } from \"../builders/workspaceBuilder\";\r\nimport { ModelMaps, ModelTypes, FramePrivateData, WindowPrivateData, WorkspacePrivateData, ParentPrivateData } from \"../types/privateData\";\r\nimport { PrivateDataManager } from \"./privateDataManager\";\r\nimport { FrameCreateConfig, ModelCreateConfig, WindowCreateConfig, WorkspaceIoCCreateConfig, ParentCreateConfig } from \"../types/ioc\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { Window } from \"../models/window\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { ChildSnapshotResult } from \"../types/protocol\";\r\nimport { AllParentTypes, Child } from \"../types/builders\";\r\nimport { Row } from \"../models/row\";\r\nimport { Column } from \"../models/column\";\r\nimport { Group } from \"../models/group\";\r\nimport { Base } from \"../models/base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\nimport { InteropAPI, WindowsAPI, LayoutsAPI, ContextsAPI } from \"../types/glue\";\r\nimport { BaseController } from \"../controllers/base\";\r\nimport { MainController } from \"../controllers/main\";\r\n\r\nexport class IoC {\r\n\r\n    private _controllerInstance: WorkspacesController;\r\n    private _bridgeInstance: Bridge;\r\n    private _transportInstance: InteropTransport;\r\n    private _privateDataManagerInstance: PrivateDataManager;\r\n    private _parentBaseInstance: Base;\r\n    private _baseController: BaseController;\r\n\r\n    constructor(\r\n        private readonly agm: InteropAPI,\r\n        private readonly windows: WindowsAPI,\r\n        private readonly layouts: LayoutsAPI,\r\n        private readonly contexts: ContextsAPI\r\n    ) { }\r\n\r\n    public get baseController(): BaseController {\r\n        if (!this._baseController) {\r\n            this._baseController = new BaseController(this, this.windows, this.contexts, this.layouts);\r\n        }\r\n\r\n        return this._baseController;\r\n    }\r\n\r\n    public get controller(): WorkspacesController {\r\n        if (!this._controllerInstance) {\r\n            this._controllerInstance = new MainController(this.bridge, this.baseController);\r\n        }\r\n        return this._controllerInstance;\r\n    }\r\n\r\n    public get bridge(): Bridge {\r\n        if (!this._bridgeInstance) {\r\n            this._bridgeInstance = new Bridge(this.transport, CallbackFactory());\r\n        }\r\n        return this._bridgeInstance;\r\n    }\r\n\r\n    public get transport(): InteropTransport {\r\n\r\n        if (!this._transportInstance) {\r\n            this._transportInstance = new InteropTransport(this.agm);\r\n        }\r\n\r\n        return this._transportInstance;\r\n    }\r\n\r\n    public get privateDataManager(): PrivateDataManager {\r\n        if (!this._privateDataManagerInstance) {\r\n            this._privateDataManagerInstance = new PrivateDataManager();\r\n        }\r\n        return this._privateDataManagerInstance;\r\n    }\r\n\r\n    public get parentBase(): Base {\r\n        if (!this._parentBaseInstance) {\r\n            this._parentBaseInstance = new Base(this.privateDataManager);\r\n        }\r\n        return this._parentBaseInstance;\r\n    }\r\n\r\n    public async initiate(actualWindowId: string): Promise<void> {\r\n        await this.transport.initiate(actualWindowId);\r\n    }\r\n\r\n    public getModel<T extends ModelTypes>(type: ModelTypes, createConfig: ModelCreateConfig): ModelMaps[T] {\r\n        switch (type) {\r\n            case \"frame\": {\r\n                const newFrame = new Frame(this.privateDataManager);\r\n\r\n                const { summary } = createConfig as FrameCreateConfig;\r\n\r\n                const frameData: FramePrivateData = { summary, controller: this.controller };\r\n\r\n                this.privateDataManager.setFrameData(newFrame, frameData);\r\n\r\n                return newFrame as ModelMaps[T];\r\n            }\r\n            case \"window\": {\r\n                const { id, parent, frame, workspace, config } = createConfig as WindowCreateConfig;\r\n\r\n                const windowPrivateData: WindowPrivateData = {\r\n                    type: \"window\",\r\n                    controller: this.controller,\r\n                    config, id, parent, frame, workspace\r\n                };\r\n\r\n                const newWindow = new Window(this.privateDataManager);\r\n\r\n                this.privateDataManager.setWindowData(newWindow, windowPrivateData);\r\n\r\n                return newWindow as ModelMaps[T];\r\n            }\r\n            case \"row\":\r\n            case \"column\":\r\n            case \"group\": {\r\n                const { id, children, parent, frame, workspace, config } = createConfig as ParentCreateConfig;\r\n\r\n                const newParent = type === \"column\" ? new Column(this.parentBase) :\r\n                    type === \"row\" ? new Row(this.parentBase) : new Group(this.parentBase);\r\n\r\n                const builtChildren = this.buildChildren(children, frame, workspace, newParent);\r\n\r\n                const parentPrivateData = {\r\n                    id, parent, frame, workspace,\r\n                    config,\r\n                    type,\r\n                    controller: this.controller,\r\n                    children: builtChildren,\r\n                };\r\n\r\n                this.privateDataManager.setParentData(newParent, parentPrivateData as ParentPrivateData);\r\n\r\n                return newParent as ModelMaps[T];\r\n            }\r\n            case \"workspace\": {\r\n                const { snapshot, frame } = createConfig as WorkspaceIoCCreateConfig;\r\n\r\n                const newWorkspace = new Workspace(this.privateDataManager);\r\n\r\n                const children = this.buildChildren(snapshot.children, frame, newWorkspace, newWorkspace);\r\n\r\n                const workspacePrivateData: WorkspacePrivateData = {\r\n                    id: snapshot.id,\r\n                    type: \"workspace\",\r\n                    config: snapshot.config,\r\n                    base: this.parentBase,\r\n                    controller: this.controller,\r\n                    children, frame, ioc: this\r\n                };\r\n\r\n                this.privateDataManager.setWorkspaceData(newWorkspace, workspacePrivateData);\r\n                return newWorkspace as ModelMaps[T];\r\n            }\r\n            default: throw new Error(`Unrecognized type: ${type}`);\r\n        }\r\n    }\r\n\r\n    public getBuilder(config: Glue42Workspaces.BuilderConfig): WorkspaceBuilder | ParentBuilder {\r\n        config.definition = config.definition || {};\r\n\r\n        if (!Array.isArray(config.definition.children)) {\r\n            config.definition.children = [];\r\n        }\r\n\r\n        const baseBuilder = new BaseBuilder(this.getBuilder.bind(this));\r\n\r\n        switch (config.type) {\r\n            case \"workspace\": {\r\n                return new WorkspaceBuilder(config.definition as Glue42Workspaces.WorkspaceDefinition, baseBuilder, this.controller);\r\n            }\r\n            case \"row\":\r\n            case \"column\":\r\n            case \"group\": {\r\n                (config.definition as Glue42Workspaces.BoxDefinition).type = config.type;\r\n                return new ParentBuilder(config.definition as Glue42Workspaces.BoxDefinition, baseBuilder);\r\n            }\r\n            default: throw new Error(`Unexpected Builder creation error, provided config: ${JSON.stringify(config)}`);\r\n        }\r\n    }\r\n\r\n    private buildChildren(children: ChildSnapshotResult[], frame: Frame, workspace: Glue42Workspaces.Workspace, parent: AllParentTypes): Child[] {\r\n        return children.map<Child>((child) => {\r\n            switch (child.type) {\r\n                case \"window\": return this.getModel<\"window\">(\"window\", {\r\n                    id: child.id,\r\n                    config: child.config,\r\n                    frame, workspace, parent\r\n                } as WindowCreateConfig);\r\n                case \"column\": return this.getModel<\"column\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                } as ParentCreateConfig);\r\n                case \"row\": return this.getModel<\"row\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                } as ParentCreateConfig);\r\n                case \"group\": return this.getModel<\"group\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                } as ParentCreateConfig);\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                default: throw new Error(`Unsupported child type: ${(child as any).type}`);\r\n            }\r\n        });\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { IoC } from \"./shared/ioc\";\r\nimport { checkThrowCallback, nonEmptyStringDecoder, workspaceLayoutDecoder, workspaceDefinitionDecoder, workspaceBuilderCreateConfigDecoder, builderConfigDecoder, restoreWorkspaceConfigDecoder, workspaceLayoutSaveConfigDecoder } from \"./shared/decoders\";\r\nimport { FrameStreamData, WorkspaceStreamData, WorkspaceSnapshotResult, WindowStreamData } from \"./types/protocol\";\r\nimport { FrameCreateConfig, WorkspaceIoCCreateConfig } from \"./types/ioc\";\r\nimport { Glue42Workspaces } from \"./../workspaces\";\r\nimport { WorkspacesController } from \"./types/controller\";\r\n\r\nexport const composeAPI = (glue: any, ioc: IoC): Glue42Workspaces.API => {\r\n\r\n    const controller: WorkspacesController = ioc.controller;\r\n\r\n    const inWorkspace = (): Promise<boolean> => {\r\n        const myId: string = glue.windows.my().id;\r\n\r\n        if (!myId) {\r\n            throw new Error(\"Cannot get my frame, because my id is undefined.\");\r\n        }\r\n\r\n        return controller.checkIsInSwimlane(myId);\r\n    };\r\n\r\n    const getBuilder = (config: Glue42Workspaces.BuilderConfig): Glue42Workspaces.WorkspaceBuilder | Glue42Workspaces.BoxBuilder => {\r\n        const validatedConfig = builderConfigDecoder.runWithException(config);\r\n\r\n        return ioc.getBuilder(validatedConfig);\r\n    };\r\n\r\n    const getMyFrame = async (): Promise<Glue42Workspaces.Frame> => {\r\n        const windowId: string = glue.windows.my().id;\r\n\r\n        if (!windowId) {\r\n            throw new Error(\"Cannot get my frame, because my id is undefined.\");\r\n        }\r\n\r\n        const isInSwimlane = await controller.checkIsInSwimlane(windowId);\r\n\r\n        if (!isInSwimlane) {\r\n            throw new Error(\"Cannot fetch your frame, because this window is not in a workspace\");\r\n        }\r\n\r\n        return controller.getFrame({ windowId });\r\n    };\r\n\r\n    const getFrame = async (predicate: (frame: Glue42Workspaces.Frame) => boolean): Promise<Glue42Workspaces.Frame> => {\r\n        checkThrowCallback(predicate);\r\n\r\n        return controller.getFrame({ predicate });\r\n    };\r\n\r\n    const getAllFrames = async (predicate?: (frame: Glue42Workspaces.Frame) => boolean): Promise<Glue42Workspaces.Frame[]> => {\r\n        checkThrowCallback(predicate, true);\r\n\r\n        return controller.getFrames(predicate);\r\n    };\r\n\r\n    const getAllWorkspacesSummaries = (): Promise<Glue42Workspaces.WorkspaceSummary[]> => {\r\n        return controller.getAllWorkspaceSummaries();\r\n    };\r\n\r\n    const getMyWorkspace = async (): Promise<Glue42Workspaces.Workspace> => {\r\n        const myId: string = glue.windows.my().id;\r\n\r\n        if (!myId) {\r\n            throw new Error(\"Cannot get my workspace, because my id is undefined.\");\r\n        }\r\n\r\n        const isInSwimlane = await controller.checkIsInSwimlane(myId);\r\n\r\n        if (!isInSwimlane) {\r\n            throw new Error(\"Cannot fetch your workspace, because this window is not in a workspace\");\r\n        }\r\n\r\n        return (await controller.getWorkspaces((wsp) => !!wsp.getWindow((w) => w.id === myId)))[0];\r\n    };\r\n\r\n    const getWorkspace = async (predicate: (workspace: Glue42Workspaces.Workspace) => boolean): Promise<Glue42Workspaces.Workspace> => {\r\n        checkThrowCallback(predicate);\r\n        return (await controller.getWorkspaces(predicate))[0];\r\n    };\r\n\r\n    const getWorkspaceById = async (workspaceId: string): Promise<Glue42Workspaces.Workspace> => {\r\n        nonEmptyStringDecoder.runWithException(workspaceId);\r\n\r\n        return controller.getWorkspaceById(workspaceId);\r\n    };\r\n\r\n    const getAllWorkspaces = (predicate?: (workspace: Glue42Workspaces.Workspace) => boolean): Promise<Glue42Workspaces.Workspace[]> => {\r\n        checkThrowCallback(predicate, true);\r\n        return controller.getWorkspaces(predicate);\r\n    };\r\n\r\n    const getWindow = async (predicate: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => boolean): Promise<Glue42Workspaces.WorkspaceWindow> => {\r\n        checkThrowCallback(predicate);\r\n        return controller.getWindow(predicate);\r\n    };\r\n\r\n    const getParent = async (predicate: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Promise<Glue42Workspaces.WorkspaceBox> => {\r\n        checkThrowCallback(predicate);\r\n        return controller.getParent(predicate);\r\n    };\r\n\r\n    const restoreWorkspace = async (name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Glue42Workspaces.Workspace> => {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        const validatedOptions = restoreWorkspaceConfigDecoder.runWithException(options);\r\n        return controller.restoreWorkspace(name, validatedOptions);\r\n    };\r\n\r\n    const createWorkspace = async (definition: Glue42Workspaces.WorkspaceDefinition, saveConfig?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> => {\r\n        const validatedDefinition = workspaceDefinitionDecoder.runWithException(definition);\r\n        const validatedConfig = workspaceBuilderCreateConfigDecoder.runWithException(saveConfig);\r\n\r\n        return controller.createWorkspace(validatedDefinition, validatedConfig);\r\n    };\r\n\r\n    const layouts = {\r\n        getSummaries: (): Promise<Glue42Workspaces.WorkspaceLayoutSummary[]> => {\r\n            return controller.getLayoutSummaries();\r\n        },\r\n        delete: async (name: string): Promise<void> => {\r\n            nonEmptyStringDecoder.runWithException(name);\r\n            return controller.deleteLayout(name);\r\n        },\r\n        export: async (predicate?: (layout: Glue42Workspaces.WorkspaceLayout) => boolean): Promise<Glue42Workspaces.WorkspaceLayout[]> => {\r\n            checkThrowCallback(predicate, true);\r\n            return controller.exportLayout(predicate);\r\n        },\r\n        import: async (layouts: Glue42Workspaces.WorkspaceLayout[], mode: \"replace\" | \"merge\" = \"replace\"): Promise<void> => {\r\n\r\n            if (!Array.isArray(layouts)) {\r\n                throw new Error(`The provided layouts argument is not an array: ${JSON.stringify(layouts)}`);\r\n            }\r\n\r\n            layouts.forEach((layout) => workspaceLayoutDecoder.runWithException(layout));\r\n            return controller.importLayout(layouts, mode);\r\n        },\r\n        save: async (config: Glue42Workspaces.WorkspaceLayoutSaveConfig): Promise<Glue42Workspaces.WorkspaceLayout> => {\r\n            const verifiedConfig = workspaceLayoutSaveConfigDecoder.runWithException(config);\r\n            return controller.saveLayout(verifiedConfig);\r\n        },\r\n        onSaved: async (callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n            checkThrowCallback(callback);\r\n\r\n            return controller.handleOnSaved(callback);\r\n        },\r\n        onRemoved: async (callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n            checkThrowCallback(callback);\r\n\r\n            return controller.handleOnRemoved(callback);\r\n        }\r\n    };\r\n\r\n    const onFrameOpened = async (callback: (frame: Glue42Workspaces.Frame) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: payload.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n            callback(frame);\r\n        };\r\n\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"frame\", \"opened\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onFrameClosed = async (callback: (closed: { frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id });\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"frame\", \"closed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWorkspaceOpened = async (callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const workspace = await controller.transformStreamPayloadToWorkspace(payload);\r\n\r\n            callback(workspace);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"workspace\", \"opened\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWorkspaceClosed = async (callback: (closed: { frameId: string; workspaceId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n\r\n        const wrappedCallback = (payload: WorkspaceStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id, workspaceId: payload.workspaceSummary.id });\r\n        };\r\n\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"workspace\", \"closed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowAdded = async (callback: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const snapshot = (await controller.getSnapshot(payload.windowSummary.config.workspaceId, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: snapshot.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n            const workspace = ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n            const windowParent = workspace.getBox((parent) => parent.id === payload.windowSummary.parentId);\r\n            const foundWindow = windowParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"added\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowLoaded = async (callback: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const snapshot = (await controller.getSnapshot(payload.windowSummary.config.workspaceId, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: snapshot.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n            const workspace = ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n            const foundWindow = workspace.getWindow((win) => win.id && win.id === payload.windowSummary.config.windowId);\r\n\r\n            callback(foundWindow);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"loaded\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowRemoved = async (callback: (removed: { windowId: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = (payload: WindowStreamData): void => {\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"removed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    return {\r\n        inWorkspace,\r\n        getBuilder,\r\n        getMyFrame,\r\n        getFrame,\r\n        getAllFrames,\r\n        getAllWorkspacesSummaries,\r\n        getMyWorkspace,\r\n        getWorkspace,\r\n        getWorkspaceById,\r\n        getAllWorkspaces,\r\n        getWindow,\r\n        getBox: getParent,\r\n        restoreWorkspace,\r\n        createWorkspace,\r\n        layouts,\r\n        onFrameOpened,\r\n        onFrameClosed,\r\n        onWorkspaceOpened,\r\n        onWorkspaceClosed,\r\n        onWindowAdded,\r\n        onWindowLoaded,\r\n        onWindowRemoved,\r\n    };\r\n};\r\n","import { IoC } from \"./shared/ioc\";\r\nimport { composeAPI } from \"./main\";\r\nimport { WorkspacesFactoryFunction } from \"../workspaces\";\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\nconst factoryFunction: WorkspacesFactoryFunction = async (glue: any): Promise<void> => {\r\n\r\n    const ioc = new IoC(glue.agm, glue.windows, glue.layouts, glue.contexts);\r\n\r\n    const actualWindowId = glue.interop.instance.windowId;\r\n\r\n    await ioc.initiate(actualWindowId);\r\n\r\n    glue.workspaces = composeAPI(glue, ioc);\r\n};\r\n\r\n// attach to window object\r\nif (typeof window !== \"undefined\") {\r\n    /* eslint-disable @typescript-eslint/no-explicit-any */\r\n    (window as any).GlueWorkspaces = factoryFunction;\r\n}\r\n\r\nexport default factoryFunction;\r\n"],"names":["createRegistry","options","errorHandling","Error","_userErrorHandler","callbacks","_handleError","exceptionArtifact","key","errParam","msg","stack","console","error","add","callback","callbacksForKey","push","allForKey","reduce","acc","element","index","length","execute","argumentsArr","_i","arguments","results","forEach","result","apply","undefined","err","clear","clearKey","default","ok","asPromise","r","Promise","resolve","reject","withDefault","defaultValue","withException","map","f","map2","ar","br","mapError","andThen","__assign","Object","freeze","isOk","isErr","successes","concat","assign","t","s","i","n","p","prototype","hasOwnProperty","call","this","isJsonArray","json","Array","isArray","isJsonObject","expectedGot","expected","got","JSON","stringify","typeString","printPath","paths","path","join","prependAt","newAt","_a","at","rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","Decoder","decode","_this","run","kind","input","message","runPromise","runWithException","value","where","test","errorMessage","succeed","fail","string","number","boolean","constant","isEqual","a","b","keys","object","decoders","obj","array","decoder","v","arr","err$$1","decodeValue_1","tuple","nth","union","ad","bd","oneOf","intersection","ds","anyJson","unknownJson","dict","optional","errors","errorsList","valueAt","jsonAtPath","slice","fixedValue","lazy","mkDecoder","nonEmptyStringDecoder","nonNegativeNumberDecoder","num","positiveNumberDecoder","isWindowInSwimlaneResultDecoder","inWorkspace","allParentDecoder","subParentDecoder","frameStateDecoder","checkThrowCallback","allowUndefined","argumentType","workspaceBuilderCreateConfigDecoder","saveLayout","deleteLayoutConfigDecoder","name","windowDefinitionConfigDecoder","minWidth","maxWidth","minHeight","maxHeight","allowExtract","showCloseButton","groupDefinitionConfigDecoder","allowDrop","allowDropHeader","allowDropLeft","allowDropRight","allowDropTop","allowDropBottom","showMaximizeButton","showEjectButton","showAddWindowButton","rowDefinitionConfigDecoder","allowSplitters","isPinned","columnDefinitionConfigDecoder","swimlaneWindowDefinitionDecoder","type","appName","windowId","context","config","strictSwimlaneWindowDefinitionDecoder","parentDefinitionDecoder","children","strictColumnDefinitionDecoder","strictParentDefinitionDecoder","strictRowDefinitionDecoder","strictGroupDefinitionDecoder","newFrameConfigDecoder","toLowerCase","bounds","left","top","width","height","loadingStrategyDecoder","restoreWorkspaceConfigDecoder","app","loadingStrategy","title","reuseWorkspaceId","frameId","lockdown","activateFrame","newFrame","noTabHeader","inMemoryLayout","openWorkspaceConfigDecoder","restoreOptions","workspaceDefinitionDecoder","position","isFocused","showSaveButton","showWindowCloseButtons","showEjectButtons","showAddWindowButtons","frame","reuseFrameId","builderConfigDecoder","definition","workspaceCreateConfigDecoder","saveConfig","getFrameSummaryConfigDecoder","itemId","frameSummaryDecoder","id","eventTypeDecoder","workspaceId","positionIndex","streamRequestArgumentsDecoder","branch","workspaceEventActionDecoder","workspaceConfigResultDecoder","layoutName","isHibernated","isSelected","widthInPx","heightInPx","baseChildSnapshotConfigDecoder","parentSnapshotConfigDecoder","swimlaneWindowSnapshotConfigDecoder","isMaximized","minHeigth","customWorkspaceSubParentSnapshotDecoder","customWorkspaceChildSnapshotDecoder","customWorkspaceWindowSnapshotDecoder","workspaceSnapshotResultDecoder","frameSummary","windowLayoutItemDecoder","url","groupLayoutItemDecoder","columnLayoutItemDecoder","rowLayoutItemDecoder","workspaceLayoutDecoder","metadata","components","state","workspacesImportLayoutDecoder","layout","mode","exportedLayoutsResultDecoder","layouts","frameSummaryResultDecoder","frameSummariesResultDecoder","summaries","workspaceSummaryResultDecoder","workspaceSummariesResultDecoder","frameSnapshotResultDecoder","workspaces","layoutSummaryDecoder","layoutSummariesDecoder","simpleWindowOperationSuccessResultDecoder","voidResultDecoder","frameStateResultDecoder","frameBoundsResultDecoder","resizeConfigDecoder","relative","moveConfigDecoder","simpleItemConfigDecoder","frameStateConfigDecoder","requestedState","setItemTitleConfigDecoder","moveWindowConfigDecoder","containerId","resizeItemConfigDecoder","moveFrameConfigDecoder","addWindowConfigDecoder","parentId","parentType","addContainerConfigDecoder","addItemResultDecoder","pingResultDecoder","live","bundleConfigDecoder","containerSummaryResultDecoder","frameStreamDataDecoder","workspaceStreamDataDecoder","workspaceSummary","workspaceSnapshot","containerStreamDataDecoder","containerSummary","windowStreamDataDecoder","windowSummary","workspaceLayoutSaveConfigDecoder","saveContext","workspaceSelectorDecoder","workspaceLockConfigDecoder","lockWorkspaceDecoder","windowLockConfigDecoder","elementResizeConfigDecoder","lockWindowDecoder","windowPlacementId","rowLockConfigDecoder","columnLockConfigDecoder","groupLockConfigDecoder","lockRowDecoder","lockColumnDecoder","lockGroupDecoder","lockContainerDecoder","webPlatformMethodName","webPlatformWspStreamName","METHODS","control","isStream","frameStream","workspaceStream","containerStream","windowStream","STREAMS","payloadDecoder","workspace","container","window","OPERATIONS","ping","resultDecoder","isWindowInWorkspace","argsDecoder","createWorkspace","getAllFramesSummaries","getFrameSummary","getAllWorkspacesSummaries","getWorkspaceSnapshot","getAllLayoutsSummaries","openWorkspace","deleteLayout","importLayout","exportAllLayouts","restoreItem","maximizeItem","focusItem","closeItem","resizeItem","changeFrameState","getFrameState","getFrameBounds","moveFrame","getFrameSnapshot","forceLoadWindow","ejectWindow","setItemTitle","moveWindowTo","addWindow","addContainer","bundleWorkspace","hibernateWorkspace","resumeWorkspace","lockWorkspace","lockWindow","lockContainer","Bridge","[object Object]","transport","registry","coreSubscriptionReady","handleCoreEvent","bind","registryKey","eventType","action","scope","scopeId","args","scopeConfig","receivedIds","checkScopeMatch","operationName","operationArgs","operationDefinition","values","find","operation","operationResult","operationResultRaw","transmitControl","activeSub","getActiveSubscription","getRegistryKey","stream","gdSub","subscribe","getBranchKey","onData","streamData","data","requestedArgumentsResult","requestArguments","actionResult","streamType","validatedPayload","payload","keyToExecute","level","levelId","callbacksCount","activeSubscriptions","unsubscribe","close","splice","verifiedAction","verifiedType","verifiedPayload","warn","InteropTransport","agm","actualWindowId","glue42gd","all","method","verifyMethodLive","eventCallback","coreEventMethodInitiated","subscribePlatform","corePlatformSubPromise","then","sub","streamName","streamBranch","subscriptionArgs","subscription","operationArguments","invocationArguments","domain","methodName","invocationResult","baseErrorMessage","invoke","methodResponseTimeoutMs","defaultTransportTimeout","all_return_values","all_errors","invocationErrorMessage","returned","promise","methods","some","methodAdded","setTimeout","timeoutMilliseconds","timeoutMessage","promiseActive","timeout","clearTimeout","catch","privateData","WeakMap","ParentBuilder","base","wrapChildren","set","get","serializeChildren","BaseBuilder","getBuilder","child","validatedDefinition","childBuilder","serialize","WorkspaceBuilder","controller","every","getBase","model","Row","getId","getFrameId","getWorkspaceId","getPositionIndex","getAllChildren","parent","getMyParent","getMyFrame","getMyWorkspace","getAllowDrop","getAllowSplitters","getMinWidth","getMinHeight","getMaxWidth","getMaxHeight","getWidthInPx","getHeightInPx","getIsPinned","getIsMaximized","addParent","predicate","removeChild","maximize","restore","lockConfigResult","verifiedConfig","setHeight","Column","setWidth","Group","getAllowExtract","getAllowDropLeft","getAllowDropRight","getAllowDropTop","getAllowDropBottom","getAllowDropHeader","getShowMaximizeButton","getShowEjectButton","getShowAddWindowButton","setSize","getData","manager","getWorkspaceData","getDataManager","Workspace","dataManager","refreshReference","iterateFindChild","wsp","getSnapshot","getWorkspaceContext","setWorkspaceContext","updateWorkspaceContext","subscribeWorkspaceContextUpdated","newSnapshot","currentChildrenFlat","flatChildren","newChildren","refreshChildren","existingChildren","currentFrame","actualFrame","remapFrame","frameCreateConfig","summary","ioc","getModel","remapWorkspace","allParents","iterateFilterChildren","filter","getBox","getAllBoxes","allWindows","bundleTo","currentLockConfig","processLocalSubscription","foundWindow","getWindow","win","getWindowData","Window","elementId","isLoaded","checkIsWindowLoaded","focused","newWindowId","getGdWindow","myId","getGDWindow","getParent","getFrameData","Frame","validatedConfig","getWorkspacesByFrameId","getFrameConstraints","validatedOptions","restoreWorkspace","transformStreamPayloadToWorkspace","getWorkspaceById","PrivateDataManager","keyForDeleting","windowPlacementIdData","k","windowsData","delete","workspacesData","parentsData","framesData","placementId","newData","getParentData","getWindowFromPlacementId","placemenId","getWindowByPlacementId","Base","typeToAdd","parentDefinition","transformDefinition","newParentId","myWorkspace","modelData","BaseController","windows","contexts","bridge","privateDataManager","list","createConfig","snapshot","send","frameConfig","workspaceConfig","allFrameSummaries","frames","frameToCheck","bridgeResults","summaryResult","wrappedCallback","addedUnSub","onAdded","changedUnSub","onChanged","onRemoved","contextName","update","gdWindow","newChildSnapshot","childToAdd","remapChild","foundChild","foundChildren","grandChildren","innerFound","onWindowAdded","MainController","getLayoutSummaries","handleEnterpriseLocalSubscription","handleCoreLocalSubscription","handleEnterpriseGlobalSubscription","handleCoreGlobalSubscription","selector","getFrame","getFrames","fetchWorkspace","foundWorkspace","iterateWorkspaces","end","matchingWorkspaces","summariesForFrame","getAllWorkspaceSummaries","allSummariesResult","resultWindow","resultParent","foundParent","matchingLayouts","handleOnSaved","handleOnRemoved","notifyWindowAdded","soFar","frameSnapshot","createCoreEventSubscription","originalCB","wrappedCB","callbackData","handleCoreSubscription","ended","workspaceSummaries","IoC","baseController","_baseController","_controllerInstance","_bridgeInstance","CallbackFactory","_transportInstance","_privateDataManagerInstance","parentBase","_parentBaseInstance","initiate","frameData","setFrameData","windowPrivateData","newWindow","setWindowData","newParent","builtChildren","buildChildren","parentPrivateData","setParentData","newWorkspace","workspacePrivateData","setWorkspaceData","baseBuilder","factoryFunction","glue","interop","instance","my","checkIsInSwimlane","getAllFrames","getWorkspaces","w","getWorkspace","getAllWorkspaces","getSummaries","export","exportLayout","import","save","onSaved","onFrameOpened","processGlobalSubscription","onFrameClosed","onWorkspaceOpened","onWorkspaceClosed","onWindowLoaded","onWindowRemoved","composeAPI","GlueWorkspaces"],"mappings":"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"}